import{A as og,C as ag,E as ug,F as cg,a as Bm,b as Um,c as jm,d as zm,e as $m,f as Mn,g as Gm,h as vn,i as Km,j as Qm,k as Wm,l as Hm,m as Jm,n as Xm,o as no,p as Ym,q as Zm,r as tg,s as eg,t as ng,u as Ln,v as rg,w as ig,z as sg}from"./chunk-ER4RSQOA.js";import{J as ua,M as Fm,N as to,P as Mm,V as Lm,_ as qm,c as Om,e as Oc,ea as eo,m as Fc}from"./chunk-2JCYUYSE.js";import{a as oa,b as aa}from"./chunk-KAT7YFEL.js";var lg=()=>{};var fg=function(n){let t=[],e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Yw=function(n){let t=[],e=0,r=0;for(;e<n.length;){let s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){let o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){let o=n[e++],u=n[e++],l=n[e++],h=((s&7)<<18|(o&63)<<12|(u&63)<<6|l&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[e++],u=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|u&63)}}return t.join("")},mg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){let o=n[s],u=s+1<n.length,l=u?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,g=o>>2,E=(o&3)<<4|l>>4,T=(l&15)<<2|f>>6,S=f&63;h||(S=64,u||(T=64)),r.push(e[g],e[E],e[T],e[S])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(fg(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Yw(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){let o=e[n.charAt(s++)],l=s<n.length?e[n.charAt(s)]:0;++s;let f=s<n.length?e[n.charAt(s)]:64;++s;let E=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||l==null||f==null||E==null)throw new Mc;let T=o<<2|l>>4;if(r.push(T),f!==64){let S=l<<4&240|f>>2;if(r.push(S),E!==64){let C=f<<6&192|E;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Mc=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Zw=function(n){let t=fg(n);return mg.encodeByteArray(t,!0)},io=function(n){return Zw(n).replace(/\./g,"")},gg=function(n){try{return mg.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function pg(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var tv=()=>pg().__FIREBASE_DEFAULTS__,ev=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},nv=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&gg(n[1]);return t&&JSON.parse(t)},Lc=()=>{try{return lg()||tv()||ev()||nv()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},rv=n=>{var t,e;return(e=(t=Lc())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]},yg=n=>{let t=rv(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},qc=()=>{var n;return(n=Lc())===null||n===void 0?void 0:n.config};var ca=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}};function la(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function _g(n){return(await fetch(n,{credentials:"include"})).ok}function wg(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let u=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[io(JSON.stringify(e)),io(JSON.stringify(u)),""].join(".")}var ro={};function iv(){let n={prod:[],emulator:[]};for(let t of Object.keys(ro))ro[t]?n.emulator.push(t):n.prod.push(t);return n}function sv(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}var hg=!1;function vg(n,t){if(typeof window>"u"||typeof document>"u"||!la(window.location.host)||ro[n]===t||ro[n]||hg)return;ro[n]=t;function e(T){return`__firebase__banner__${T}`}let r="__firebase__banner",o=iv().prod.length>0;function u(){let T=document.getElementById(r);T&&T.remove()}function l(T){T.style.display="flex",T.style.background="#7faaf0",T.style.position="fixed",T.style.bottom="5px",T.style.left="5px",T.style.padding=".5em",T.style.borderRadius="5px",T.style.alignItems="center"}function h(T,S){T.setAttribute("width","24"),T.setAttribute("id",S),T.setAttribute("height","24"),T.setAttribute("viewBox","0 0 24 24"),T.setAttribute("fill","none"),T.style.marginLeft="-6px"}function f(){let T=document.createElement("span");return T.style.cursor="pointer",T.style.marginLeft="16px",T.style.fontSize="24px",T.innerHTML=" &times;",T.onclick=()=>{hg=!0,u()},T}function g(T,S){T.setAttribute("id",S),T.innerText="Learn more",T.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",T.setAttribute("target","__blank"),T.style.paddingLeft="5px",T.style.textDecoration="underline"}function E(){let T=sv(r),S=e("text"),C=document.getElementById(S)||document.createElement("span"),V=e("learnmore"),P=document.getElementById(V)||document.createElement("a"),M=e("preprendIcon"),F=document.getElementById(M)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(T.created){let q=T.element;l(q),g(P,V);let H=f();h(F,M),q.append(F,C,P,H),document.body.appendChild(q)}o?(C.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function Ig(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ov(){var n;let t=(n=Lc())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Eg(){return!ov()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Bc(){try{return typeof indexedDB=="object"}catch{return!1}}function Tg(){return new Promise((n,t)=>{try{let e=!0,r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{var o;t(((o=s.error)===null||o===void 0?void 0:o.message)||"")}}catch(e){t(e)}})}var av="FirebaseError",In=class n extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=av,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,so.prototype.create)}},so=class{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){let r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],u=o?uv(o,r):"Error",l=`${this.serviceName}: ${u} (${s}).`;return new In(s,l,r)}};function uv(n,t){return n.replace(cv,(e,r)=>{let s=t[r];return s!=null?String(s):`<${r}?>`})}var cv=/\{\$([^}]+)}/g;function ei(n,t){if(n===t)return!0;let e=Object.keys(n),r=Object.keys(t);for(let s of e){if(!r.includes(s))return!1;let o=n[s],u=t[s];if(dg(o)&&dg(u)){if(!ei(o,u))return!1}else if(o!==u)return!1}for(let s of r)if(!e.includes(s))return!1;return!0}function dg(n){return n!==null&&typeof n=="object"}var uA=14400*1e3;function le(n){return n&&n._delegate?n._delegate:n}var En=class{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var Cr="[DEFAULT]";var Uc=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let r=new ca;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;let r=this.normalizeInstanceIdentifier(t?.identifier),s=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(s)return null;throw o}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(hv(t))try{this.getOrInitializeService({instanceIdentifier:Cr})}catch{}for(let[e,r]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=Cr){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){let t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Cr){return this.instances.has(t)}getOptions(t=Cr){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(let[o,u]of this.instancesDeferred.entries()){let l=this.normalizeInstanceIdentifier(o);r===l&&u.resolve(s)}return s}onInit(t,e){var r;let s=this.normalizeInstanceIdentifier(e),o=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;o.add(t),this.onInitCallbacks.set(s,o);let u=this.instances.get(s);return u&&t(u,s),()=>{o.delete(t)}}invokeOnInitCallbacks(t,e){let r=this.onInitCallbacks.get(e);if(r)for(let s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:lv(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Cr){return this.component?this.component.multipleInstances?t:Cr:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function lv(n){return n===Cr?void 0:n}function hv(n){return n.instantiationMode==="EAGER"}var ha=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new Uc(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var dv=[],ot=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(ot||{}),fv={debug:ot.DEBUG,verbose:ot.VERBOSE,info:ot.INFO,warn:ot.WARN,error:ot.ERROR,silent:ot.SILENT},mv=ot.INFO,gv={[ot.DEBUG]:"log",[ot.VERBOSE]:"log",[ot.INFO]:"info",[ot.WARN]:"warn",[ot.ERROR]:"error"},pv=(n,t,...e)=>{if(t<n.logLevel)return;let r=new Date().toISOString(),s=gv[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},ni=class{constructor(t){this.name=t,this._logLevel=mv,this._logHandler=pv,this._userLogHandler=null,dv.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ot))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?fv[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,ot.DEBUG,...t),this._logHandler(this,ot.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,ot.VERBOSE,...t),this._logHandler(this,ot.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,ot.INFO,...t),this._logHandler(this,ot.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,ot.WARN,...t),this._logHandler(this,ot.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,ot.ERROR,...t),this._logHandler(this,ot.ERROR,...t)}};var zc=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(yv(e)){let r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}};function yv(n){let t=n.getComponent();return t?.type==="VERSION"}var $c="@firebase/app",Ag="0.13.2";var Tn=new ni("@firebase/app"),_v="@firebase/app-compat",wv="@firebase/analytics-compat",vv="@firebase/analytics",Iv="@firebase/app-check-compat",Ev="@firebase/app-check",Tv="@firebase/auth",Av="@firebase/auth-compat",bv="@firebase/database",Sv="@firebase/data-connect",Rv="@firebase/database-compat",Pv="@firebase/functions",Cv="@firebase/functions-compat",Vv="@firebase/installations",xv="@firebase/installations-compat",Dv="@firebase/messaging",Nv="@firebase/messaging-compat",kv="@firebase/performance",Ov="@firebase/performance-compat",Fv="@firebase/remote-config",Mv="@firebase/remote-config-compat",Lv="@firebase/storage",qv="@firebase/storage-compat",Bv="@firebase/firestore",Uv="@firebase/ai",jv="@firebase/firestore-compat",zv="firebase",$v="11.10.0";var Gc="[DEFAULT]",Gv={[$c]:"fire-core",[_v]:"fire-core-compat",[vv]:"fire-analytics",[wv]:"fire-analytics-compat",[Ev]:"fire-app-check",[Iv]:"fire-app-check-compat",[Tv]:"fire-auth",[Av]:"fire-auth-compat",[bv]:"fire-rtdb",[Sv]:"fire-data-connect",[Rv]:"fire-rtdb-compat",[Pv]:"fire-fn",[Cv]:"fire-fn-compat",[Vv]:"fire-iid",[xv]:"fire-iid-compat",[Dv]:"fire-fcm",[Nv]:"fire-fcm-compat",[kv]:"fire-perf",[Ov]:"fire-perf-compat",[Fv]:"fire-rc",[Mv]:"fire-rc-compat",[Lv]:"fire-gcs",[qv]:"fire-gcs-compat",[Bv]:"fire-fst",[jv]:"fire-fst-compat",[Uv]:"fire-vertex","fire-js":"fire-js",[zv]:"fire-js-all"};var da=new Map,Kv=new Map,Kc=new Map;function bg(n,t){try{n.container.addComponent(t)}catch(e){Tn.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function oo(n){let t=n.name;if(Kc.has(t))return Tn.debug(`There were multiple attempts to register component ${t}.`),!1;Kc.set(t,n);for(let e of da.values())bg(e,n);for(let e of Kv.values())bg(e,n);return!0}function Cg(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Vg(n){return n==null?!1:n.settings!==void 0}var Qv={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},qn=new so("app","Firebase",Qv);var Qc=class{constructor(t,e,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new En("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw qn.create("app-deleted",{appName:this._name})}};var xg=$v;function Wv(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let r=Object.assign({name:Gc,automaticDataCollectionEnabled:!0},t),s=r.name;if(typeof s!="string"||!s)throw qn.create("bad-app-name",{appName:String(s)});if(e||(e=qc()),!e)throw qn.create("no-options");let o=da.get(s);if(o){if(ei(e,o.options)&&ei(r,o.config))return o;throw qn.create("duplicate-app",{appName:s})}let u=new ha(s);for(let h of Kc.values())u.addComponent(h);let l=new Qc(e,r,u);return da.set(s,l),l}function Dg(n=Gc){let t=da.get(n);if(!t&&n===Gc&&qc())return Wv();if(!t)throw qn.create("no-app",{appName:n});return t}function ri(n,t,e){var r;let s=(r=Gv[n])!==null&&r!==void 0?r:n;e&&(s+=`-${e}`);let o=s.match(/\s|\//),u=t.match(/\s|\//);if(o||u){let l=[`Unable to register library "${s}" with version "${t}":`];o&&l.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&u&&l.push("and"),u&&l.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Tn.warn(l.join(" "));return}oo(new En(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}var Hv="firebase-heartbeat-database",Jv=1,ao="firebase-heartbeat-store",jc=null;function Ng(){return jc||(jc=Qm(Hv,Jv,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(ao)}catch(e){console.warn(e)}}}}).catch(n=>{throw qn.create("idb-open",{originalErrorMessage:n.message})})),jc}async function Xv(n){try{let e=(await Ng()).transaction(ao),r=await e.objectStore(ao).get(kg(n));return await e.done,r}catch(t){if(t instanceof In)Tn.warn(t.message);else{let e=qn.create("idb-get",{originalErrorMessage:t?.message});Tn.warn(e.message)}}}async function Sg(n,t){try{let r=(await Ng()).transaction(ao,"readwrite");await r.objectStore(ao).put(t,kg(n)),await r.done}catch(e){if(e instanceof In)Tn.warn(e.message);else{let r=qn.create("idb-set",{originalErrorMessage:e?.message});Tn.warn(r.message)}}}function kg(n){return`${n.name}!${n.options.appId}`}var Yv=1024,Zv=30,Wc=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new Hc(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var t,e;try{let s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Rg();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(u=>u.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>Zv){let u=eI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(u,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Tn.warn(r)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=Rg(),{heartbeatsToSend:r,unsentEntries:s}=tI(this._heartbeatsCache.heartbeats),o=io(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(e){return Tn.warn(e),""}}};function Rg(){return new Date().toISOString().substring(0,10)}function tI(n,t=Yv){let e=[],r=n.slice();for(let s of n){let o=e.find(u=>u.agent===s.agent);if(o){if(o.dates.push(s.date),Pg(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Pg(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}var Hc=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Bc()?Tg().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let e=await Xv(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){let s=await this.read();return Sg(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){let s=await this.read();return Sg(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}};function Pg(n){return io(JSON.stringify({version:2,heartbeats:n})).length}function eI(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function nI(n){oo(new En("platform-logger",t=>new zc(t),"PRIVATE")),oo(new En("heartbeat",t=>new Wc(t),"PRIVATE")),ri($c,Ag,n),ri($c,Ag,"esm2017"),ri("fire-js","")}nI("");var Og=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fg={};var An,Jc;(function(){var n;function t(v,m){function y(){}y.prototype=m.prototype,v.D=m.prototype,v.prototype=new y,v.prototype.constructor=v,v.C=function(_,w,A){for(var p=Array(arguments.length-2),Ot=2;Ot<arguments.length;Ot++)p[Ot-2]=arguments[Ot];return m.prototype[w].apply(_,p)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,m,y){y||(y=0);var _=Array(16);if(typeof m=="string")for(var w=0;16>w;++w)_[w]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(w=0;16>w;++w)_[w]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=v.g[0],y=v.g[1],w=v.g[2];var A=v.g[3],p=m+(A^y&(w^A))+_[0]+3614090360&4294967295;m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[1]+3905402710&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[2]+606105819&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[3]+3250441966&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[4]+4118548399&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[5]+1200080426&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[6]+2821735955&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[7]+4249261313&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[8]+1770035416&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[9]+2336552879&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[10]+4294925233&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[11]+2304563134&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[12]+1804603682&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[13]+4254626195&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[14]+2792965006&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[15]+1236535329&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(w^A&(y^w))+_[1]+4129170786&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[6]+3225465664&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[11]+643717713&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[0]+3921069994&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[5]+3593408605&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[10]+38016083&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[15]+3634488961&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[4]+3889429448&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[9]+568446438&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[14]+3275163606&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[3]+4107603335&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[8]+1163531501&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[13]+2850285829&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[2]+4243563512&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[7]+1735328473&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[12]+2368359562&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(y^w^A)+_[5]+4294588738&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[8]+2272392833&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[11]+1839030562&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[14]+4259657740&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[1]+2763975236&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[4]+1272893353&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[7]+4139469664&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[10]+3200236656&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[13]+681279174&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[0]+3936430074&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[3]+3572445317&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[6]+76029189&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[9]+3654602809&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[12]+3873151461&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[15]+530742520&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[2]+3299628645&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(w^(y|~A))+_[0]+4096336452&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[7]+1126891415&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[14]+2878612391&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[5]+4237533241&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[12]+1700485571&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[3]+2399980690&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[10]+4293915773&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[1]+2240044497&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[8]+1873313359&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[15]+4264355552&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[6]+2734768916&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[13]+1309151649&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[4]+4149444226&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[11]+3174756917&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[2]+718787259&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[9]+3951481745&4294967295,v.g[0]=v.g[0]+m&4294967295,v.g[1]=v.g[1]+(w+(p<<21&4294967295|p>>>11))&4294967295,v.g[2]=v.g[2]+w&4294967295,v.g[3]=v.g[3]+A&4294967295}r.prototype.u=function(v,m){m===void 0&&(m=v.length);for(var y=m-this.blockSize,_=this.B,w=this.h,A=0;A<m;){if(w==0)for(;A<=y;)s(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<m;)if(_[w++]=v.charCodeAt(A++),w==this.blockSize){s(this,_),w=0;break}}else for(;A<m;)if(_[w++]=v[A++],w==this.blockSize){s(this,_),w=0;break}}this.h=w,this.o+=m},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var m=1;m<v.length-8;++m)v[m]=0;var y=8*this.o;for(m=v.length-8;m<v.length;++m)v[m]=y&255,y/=256;for(this.u(v),v=Array(16),m=y=0;4>m;++m)for(var _=0;32>_;_+=8)v[y++]=this.g[m]>>>_&255;return v};function o(v,m){var y=l;return Object.prototype.hasOwnProperty.call(y,v)?y[v]:y[v]=m(v)}function u(v,m){this.h=m;for(var y=[],_=!0,w=v.length-1;0<=w;w--){var A=v[w]|0;_&&A==m||(y[w]=A,_=!1)}this.g=y}var l={};function h(v){return-128<=v&&128>v?o(v,function(m){return new u([m|0],0>m?-1:0)}):new u([v|0],0>v?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return E;if(0>v)return P(f(-v));for(var m=[],y=1,_=0;v>=y;_++)m[_]=v/y|0,y*=4294967296;return new u(m,0)}function g(v,m){if(v.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(v.charAt(0)=="-")return P(g(v.substring(1),m));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=f(Math.pow(m,8)),_=E,w=0;w<v.length;w+=8){var A=Math.min(8,v.length-w),p=parseInt(v.substring(w,w+A),m);8>A?(A=f(Math.pow(m,A)),_=_.j(A).add(f(p))):(_=_.j(y),_=_.add(f(p)))}return _}var E=h(0),T=h(1),S=h(16777216);n=u.prototype,n.m=function(){if(V(this))return-P(this).m();for(var v=0,m=1,y=0;y<this.g.length;y++){var _=this.i(y);v+=(0<=_?_:4294967296+_)*m,m*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(C(this))return"0";if(V(this))return"-"+P(this).toString(v);for(var m=f(Math.pow(v,6)),y=this,_="";;){var w=H(y,m).g;y=M(y,w.j(m));var A=((0<y.g.length?y.g[0]:y.h)>>>0).toString(v);if(y=w,C(y))return A+_;for(;6>A.length;)A="0"+A;_=A+_}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function C(v){if(v.h!=0)return!1;for(var m=0;m<v.g.length;m++)if(v.g[m]!=0)return!1;return!0}function V(v){return v.h==-1}n.l=function(v){return v=M(this,v),V(v)?-1:C(v)?0:1};function P(v){for(var m=v.g.length,y=[],_=0;_<m;_++)y[_]=~v.g[_];return new u(y,~v.h).add(T)}n.abs=function(){return V(this)?P(this):this},n.add=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0,w=0;w<=m;w++){var A=_+(this.i(w)&65535)+(v.i(w)&65535),p=(A>>>16)+(this.i(w)>>>16)+(v.i(w)>>>16);_=p>>>16,A&=65535,p&=65535,y[w]=p<<16|A}return new u(y,y[y.length-1]&-2147483648?-1:0)};function M(v,m){return v.add(P(m))}n.j=function(v){if(C(this)||C(v))return E;if(V(this))return V(v)?P(this).j(P(v)):P(P(this).j(v));if(V(v))return P(this.j(P(v)));if(0>this.l(S)&&0>v.l(S))return f(this.m()*v.m());for(var m=this.g.length+v.g.length,y=[],_=0;_<2*m;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(var w=0;w<v.g.length;w++){var A=this.i(_)>>>16,p=this.i(_)&65535,Ot=v.i(w)>>>16,Te=v.i(w)&65535;y[2*_+2*w]+=p*Te,F(y,2*_+2*w),y[2*_+2*w+1]+=A*Te,F(y,2*_+2*w+1),y[2*_+2*w+1]+=p*Ot,F(y,2*_+2*w+1),y[2*_+2*w+2]+=A*Ot,F(y,2*_+2*w+2)}for(_=0;_<m;_++)y[_]=y[2*_+1]<<16|y[2*_];for(_=m;_<2*m;_++)y[_]=0;return new u(y,0)};function F(v,m){for(;(v[m]&65535)!=v[m];)v[m+1]+=v[m]>>>16,v[m]&=65535,m++}function q(v,m){this.g=v,this.h=m}function H(v,m){if(C(m))throw Error("division by zero");if(C(v))return new q(E,E);if(V(v))return m=H(P(v),m),new q(P(m.g),P(m.h));if(V(m))return m=H(v,P(m)),new q(P(m.g),m.h);if(30<v.g.length){if(V(v)||V(m))throw Error("slowDivide_ only works with positive integers.");for(var y=T,_=m;0>=_.l(v);)y=vt(y),_=vt(_);var w=K(y,1),A=K(_,1);for(_=K(_,2),y=K(y,2);!C(_);){var p=A.add(_);0>=p.l(v)&&(w=w.add(y),A=p),_=K(_,1),y=K(y,1)}return m=M(v,w.j(m)),new q(w,m)}for(w=E;0<=v.l(m);){for(y=Math.max(1,Math.floor(v.m()/m.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),A=f(y),p=A.j(m);V(p)||0<p.l(v);)y-=_,A=f(y),p=A.j(m);C(A)&&(A=T),w=w.add(A),v=M(v,p)}return new q(w,v)}n.A=function(v){return H(this,v).h},n.and=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)&v.i(_);return new u(y,this.h&v.h)},n.or=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)|v.i(_);return new u(y,this.h|v.h)},n.xor=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)^v.i(_);return new u(y,this.h^v.h)};function vt(v){for(var m=v.g.length+1,y=[],_=0;_<m;_++)y[_]=v.i(_)<<1|v.i(_-1)>>>31;return new u(y,v.h)}function K(v,m){var y=m>>5;m%=32;for(var _=v.g.length-y,w=[],A=0;A<_;A++)w[A]=0<m?v.i(A+y)>>>m|v.i(A+y+1)<<32-m:v.i(A+y);return new u(w,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Jc=Fg.Md5=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=f,u.fromString=g,An=Fg.Integer=u}).apply(typeof Og<"u"?Og:typeof self<"u"?self:typeof window<"u"?window:{});var fa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bn={};var Xc,rI,ii,Yc,uo,ma,Zc,tl,el;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,a,c){return i==Array.prototype||i==Object.prototype||(i[a]=c.value),i};function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof fa=="object"&&fa];for(var a=0;a<i.length;++a){var c=i[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")}var r=e(this);function s(i,a){if(a)t:{var c=r;i=i.split(".");for(var d=0;d<i.length-1;d++){var I=i[d];if(!(I in c))break t;c=c[I]}i=i[i.length-1],d=c[i],a=a(d),a!=d&&a!=null&&t(c,i,{configurable:!0,writable:!0,value:a})}}function o(i,a){i instanceof String&&(i+="");var c=0,d=!1,I={next:function(){if(!d&&c<i.length){var b=c++;return{value:a(b,i[b]),done:!1}}return d=!0,{done:!0,value:void 0}}};return I[Symbol.iterator]=function(){return I},I}s("Array.prototype.values",function(i){return i||function(){return o(this,function(a,c){return c})}});var u=u||{},l=this||self;function h(i){var a=typeof i;return a=a!="object"?a:i?Array.isArray(i)?"array":a:"null",a=="array"||a=="object"&&typeof i.length=="number"}function f(i){var a=typeof i;return a=="object"&&i!=null||a=="function"}function g(i,a,c){return i.call.apply(i.bind,arguments)}function E(i,a,c){if(!i)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var I=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(I,d),i.apply(a,I)}}return function(){return i.apply(a,arguments)}}function T(i,a,c){return T=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:E,T.apply(null,arguments)}function S(i,a){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();return d.push.apply(d,arguments),i.apply(this,d)}}function C(i,a){function c(){}c.prototype=a.prototype,i.aa=a.prototype,i.prototype=new c,i.prototype.constructor=i,i.Qb=function(d,I,b){for(var R=Array(arguments.length-2),j=2;j<arguments.length;j++)R[j-2]=arguments[j];return a.prototype[I].apply(d,R)}}function V(i){let a=i.length;if(0<a){let c=Array(a);for(let d=0;d<a;d++)c[d]=i[d];return c}return[]}function P(i,a){for(let c=1;c<arguments.length;c++){let d=arguments[c];if(h(d)){let I=i.length||0,b=d.length||0;i.length=I+b;for(let R=0;R<b;R++)i[I+R]=d[R]}else i.push(d)}}class M{constructor(a,c){this.i=a,this.j=c,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function F(i){return/^[\s\xa0]*$/.test(i)}function q(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function H(i){return H[" "](i),i}H[" "]=function(){};var vt=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function K(i,a,c){for(let d in i)a.call(c,i[d],d,i)}function v(i,a){for(let c in i)a.call(void 0,i[c],c,i)}function m(i){let a={};for(let c in i)a[c]=i[c];return a}let y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(i,a){let c,d;for(let I=1;I<arguments.length;I++){d=arguments[I];for(c in d)i[c]=d[c];for(let b=0;b<y.length;b++)c=y[b],Object.prototype.hasOwnProperty.call(d,c)&&(i[c]=d[c])}}function w(i){var a=1;i=i.split(":");let c=[];for(;0<a&&i.length;)c.push(i.shift()),a--;return i.length&&c.push(i.join(":")),c}function A(i){l.setTimeout(()=>{throw i},0)}function p(){var i=ir;let a=null;return i.g&&(a=i.g,i.g=i.g.next,i.g||(i.h=null),a.next=null),a}class Ot{constructor(){this.h=this.g=null}add(a,c){let d=Te.get();d.set(a,c),this.h?this.h.next=d:this.g=d,this.h=d}}var Te=new M(()=>new ec,i=>i.reset());class ec{constructor(){this.next=this.g=this.h=null}set(a,c){this.h=a,this.g=c,this.next=null}reset(){this.next=this.g=this.h=null}}let Ae,be=!1,ir=new Ot,Zi=()=>{let i=l.Promise.resolve(void 0);Ae=()=>{i.then(nc)}};var nc=()=>{for(var i;i=p();){try{i.h.call(i.g)}catch(c){A(c)}var a=Te;a.j(i),100>a.h&&(a.h++,i.next=a.g,a.g=i)}be=!1};function jt(){this.s=this.s,this.C=this.C}jt.prototype.s=!1,jt.prototype.ma=function(){this.s||(this.s=!0,this.N())},jt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function lt(i,a){this.type=i,this.g=this.target=a,this.defaultPrevented=!1}lt.prototype.h=function(){this.defaultPrevented=!0};var rc=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,a=Object.defineProperty({},"passive",{get:function(){i=!0}});try{let c=()=>{};l.addEventListener("test",c,a),l.removeEventListener("test",c,a)}catch{}return i})();function Se(i,a){if(lt.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var c=this.type=i.type,d=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=a,a=i.relatedTarget){if(vt){t:{try{H(a.nodeName);var I=!0;break t}catch{}I=!1}I||(a=null)}}else c=="mouseover"?a=i.fromElement:c=="mouseout"&&(a=i.toElement);this.relatedTarget=a,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:ic[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&Se.aa.h.call(this)}}C(Se,lt);var ic={2:"touch",3:"pen",4:"mouse"};Se.prototype.h=function(){Se.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Re="closure_listenable_"+(1e6*Math.random()|0),sc=0;function oc(i,a,c,d,I){this.listener=i,this.proxy=null,this.src=a,this.type=c,this.capture=!!d,this.ha=I,this.key=++sc,this.da=this.fa=!1}function nn(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function rn(i){this.src=i,this.g={},this.h=0}rn.prototype.add=function(i,a,c,d,I){var b=i.toString();i=this.g[b],i||(i=this.g[b]=[],this.h++);var R=or(i,a,d,I);return-1<R?(a=i[R],c||(a.fa=!1)):(a=new oc(a,this.src,b,!!d,I),a.fa=c,i.push(a)),a};function sr(i,a){var c=a.type;if(c in i.g){var d=i.g[c],I=Array.prototype.indexOf.call(d,a,void 0),b;(b=0<=I)&&Array.prototype.splice.call(d,I,1),b&&(nn(a),i.g[c].length==0&&(delete i.g[c],i.h--))}}function or(i,a,c,d){for(var I=0;I<i.length;++I){var b=i[I];if(!b.da&&b.listener==a&&b.capture==!!c&&b.ha==d)return I}return-1}var ar="closure_lm_"+(1e6*Math.random()|0),ur={};function ts(i,a,c,d,I){if(d&&d.once)return ns(i,a,c,d,I);if(Array.isArray(a)){for(var b=0;b<a.length;b++)ts(i,a[b],c,d,I);return null}return c=dr(c),i&&i[Re]?i.K(a,c,f(d)?!!d.capture:!!d,I):es(i,a,c,!1,d,I)}function es(i,a,c,d,I,b){if(!a)throw Error("Invalid event type");var R=f(I)?!!I.capture:!!I,j=lr(i);if(j||(i[ar]=j=new rn(i)),c=j.add(a,c,d,R,b),c.proxy)return c;if(d=ac(),c.proxy=d,d.src=i,d.listener=c,i.addEventListener)rc||(I=R),I===void 0&&(I=!1),i.addEventListener(a.toString(),d,I);else if(i.attachEvent)i.attachEvent(is(a.toString()),d);else if(i.addListener&&i.removeListener)i.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return c}function ac(){function i(c){return a.call(i.src,i.listener,c)}let a=uc;return i}function ns(i,a,c,d,I){if(Array.isArray(a)){for(var b=0;b<a.length;b++)ns(i,a[b],c,d,I);return null}return c=dr(c),i&&i[Re]?i.L(a,c,f(d)?!!d.capture:!!d,I):es(i,a,c,!0,d,I)}function rs(i,a,c,d,I){if(Array.isArray(a))for(var b=0;b<a.length;b++)rs(i,a[b],c,d,I);else d=f(d)?!!d.capture:!!d,c=dr(c),i&&i[Re]?(i=i.i,a=String(a).toString(),a in i.g&&(b=i.g[a],c=or(b,c,d,I),-1<c&&(nn(b[c]),Array.prototype.splice.call(b,c,1),b.length==0&&(delete i.g[a],i.h--)))):i&&(i=lr(i))&&(a=i.g[a.toString()],i=-1,a&&(i=or(a,c,d,I)),(c=-1<i?a[i]:null)&&cr(c))}function cr(i){if(typeof i!="number"&&i&&!i.da){var a=i.src;if(a&&a[Re])sr(a.i,i);else{var c=i.type,d=i.proxy;a.removeEventListener?a.removeEventListener(c,d,i.capture):a.detachEvent?a.detachEvent(is(c),d):a.addListener&&a.removeListener&&a.removeListener(d),(c=lr(a))?(sr(c,i),c.h==0&&(c.src=null,a[ar]=null)):nn(i)}}}function is(i){return i in ur?ur[i]:ur[i]="on"+i}function uc(i,a){if(i.da)i=!0;else{a=new Se(a,this);var c=i.listener,d=i.ha||i.src;i.fa&&cr(i),i=c.call(d,a)}return i}function lr(i){return i=i[ar],i instanceof rn?i:null}var hr="__closure_events_fn_"+(1e9*Math.random()>>>0);function dr(i){return typeof i=="function"?i:(i[hr]||(i[hr]=function(a){return i.handleEvent(a)}),i[hr])}function ht(){jt.call(this),this.i=new rn(this),this.M=this,this.F=null}C(ht,jt),ht.prototype[Re]=!0,ht.prototype.removeEventListener=function(i,a,c,d){rs(this,i,a,c,d)};function gt(i,a){var c,d=i.F;if(d)for(c=[];d;d=d.F)c.push(d);if(i=i.M,d=a.type||a,typeof a=="string")a=new lt(a,i);else if(a instanceof lt)a.target=a.target||i;else{var I=a;a=new lt(d,i),_(a,I)}if(I=!0,c)for(var b=c.length-1;0<=b;b--){var R=a.g=c[b];I=sn(R,d,!0,a)&&I}if(R=a.g=i,I=sn(R,d,!0,a)&&I,I=sn(R,d,!1,a)&&I,c)for(b=0;b<c.length;b++)R=a.g=c[b],I=sn(R,d,!1,a)&&I}ht.prototype.N=function(){if(ht.aa.N.call(this),this.i){var i=this.i,a;for(a in i.g){for(var c=i.g[a],d=0;d<c.length;d++)nn(c[d]);delete i.g[a],i.h--}}this.F=null},ht.prototype.K=function(i,a,c,d){return this.i.add(String(i),a,!1,c,d)},ht.prototype.L=function(i,a,c,d){return this.i.add(String(i),a,!0,c,d)};function sn(i,a,c,d){if(a=i.i.g[String(a)],!a)return!0;a=a.concat();for(var I=!0,b=0;b<a.length;++b){var R=a[b];if(R&&!R.da&&R.capture==c){var j=R.listener,st=R.ha||R.src;R.fa&&sr(i.i,R),I=j.call(st,d)!==!1&&I}}return I&&!d.defaultPrevented}function ss(i,a,c){if(typeof i=="function")c&&(i=T(i,c));else if(i&&typeof i.handleEvent=="function")i=T(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(a)?-1:l.setTimeout(i,a||0)}function os(i){i.g=ss(()=>{i.g=null,i.i&&(i.i=!1,os(i))},i.l);let a=i.h;i.h=null,i.m.apply(null,a)}class cc extends jt{constructor(a,c){super(),this.m=a,this.l=c,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:os(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pe(i){jt.call(this),this.h=i,this.g={}}C(Pe,jt);var as=[];function us(i){K(i.g,function(a,c){this.g.hasOwnProperty(c)&&cr(a)},i),i.g={}}Pe.prototype.N=function(){Pe.aa.N.call(this),us(this)},Pe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fr=l.JSON.stringify,lc=l.JSON.parse,hc=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function mr(){}mr.prototype.h=null;function cs(i){return i.h||(i.h=i.i())}function ls(){}var Ce={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function gr(){lt.call(this,"d")}C(gr,lt);function pr(){lt.call(this,"c")}C(pr,lt);var Yt={},hs=null;function on(){return hs=hs||new ht}Yt.La="serverreachability";function ds(i){lt.call(this,Yt.La,i)}C(ds,lt);function Ve(i){let a=on();gt(a,new ds(a))}Yt.STAT_EVENT="statevent";function fs(i,a){lt.call(this,Yt.STAT_EVENT,i),this.stat=a}C(fs,lt);function pt(i){let a=on();gt(a,new fs(a,i))}Yt.Ma="timingevent";function ms(i,a){lt.call(this,Yt.Ma,i),this.size=a}C(ms,lt);function xe(i,a){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},a)}function De(){this.g=!0}De.prototype.xa=function(){this.g=!1};function dc(i,a,c,d,I,b){i.info(function(){if(i.g)if(b)for(var R="",j=b.split("&"),st=0;st<j.length;st++){var B=j[st].split("=");if(1<B.length){var dt=B[0];B=B[1];var ft=dt.split("_");R=2<=ft.length&&ft[1]=="type"?R+(dt+"="+B+"&"):R+(dt+"=redacted&")}}else R=null;else R=b;return"XMLHTTP REQ ("+d+") [attempt "+I+"]: "+a+`
`+c+`
`+R})}function fc(i,a,c,d,I,b,R){i.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+I+"]: "+a+`
`+c+`
`+b+" "+R})}function oe(i,a,c,d){i.info(function(){return"XMLHTTP TEXT ("+a+"): "+gc(i,c)+(d?" "+d:"")})}function mc(i,a){i.info(function(){return"TIMEOUT: "+a})}De.prototype.info=function(){};function gc(i,a){if(!i.g)return a;if(!a)return null;try{var c=JSON.parse(a);if(c){for(i=0;i<c.length;i++)if(Array.isArray(c[i])){var d=c[i];if(!(2>d.length)){var I=d[1];if(Array.isArray(I)&&!(1>I.length)){var b=I[0];if(b!="noop"&&b!="stop"&&b!="close")for(var R=1;R<I.length;R++)I[R]=""}}}}return fr(c)}catch{return a}}var an={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},gs={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},yr;function un(){}C(un,mr),un.prototype.g=function(){return new XMLHttpRequest},un.prototype.i=function(){return{}},yr=new un;function zt(i,a,c,d){this.j=i,this.i=a,this.l=c,this.R=d||1,this.U=new Pe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ps}function ps(){this.i=null,this.g="",this.h=!1}var ys={},_r={};function wr(i,a,c){i.L=1,i.v=dn(Ft(a)),i.m=c,i.P=!0,_s(i,null)}function _s(i,a){i.F=Date.now(),cn(i),i.A=Ft(i.v);var c=i.A,d=i.R;Array.isArray(d)||(d=[String(d)]),Ds(c.i,"t",d),i.C=0,c=i.j.J,i.h=new ps,i.g=Js(i.j,c?a:null,!i.m),0<i.O&&(i.M=new cc(T(i.Y,i,i.g),i.O)),a=i.U,c=i.g,d=i.ca;var I="readystatechange";Array.isArray(I)||(I&&(as[0]=I.toString()),I=as);for(var b=0;b<I.length;b++){var R=ts(c,I[b],d||a.handleEvent,!1,a.h||a);if(!R)break;a.g[R.key]=R}a=i.H?m(i.H):{},i.m?(i.u||(i.u="POST"),a["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,a)):(i.u="GET",i.g.ea(i.A,i.u,null,a)),Ve(),dc(i.i,i.u,i.A,i.l,i.R,i.m)}zt.prototype.ca=function(i){i=i.target;let a=this.M;a&&Mt(i)==3?a.j():this.Y(i)},zt.prototype.Y=function(i){try{if(i==this.g)t:{let ft=Mt(this.g);var a=this.g.Ba();let ce=this.g.Z();if(!(3>ft)&&(ft!=3||this.g&&(this.h.h||this.g.oa()||qs(this.g)))){this.J||ft!=4||a==7||(a==8||0>=ce?Ve(3):Ve(2)),vr(this);var c=this.g.Z();this.X=c;e:if(ws(this)){var d=qs(this.g);i="";var I=d.length,b=Mt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Zt(this),Ne(this);var R="";break e}this.h.i=new l.TextDecoder}for(a=0;a<I;a++)this.h.h=!0,i+=this.h.i.decode(d[a],{stream:!(b&&a==I-1)});d.length=0,this.h.g+=i,this.C=0,R=this.h.g}else R=this.g.oa();if(this.o=c==200,fc(this.i,this.u,this.A,this.l,this.R,ft,c),this.o){if(this.T&&!this.K){e:{if(this.g){var j,st=this.g;if((j=st.g?st.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(j)){var B=j;break e}}B=null}if(c=B)oe(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ir(this,c);else{this.o=!1,this.s=3,pt(12),Zt(this),Ne(this);break t}}if(this.P){c=!0;let Tt;for(;!this.J&&this.C<R.length;)if(Tt=pc(this,R),Tt==_r){ft==4&&(this.s=4,pt(14),c=!1),oe(this.i,this.l,null,"[Incomplete Response]");break}else if(Tt==ys){this.s=4,pt(15),oe(this.i,this.l,R,"[Invalid Chunk]"),c=!1;break}else oe(this.i,this.l,Tt,null),Ir(this,Tt);if(ws(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ft!=4||R.length!=0||this.h.h||(this.s=1,pt(16),c=!1),this.o=this.o&&c,!c)oe(this.i,this.l,R,"[Invalid Chunked Response]"),Zt(this),Ne(this);else if(0<R.length&&!this.W){this.W=!0;var dt=this.j;dt.g==this&&dt.ba&&!dt.M&&(dt.j.info("Great, no buffering proxy detected. Bytes received: "+R.length),Rr(dt),dt.M=!0,pt(11))}}else oe(this.i,this.l,R,null),Ir(this,R);ft==4&&Zt(this),this.o&&!this.J&&(ft==4?Ks(this.j,this):(this.o=!1,cn(this)))}else Nc(this.g),c==400&&0<R.indexOf("Unknown SID")?(this.s=3,pt(12)):(this.s=0,pt(13)),Zt(this),Ne(this)}}}catch{}finally{}};function ws(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function pc(i,a){var c=i.C,d=a.indexOf(`
`,c);return d==-1?_r:(c=Number(a.substring(c,d)),isNaN(c)?ys:(d+=1,d+c>a.length?_r:(a=a.slice(d,d+c),i.C=d+c,a)))}zt.prototype.cancel=function(){this.J=!0,Zt(this)};function cn(i){i.S=Date.now()+i.I,vs(i,i.I)}function vs(i,a){if(i.B!=null)throw Error("WatchDog timer not null");i.B=xe(T(i.ba,i),a)}function vr(i){i.B&&(l.clearTimeout(i.B),i.B=null)}zt.prototype.ba=function(){this.B=null;let i=Date.now();0<=i-this.S?(mc(this.i,this.A),this.L!=2&&(Ve(),pt(17)),Zt(this),this.s=2,Ne(this)):vs(this,this.S-i)};function Ne(i){i.j.G==0||i.J||Ks(i.j,i)}function Zt(i){vr(i);var a=i.M;a&&typeof a.ma=="function"&&a.ma(),i.M=null,us(i.U),i.g&&(a=i.g,i.g=null,a.abort(),a.ma())}function Ir(i,a){try{var c=i.j;if(c.G!=0&&(c.g==i||Er(c.h,i))){if(!i.K&&Er(c.h,i)&&c.G==3){try{var d=c.Da.g.parse(a)}catch{d=null}if(Array.isArray(d)&&d.length==3){var I=d;if(I[0]==0){t:if(!c.u){if(c.g)if(c.g.F+3e3<i.F)yn(c),gn(c);else break t;Sr(c),pt(18)}}else c.za=I[1],0<c.za-c.T&&37500>I[2]&&c.F&&c.v==0&&!c.C&&(c.C=xe(T(c.Za,c),6e3));if(1>=Ts(c.h)&&c.ca){try{c.ca()}catch{}c.ca=void 0}}else ee(c,11)}else if((i.K||c.g==i)&&yn(c),!F(a))for(I=c.Da.g.parse(a),a=0;a<I.length;a++){let B=I[a];if(c.T=B[0],B=B[1],c.G==2)if(B[0]=="c"){c.K=B[1],c.ia=B[2];let dt=B[3];dt!=null&&(c.la=dt,c.j.info("VER="+c.la));let ft=B[4];ft!=null&&(c.Aa=ft,c.j.info("SVER="+c.Aa));let ce=B[5];ce!=null&&typeof ce=="number"&&0<ce&&(d=1.5*ce,c.L=d,c.j.info("backChannelRequestTimeoutMs_="+d)),d=c;let Tt=i.g;if(Tt){let wn=Tt.g?Tt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wn){var b=d.h;b.g||wn.indexOf("spdy")==-1&&wn.indexOf("quic")==-1&&wn.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(Tr(b,b.h),b.h=null))}if(d.D){let Pr=Tt.g?Tt.g.getResponseHeader("X-HTTP-Session-Id"):null;Pr&&(d.ya=Pr,Q(d.I,d.D,Pr))}}c.G=3,c.l&&c.l.ua(),c.ba&&(c.R=Date.now()-i.F,c.j.info("Handshake RTT: "+c.R+"ms")),d=c;var R=i;if(d.qa=Hs(d,d.J?d.ia:null,d.W),R.K){As(d.h,R);var j=R,st=d.L;st&&(j.I=st),j.B&&(vr(j),cn(j)),d.g=R}else $s(d);0<c.i.length&&pn(c)}else B[0]!="stop"&&B[0]!="close"||ee(c,7);else c.G==3&&(B[0]=="stop"||B[0]=="close"?B[0]=="stop"?ee(c,7):br(c):B[0]!="noop"&&c.l&&c.l.ta(B),c.v=0)}}Ve(4)}catch{}}var yc=class{constructor(i,a){this.g=i,this.map=a}};function Is(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Es(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Ts(i){return i.h?1:i.g?i.g.size:0}function Er(i,a){return i.h?i.h==a:i.g?i.g.has(a):!1}function Tr(i,a){i.g?i.g.add(a):i.h=a}function As(i,a){i.h&&i.h==a?i.h=null:i.g&&i.g.has(a)&&i.g.delete(a)}Is.prototype.cancel=function(){if(this.i=bs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let i of this.g.values())i.cancel();this.g.clear()}};function bs(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let a=i.i;for(let c of i.g.values())a=a.concat(c.D);return a}return V(i.i)}function _c(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(h(i)){for(var a=[],c=i.length,d=0;d<c;d++)a.push(i[d]);return a}a=[],c=0;for(d in i)a[c++]=i[d];return a}function wc(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(h(i)||typeof i=="string"){var a=[];i=i.length;for(var c=0;c<i;c++)a.push(c);return a}a=[],c=0;for(let d in i)a[c++]=d;return a}}}function Ss(i,a){if(i.forEach&&typeof i.forEach=="function")i.forEach(a,void 0);else if(h(i)||typeof i=="string")Array.prototype.forEach.call(i,a,void 0);else for(var c=wc(i),d=_c(i),I=d.length,b=0;b<I;b++)a.call(void 0,d[b],c&&c[b],i)}var Rs=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vc(i,a){if(i){i=i.split("&");for(var c=0;c<i.length;c++){var d=i[c].indexOf("="),I=null;if(0<=d){var b=i[c].substring(0,d);I=i[c].substring(d+1)}else b=i[c];a(b,I?decodeURIComponent(I.replace(/\+/g," ")):"")}}}function te(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof te){this.h=i.h,ln(this,i.j),this.o=i.o,this.g=i.g,hn(this,i.s),this.l=i.l;var a=i.i,c=new Fe;c.i=a.i,a.g&&(c.g=new Map(a.g),c.h=a.h),Ps(this,c),this.m=i.m}else i&&(a=String(i).match(Rs))?(this.h=!1,ln(this,a[1]||"",!0),this.o=ke(a[2]||""),this.g=ke(a[3]||"",!0),hn(this,a[4]),this.l=ke(a[5]||"",!0),Ps(this,a[6]||"",!0),this.m=ke(a[7]||"")):(this.h=!1,this.i=new Fe(null,this.h))}te.prototype.toString=function(){var i=[],a=this.j;a&&i.push(Oe(a,Cs,!0),":");var c=this.g;return(c||a=="file")&&(i.push("//"),(a=this.o)&&i.push(Oe(a,Cs,!0),"@"),i.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.s,c!=null&&i.push(":",String(c))),(c=this.l)&&(this.g&&c.charAt(0)!="/"&&i.push("/"),i.push(Oe(c,c.charAt(0)=="/"?Tc:Ec,!0))),(c=this.i.toString())&&i.push("?",c),(c=this.m)&&i.push("#",Oe(c,bc)),i.join("")};function Ft(i){return new te(i)}function ln(i,a,c){i.j=c?ke(a,!0):a,i.j&&(i.j=i.j.replace(/:$/,""))}function hn(i,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);i.s=a}else i.s=null}function Ps(i,a,c){a instanceof Fe?(i.i=a,Sc(i.i,i.h)):(c||(a=Oe(a,Ac)),i.i=new Fe(a,i.h))}function Q(i,a,c){i.i.set(a,c)}function dn(i){return Q(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function ke(i,a){return i?a?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Oe(i,a,c){return typeof i=="string"?(i=encodeURI(i).replace(a,Ic),c&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Ic(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Cs=/[#\/\?@]/g,Ec=/[#\?:]/g,Tc=/[#\?]/g,Ac=/[#\?@]/g,bc=/#/g;function Fe(i,a){this.h=this.g=null,this.i=i||null,this.j=!!a}function $t(i){i.g||(i.g=new Map,i.h=0,i.i&&vc(i.i,function(a,c){i.add(decodeURIComponent(a.replace(/\+/g," ")),c)}))}n=Fe.prototype,n.add=function(i,a){$t(this),this.i=null,i=ae(this,i);var c=this.g.get(i);return c||this.g.set(i,c=[]),c.push(a),this.h+=1,this};function Vs(i,a){$t(i),a=ae(i,a),i.g.has(a)&&(i.i=null,i.h-=i.g.get(a).length,i.g.delete(a))}function xs(i,a){return $t(i),a=ae(i,a),i.g.has(a)}n.forEach=function(i,a){$t(this),this.g.forEach(function(c,d){c.forEach(function(I){i.call(a,I,d,this)},this)},this)},n.na=function(){$t(this);let i=Array.from(this.g.values()),a=Array.from(this.g.keys()),c=[];for(let d=0;d<a.length;d++){let I=i[d];for(let b=0;b<I.length;b++)c.push(a[d])}return c},n.V=function(i){$t(this);let a=[];if(typeof i=="string")xs(this,i)&&(a=a.concat(this.g.get(ae(this,i))));else{i=Array.from(this.g.values());for(let c=0;c<i.length;c++)a=a.concat(i[c])}return a},n.set=function(i,a){return $t(this),this.i=null,i=ae(this,i),xs(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[a]),this.h+=1,this},n.get=function(i,a){return i?(i=this.V(i),0<i.length?String(i[0]):a):a};function Ds(i,a,c){Vs(i,a),0<c.length&&(i.i=null,i.g.set(ae(i,a),V(c)),i.h+=c.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let i=[],a=Array.from(this.g.keys());for(var c=0;c<a.length;c++){var d=a[c];let b=encodeURIComponent(String(d)),R=this.V(d);for(d=0;d<R.length;d++){var I=b;R[d]!==""&&(I+="="+encodeURIComponent(String(R[d]))),i.push(I)}}return this.i=i.join("&")};function ae(i,a){return a=String(a),i.j&&(a=a.toLowerCase()),a}function Sc(i,a){a&&!i.j&&($t(i),i.i=null,i.g.forEach(function(c,d){var I=d.toLowerCase();d!=I&&(Vs(this,d),Ds(this,I,c))},i)),i.j=a}function Rc(i,a){let c=new De;if(l.Image){let d=new Image;d.onload=S(Gt,c,"TestLoadImage: loaded",!0,a,d),d.onerror=S(Gt,c,"TestLoadImage: error",!1,a,d),d.onabort=S(Gt,c,"TestLoadImage: abort",!1,a,d),d.ontimeout=S(Gt,c,"TestLoadImage: timeout",!1,a,d),l.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=i}else a(!1)}function Pc(i,a){let c=new De,d=new AbortController,I=setTimeout(()=>{d.abort(),Gt(c,"TestPingServer: timeout",!1,a)},1e4);fetch(i,{signal:d.signal}).then(b=>{clearTimeout(I),b.ok?Gt(c,"TestPingServer: ok",!0,a):Gt(c,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(I),Gt(c,"TestPingServer: error",!1,a)})}function Gt(i,a,c,d,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),d(c)}catch{}}function Cc(){this.g=new hc}function Vc(i,a,c){let d=c||"";try{Ss(i,function(I,b){let R=I;f(I)&&(R=fr(I)),a.push(d+b+"="+encodeURIComponent(R))})}catch(I){throw a.push(d+"type="+encodeURIComponent("_badmap")),I}}function Me(i){this.l=i.Ub||null,this.j=i.eb||!1}C(Me,mr),Me.prototype.g=function(){return new fn(this.l,this.j)},Me.prototype.i=(function(i){return function(){return i}})({});function fn(i,a){ht.call(this),this.D=i,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(fn,ht),n=fn.prototype,n.open=function(i,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=a,this.readyState=1,qe(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let a={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(a.body=i),(this.D||l).fetch(new Request(this.A,a)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Le(this)),this.readyState=0},n.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,qe(this)),this.g&&(this.readyState=3,qe(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ns(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ns(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}n.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var a=i.value?i.value:new Uint8Array(0);(a=this.v.decode(a,{stream:!i.done}))&&(this.response=this.responseText+=a)}i.done?Le(this):qe(this),this.readyState==3&&Ns(this)}},n.Ra=function(i){this.g&&(this.response=this.responseText=i,Le(this))},n.Qa=function(i){this.g&&(this.response=i,Le(this))},n.ga=function(){this.g&&Le(this)};function Le(i){i.readyState=4,i.l=null,i.j=null,i.v=null,qe(i)}n.setRequestHeader=function(i,a){this.u.append(i,a)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let i=[],a=this.h.entries();for(var c=a.next();!c.done;)c=c.value,i.push(c[0]+": "+c[1]),c=a.next();return i.join(`\r
`)};function qe(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(fn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ks(i){let a="";return K(i,function(c,d){a+=d,a+=":",a+=c,a+=`\r
`}),a}function Ar(i,a,c){t:{for(d in c){var d=!1;break t}d=!0}d||(c=ks(c),typeof i=="string"?c!=null&&encodeURIComponent(String(c)):Q(i,a,c))}function Z(i){ht.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(Z,ht);var xc=/^https?$/i,Dc=["POST","PUT"];n=Z.prototype,n.Ha=function(i){this.J=i},n.ea=function(i,a,c,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);a=a?a.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():yr.g(),this.v=this.o?cs(this.o):cs(yr),this.g.onreadystatechange=T(this.Ea,this);try{this.B=!0,this.g.open(a,String(i),!0),this.B=!1}catch(b){Os(this,b);return}if(i=c||"",c=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var I in d)c.set(I,d[I]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let b of d.keys())c.set(b,d.get(b));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(c.keys()).find(b=>b.toLowerCase()=="content-type"),I=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Dc,a,void 0))||d||I||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,R]of c)this.g.setRequestHeader(b,R);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ls(this),this.u=!0,this.g.send(i),this.u=!1}catch(b){Os(this,b)}};function Os(i,a){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=a,i.m=5,Fs(i),mn(i)}function Fs(i){i.A||(i.A=!0,gt(i,"complete"),gt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,gt(this,"complete"),gt(this,"abort"),mn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),mn(this,!0)),Z.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ms(this):this.bb())},n.bb=function(){Ms(this)};function Ms(i){if(i.h&&typeof u<"u"&&(!i.v[1]||Mt(i)!=4||i.Z()!=2)){if(i.u&&Mt(i)==4)ss(i.Ea,0,i);else if(gt(i,"readystatechange"),Mt(i)==4){i.h=!1;try{let R=i.Z();t:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break t;default:a=!1}var c;if(!(c=a)){var d;if(d=R===0){var I=String(i.D).match(Rs)[1]||null;!I&&l.self&&l.self.location&&(I=l.self.location.protocol.slice(0,-1)),d=!xc.test(I?I.toLowerCase():"")}c=d}if(c)gt(i,"complete"),gt(i,"success");else{i.m=6;try{var b=2<Mt(i)?i.g.statusText:""}catch{b=""}i.l=b+" ["+i.Z()+"]",Fs(i)}}finally{mn(i)}}}}function mn(i,a){if(i.g){Ls(i);let c=i.g,d=i.v[0]?()=>{}:null;i.g=null,i.v=null,a||gt(i,"ready");try{c.onreadystatechange=d}catch{}}}function Ls(i){i.I&&(l.clearTimeout(i.I),i.I=null)}n.isActive=function(){return!!this.g};function Mt(i){return i.g?i.g.readyState:0}n.Z=function(){try{return 2<Mt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(i){if(this.g){var a=this.g.responseText;return i&&a.indexOf(i)==0&&(a=a.substring(i.length)),lc(a)}};function qs(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Nc(i){let a={};i=(i.g&&2<=Mt(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<i.length;d++){if(F(i[d]))continue;var c=w(i[d]);let I=c[0];if(c=c[1],typeof c!="string")continue;c=c.trim();let b=a[I]||[];a[I]=b,b.push(c)}v(a,function(d){return d.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Be(i,a,c){return c&&c.internalChannelParams&&c.internalChannelParams[i]||a}function Bs(i){this.Aa=0,this.i=[],this.j=new De,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Be("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Be("baseRetryDelayMs",5e3,i),this.cb=Be("retryDelaySeedMs",1e4,i),this.Wa=Be("forwardChannelMaxRetries",2,i),this.wa=Be("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new Is(i&&i.concurrentRequestLimit),this.Da=new Cc,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Bs.prototype,n.la=8,n.G=1,n.connect=function(i,a,c,d){pt(0),this.W=i,this.H=a||{},c&&d!==void 0&&(this.H.OSID=c,this.H.OAID=d),this.F=this.X,this.I=Hs(this,null,this.W),pn(this)};function br(i){if(Us(i),i.G==3){var a=i.U++,c=Ft(i.I);if(Q(c,"SID",i.K),Q(c,"RID",a),Q(c,"TYPE","terminate"),Ue(i,c),a=new zt(i,i.j,a),a.L=2,a.v=dn(Ft(c)),c=!1,l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(a.v.toString(),"")}catch{}!c&&l.Image&&(new Image().src=a.v,c=!0),c||(a.g=Js(a.j,null),a.g.ea(a.v)),a.F=Date.now(),cn(a)}Ws(i)}function gn(i){i.g&&(Rr(i),i.g.cancel(),i.g=null)}function Us(i){gn(i),i.u&&(l.clearTimeout(i.u),i.u=null),yn(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function pn(i){if(!Es(i.h)&&!i.s){i.s=!0;var a=i.Ga;Ae||Zi(),be||(Ae(),be=!0),ir.add(a,i),i.B=0}}function kc(i,a){return Ts(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=a.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=xe(T(i.Ga,i,a),Qs(i,i.B)),i.B++,!0)}n.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;let I=new zt(this,this.j,i),b=this.o;if(this.S&&(b?(b=m(b),_(b,this.S)):b=this.S),this.m!==null||this.O||(I.H=b,b=null),this.P)t:{for(var a=0,c=0;c<this.i.length;c++){e:{var d=this.i[c];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break e}d=void 0}if(d===void 0)break;if(a+=d,4096<a){a=c;break t}if(a===4096||c===this.i.length-1){a=c+1;break t}}a=1e3}else a=1e3;a=zs(this,I,a),c=Ft(this.I),Q(c,"RID",i),Q(c,"CVER",22),this.D&&Q(c,"X-HTTP-Session-Id",this.D),Ue(this,c),b&&(this.O?a="headers="+encodeURIComponent(String(ks(b)))+"&"+a:this.m&&Ar(c,this.m,b)),Tr(this.h,I),this.Ua&&Q(c,"TYPE","init"),this.P?(Q(c,"$req",a),Q(c,"SID","null"),I.T=!0,wr(I,c,null)):wr(I,c,a),this.G=2}}else this.G==3&&(i?js(this,i):this.i.length==0||Es(this.h)||js(this))};function js(i,a){var c;a?c=a.l:c=i.U++;let d=Ft(i.I);Q(d,"SID",i.K),Q(d,"RID",c),Q(d,"AID",i.T),Ue(i,d),i.m&&i.o&&Ar(d,i.m,i.o),c=new zt(i,i.j,c,i.B+1),i.m===null&&(c.H=i.o),a&&(i.i=a.D.concat(i.i)),a=zs(i,c,1e3),c.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),Tr(i.h,c),wr(c,d,a)}function Ue(i,a){i.H&&K(i.H,function(c,d){Q(a,d,c)}),i.l&&Ss({},function(c,d){Q(a,d,c)})}function zs(i,a,c){c=Math.min(i.i.length,c);var d=i.l?T(i.l.Na,i.l,i):null;t:{var I=i.i;let b=-1;for(;;){let R=["count="+c];b==-1?0<c?(b=I[0].g,R.push("ofs="+b)):b=0:R.push("ofs="+b);let j=!0;for(let st=0;st<c;st++){let B=I[st].g,dt=I[st].map;if(B-=b,0>B)b=Math.max(0,I[st].g-100),j=!1;else try{Vc(dt,R,"req"+B+"_")}catch{d&&d(dt)}}if(j){d=R.join("&");break t}}}return i=i.i.splice(0,c),a.D=i,d}function $s(i){if(!i.g&&!i.u){i.Y=1;var a=i.Fa;Ae||Zi(),be||(Ae(),be=!0),ir.add(a,i),i.v=0}}function Sr(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=xe(T(i.Fa,i),Qs(i,i.v)),i.v++,!0)}n.Fa=function(){if(this.u=null,Gs(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=xe(T(this.ab,this),i)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,pt(10),gn(this),Gs(this))};function Rr(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function Gs(i){i.g=new zt(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var a=Ft(i.qa);Q(a,"RID","rpc"),Q(a,"SID",i.K),Q(a,"AID",i.T),Q(a,"CI",i.F?"0":"1"),!i.F&&i.ja&&Q(a,"TO",i.ja),Q(a,"TYPE","xmlhttp"),Ue(i,a),i.m&&i.o&&Ar(a,i.m,i.o),i.L&&(i.g.I=i.L);var c=i.g;i=i.ia,c.L=1,c.v=dn(Ft(a)),c.m=null,c.P=!0,_s(c,i)}n.Za=function(){this.C!=null&&(this.C=null,gn(this),Sr(this),pt(19))};function yn(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function Ks(i,a){var c=null;if(i.g==a){yn(i),Rr(i),i.g=null;var d=2}else if(Er(i.h,a))c=a.D,As(i.h,a),d=1;else return;if(i.G!=0){if(a.o)if(d==1){c=a.m?a.m.length:0,a=Date.now()-a.F;var I=i.B;d=on(),gt(d,new ms(d,c)),pn(i)}else $s(i);else if(I=a.s,I==3||I==0&&0<a.X||!(d==1&&kc(i,a)||d==2&&Sr(i)))switch(c&&0<c.length&&(a=i.h,a.i=a.i.concat(c)),I){case 1:ee(i,5);break;case 4:ee(i,10);break;case 3:ee(i,6);break;default:ee(i,2)}}}function Qs(i,a){let c=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(c*=2),c*a}function ee(i,a){if(i.j.info("Error code "+a),a==2){var c=T(i.fb,i),d=i.Xa;let I=!d;d=new te(d||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||ln(d,"https"),dn(d),I?Rc(d.toString(),c):Pc(d.toString(),c)}else pt(2);i.G=0,i.l&&i.l.sa(a),Ws(i),Us(i)}n.fb=function(i){i?(this.j.info("Successfully pinged google.com"),pt(2)):(this.j.info("Failed to ping google.com"),pt(1))};function Ws(i){if(i.G=0,i.ka=[],i.l){let a=bs(i.h);(a.length!=0||i.i.length!=0)&&(P(i.ka,a),P(i.ka,i.i),i.h.i.length=0,V(i.i),i.i.length=0),i.l.ra()}}function Hs(i,a,c){var d=c instanceof te?Ft(c):new te(c);if(d.g!="")a&&(d.g=a+"."+d.g),hn(d,d.s);else{var I=l.location;d=I.protocol,a=a?a+"."+I.hostname:I.hostname,I=+I.port;var b=new te(null);d&&ln(b,d),a&&(b.g=a),I&&hn(b,I),c&&(b.l=c),d=b}return c=i.D,a=i.ya,c&&a&&Q(d,c,a),Q(d,"VER",i.la),Ue(i,d),d}function Js(i,a,c){if(a&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return a=i.Ca&&!i.pa?new Z(new Me({eb:c})):new Z(i.pa),a.Ha(i.J),a}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Xs(){}n=Xs.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function _n(){}_n.prototype.g=function(i,a){return new _t(i,a)};function _t(i,a){ht.call(this),this.g=new Bs(a),this.l=i,this.h=a&&a.messageUrlParams||null,i=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(i?i["X-WebChannel-Content-Type"]=a.messageContentType:i={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.va&&(i?i["X-WebChannel-Client-Profile"]=a.va:i={"X-WebChannel-Client-Profile":a.va}),this.g.S=i,(i=a&&a.Sb)&&!F(i)&&(this.g.m=i),this.v=a&&a.supportsCrossDomainXhr||!1,this.u=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!F(a)&&(this.g.D=a,i=this.h,i!==null&&a in i&&(i=this.h,a in i&&delete i[a])),this.j=new ue(this)}C(_t,ht),_t.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_t.prototype.close=function(){br(this.g)},_t.prototype.o=function(i){var a=this.g;if(typeof i=="string"){var c={};c.__data__=i,i=c}else this.u&&(c={},c.__data__=fr(i),i=c);a.i.push(new yc(a.Ya++,i)),a.G==3&&pn(a)},_t.prototype.N=function(){this.g.l=null,delete this.j,br(this.g),delete this.g,_t.aa.N.call(this)};function Ys(i){gr.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var a=i.__sm__;if(a){t:{for(let c in a){i=c;break t}i=void 0}(this.i=i)&&(i=this.i,a=a!==null&&i in a?a[i]:void 0),this.data=a}else this.data=i}C(Ys,gr);function Zs(){pr.call(this),this.status=1}C(Zs,pr);function ue(i){this.g=i}C(ue,Xs),ue.prototype.ua=function(){gt(this.g,"a")},ue.prototype.ta=function(i){gt(this.g,new Ys(i))},ue.prototype.sa=function(i){gt(this.g,new Zs)},ue.prototype.ra=function(){gt(this.g,"b")},_n.prototype.createWebChannel=_n.prototype.g,_t.prototype.send=_t.prototype.o,_t.prototype.open=_t.prototype.m,_t.prototype.close=_t.prototype.close,el=bn.createWebChannelTransport=function(){return new _n},tl=bn.getStatEventTarget=function(){return on()},Zc=bn.Event=Yt,ma=bn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},an.NO_ERROR=0,an.TIMEOUT=8,an.HTTP_ERROR=6,uo=bn.ErrorCode=an,gs.COMPLETE="complete",Yc=bn.EventType=gs,ls.EventType=Ce,Ce.OPEN="a",Ce.CLOSE="b",Ce.ERROR="c",Ce.MESSAGE="d",ht.prototype.listen=ht.prototype.K,ii=bn.WebChannel=ls,rI=bn.FetchXmlHttpFactory=Me,Z.prototype.listenOnce=Z.prototype.L,Z.prototype.getLastError=Z.prototype.Ka,Z.prototype.getLastErrorCode=Z.prototype.Ba,Z.prototype.getStatus=Z.prototype.Z,Z.prototype.getResponseJson=Z.prototype.Oa,Z.prototype.getResponseText=Z.prototype.oa,Z.prototype.send=Z.prototype.ea,Z.prototype.setWithCredentials=Z.prototype.Ha,Xc=bn.XhrIo=Z}).apply(typeof fa<"u"?fa:typeof self<"u"?self:typeof window<"u"?window:{});var Mg="@firebase/firestore",Lg="4.8.0";var qt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};qt.UNAUTHENTICATED=new qt(null),qt.GOOGLE_CREDENTIALS=new qt("google-credentials-uid"),qt.FIRST_PARTY=new qt("first-party-uid"),qt.MOCK_USER=new qt("mock-user");var Si="11.10.0";var Nr=new ni("@firebase/firestore");function si(){return Nr.logLevel}function L(n,...t){if(Nr.logLevel<=ot.DEBUG){let e=t.map(Qh);Nr.debug(`Firestore (${Si}): ${n}`,...e)}}function Rn(n,...t){if(Nr.logLevel<=ot.ERROR){let e=t.map(Qh);Nr.error(`Firestore (${Si}): ${n}`,...e)}}function Gn(n,...t){if(Nr.logLevel<=ot.WARN){let e=t.map(Qh);Nr.warn(`Firestore (${Si}): ${n}`,...e)}}function Qh(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function z(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,Vp(n,r,e)}function Vp(n,t,e){let r=`FIRESTORE (${Si}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Rn(r),new Error(r)}function ut(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||Vp(t,s,r)}function X(n,t){return n}var x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends In{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var we=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Ia=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},sl=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(qt.UNAUTHENTICATED))}shutdown(){}},ol=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},al=class{constructor(t){this.t=t,this.currentUser=qt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){ut(this.o===void 0,42304);let r=this.i,s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve(),o=new we;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new we,t.enqueueRetryable(()=>s(this.currentUser))};let u=()=>{let h=o;t.enqueueRetryable(async()=>{await h.promise,await s(this.currentUser)})},l=h=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new we)}},0),u()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ut(typeof r.accessToken=="string",31837,{l:r}),new Ia(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return ut(t===null||typeof t=="string",2055,{h:t}),new qt(t)}},ul=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=qt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},cl=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new ul(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(qt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ea=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ll=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Vg(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){ut(this.o===void 0,3512);let r=o=>{o.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let u=o.token!==this.m;return this.m=o.token,L("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};let s=o=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?s(o):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ea(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(ut(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Ea(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function iI(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}function xp(){return new TextEncoder}var yo=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let s=iI(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}};function nt(n,t){return n<t?-1:n>t?1:0}function hl(n,t){let e=0;for(;e<n.length&&e<t.length;){let r=n.codePointAt(e),s=t.codePointAt(e);if(r!==s){if(r<128&&s<128)return nt(r,s);{let o=xp(),u=sI(o.encode(qg(n,e)),o.encode(qg(t,e)));return u!==0?u:nt(r,s)}}e+=r>65535?2:1}return nt(n.length,t.length)}function qg(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function sI(n,t){for(let e=0;e<n.length&&e<t.length;++e)if(n[e]!==t[e])return nt(n[e],t[e]);return nt(n.length,t.length)}function di(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}var Bg="__name__",Ta=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&z(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&z(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let o=n.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return nt(t.length,e.length)}static compareSegments(t,e){let r=n.isNumericId(t),s=n.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?n.extractNumericId(t).compare(n.extractNumericId(e)):hl(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return An.fromString(t.substring(4,t.length-2))}},wt=class n extends Ta{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new O(x.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},oI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,he=class n extends Ta{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return oI.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Bg}static keyField(){return new n([Bg])}static fromServerFormat(t){let e=[],r="",s=0,o=()=>{if(r.length===0)throw new O(x.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},u=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new O(x.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new O(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else l==="`"?(u=!u,s++):l!=="."||u?(r+=l,s++):(o(),s++)}if(o(),u)throw new O(x.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var $=class n{constructor(t){this.path=t}static fromPath(t){return new n(wt.fromString(t))}static fromName(t){return new n(wt.fromString(t).popFirst(5))}static empty(){return new n(wt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&wt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return wt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new wt(t.slice()))}};function Dp(n,t,e){if(!e)throw new O(x.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function aI(n,t,e,r){if(t===!0&&r===!0)throw new O(x.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Ug(n){if(!$.isDocumentKey(n))throw new O(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function jg(n){if($.isDocumentKey(n))throw new O(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Np(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function eu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":z(12329,{type:typeof n})}function re(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new O(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=eu(n);throw new O(x.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function Ct(n,t){let e={typeString:n};return t&&(e.value=t),e}function Vo(n,t){if(!Np(n))throw new O(x.INVALID_ARGUMENT,"JSON must be an object");let e;for(let r in t)if(t[r]){let s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}let u=n[r];if(s&&typeof u!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&u!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new O(x.INVALID_ARGUMENT,e);return!0}var zg=-62135596800,$g=1e6,Vt=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*$g);return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new O(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new O(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<zg)throw new O(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$g}_compareTo(t){return this.seconds===t.seconds?nt(this.nanoseconds,t.nanoseconds):nt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Vo(t,n._jsonSchema))return new n(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-zg;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};Vt._jsonSchemaVersion="firestore/timestamp/1.0",Vt._jsonSchema={type:Ct("string",Vt._jsonSchemaVersion),seconds:Ct("number"),nanoseconds:Ct("number")};var J=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new Vt(0,0))}static max(){return new n(new Vt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var _o=-1,dl=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};dl.UNKNOWN_ID=-1;function uI(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=J.fromTimestamp(r===1e9?new Vt(e+1,0):new Vt(e,r));return new kr(s,$.empty(),t)}function cI(n){return new kr(n.readTime,n.key,_o)}var kr=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(J.min(),$.empty(),_o)}static max(){return new n(J.max(),$.empty(),_o)}};function lI(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=$.comparator(n.documentKey,t.documentKey),e!==0?e:nt(n.largestBatchId,t.largestBatchId))}var hI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",fl=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};async function Ri(n){if(n.code!==x.FAILED_PRECONDITION||n.message!==hI)throw n;L("LocalStore","Unexpectedly lost primary lease")}var D=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&z(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,o=0,u=!1;t.forEach(l=>{++s,l.next(()=>{++o,u&&o===s&&e()},h=>r(h))}),u=!0,o===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,o)=>{r.push(e.call(this,s,o))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let o=t.length,u=new Array(o),l=0;for(let h=0;h<o;h++){let f=h;e(t[f]).next(g=>{u[f]=g,++l,l===o&&r(u)},g=>s(g))}})}static doWhile(t,e){return new n((r,s)=>{let o=()=>{t()===!0?e().next(()=>{o()},s):r()};o()})}};function dI(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Pi(n){return n.name==="IndexedDbTransactionError"}var Wh=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this._e(s),this.ae=s=>r.writeSequenceNumber(s))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}n.ue=-1;return n})(),Hh=-1;function xo(n){return n==null}function wo(n){return n===0&&1/n==-1/0}function fI(n){return typeof n=="number"&&Number.isInteger(n)&&!wo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var kp="";function mI(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Gg(t)),t=gI(n.get(e),t);return Gg(t)}function gI(n,t){let e=t,r=n.length;for(let s=0;s<r;s++){let o=n.charAt(s);switch(o){case"\0":e+="";break;case kp:e+="";break;default:e+=o}}return e}function Gg(n){return n+kp+""}var pI="remoteDocuments",Op="owner";var Fp="mutationQueues";var Mp="mutations";var Lp="documentMutations",yI="remoteDocumentsV14";var qp="remoteDocumentGlobal";var Bp="targets";var Up="targetDocuments";var jp="targetGlobal",zp="collectionParents";var $p="clientMetadata";var Gp="bundles";var Kp="namedQueries";var _I="indexConfiguration";var wI="indexState";var vI="indexEntries";var Qp="documentOverlays";var II="globals";var EI=[Fp,Mp,Lp,pI,Bp,Op,jp,Up,$p,qp,zp,Gp,Kp],OA=[...EI,Qp],TI=[Fp,Mp,Lp,yI,Bp,Op,jp,Up,$p,qp,zp,Gp,Kp,Qp],AI=TI,bI=[...AI,_I,wI,vI];var FA=[...bI,II];function Kg(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Xn(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Wp(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var At=class n{constructor(t,e){this.comparator=t,this.root=e||$e.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,$e.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,$e.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ci(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ci(this.root,t,this.comparator,!1)}getReverseIterator(){return new ci(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ci(this.root,t,this.comparator,!0)}},ci=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},$e=class n{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new n(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw z(43730,{key:this.key,value:this.value});if(this.right.isRed())throw z(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw z(27949);return t+(this.isRed()?0:1)}};$e.EMPTY=null,$e.RED=!0,$e.BLACK=!1;$e.EMPTY=new class{constructor(){this.size=0}get key(){throw z(57766)}get value(){throw z(16141)}get color(){throw z(16727)}get left(){throw z(29726)}get right(){throw z(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new $e(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Bt=class n{constructor(t){this.comparator=t,this.data=new At(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Aa(this.data.getIterator())}getIteratorFrom(t){return new Aa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},Aa=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var _e=class n{constructor(t){this.fields=t,t.sort(he.comparator)}static empty(){return new n([])}unionWith(t){let e=new Bt(he.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return di(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var ba=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Wt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new ba("Invalid base64 string: "+o):o}})(t);return new n(e)}static fromUint8Array(t){let e=(function(s){let o="";for(let u=0;u<s.length;++u)o+=String.fromCharCode(s[u]);return o})(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return nt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};Wt.EMPTY_BYTE_STRING=new Wt("");var SI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pn(n){if(ut(!!n,39018),typeof n=="string"){let t=0,e=SI.exec(n);if(ut(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:It(n.seconds),nanos:It(n.nanos)}}function It(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Cn(n){return typeof n=="string"?Wt.fromBase64String(n):Wt.fromUint8Array(n)}var Hp="server_timestamp",Jp="__type__",Xp="__previous_value__",Yp="__local_write_time__";function Jh(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Jp])===null||e===void 0?void 0:e.stringValue)===Hp}function nu(n){let t=n.mapValue.fields[Xp];return Jh(t)?nu(t):t}function vo(n){let t=Pn(n.mapValue.fields[Yp].timestampValue);return new Vt(t.seconds,t.nanos)}var ml=class{constructor(t,e,r,s,o,u,l,h,f,g){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=g}},Sa="(default)",Ra=class n{constructor(t,e){this.projectId=t,this.database=e||Sa}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Sa}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var Xh="__type__",Zp="__max__",ga={mapValue:{fields:{__type__:{stringValue:Zp}}}},Yh="__vector__",fi="value";function Kn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Jh(n)?4:ey(n)?9007199254740991:ty(n)?10:11:z(28295,{value:n})}function Ke(n,t){if(n===t)return!0;let e=Kn(n);if(e!==Kn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return vo(n).isEqual(vo(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;let u=Pn(s.timestampValue),l=Pn(o.timestampValue);return u.seconds===l.seconds&&u.nanos===l.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,o){return Cn(s.bytesValue).isEqual(Cn(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,o){return It(s.geoPointValue.latitude)===It(o.geoPointValue.latitude)&&It(s.geoPointValue.longitude)===It(o.geoPointValue.longitude)})(n,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return It(s.integerValue)===It(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){let u=It(s.doubleValue),l=It(o.doubleValue);return u===l?wo(u)===wo(l):isNaN(u)&&isNaN(l)}return!1})(n,t);case 9:return di(n.arrayValue.values||[],t.arrayValue.values||[],Ke);case 10:case 11:return(function(s,o){let u=s.mapValue.fields||{},l=o.mapValue.fields||{};if(Kg(u)!==Kg(l))return!1;for(let h in u)if(u.hasOwnProperty(h)&&(l[h]===void 0||!Ke(u[h],l[h])))return!1;return!0})(n,t);default:return z(52216,{left:n})}}function Io(n,t){return(n.values||[]).find(e=>Ke(e,t))!==void 0}function mi(n,t){if(n===t)return 0;let e=Kn(n),r=Kn(t);if(e!==r)return nt(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return nt(n.booleanValue,t.booleanValue);case 2:return(function(o,u){let l=It(o.integerValue||o.doubleValue),h=It(u.integerValue||u.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,t);case 3:return Qg(n.timestampValue,t.timestampValue);case 4:return Qg(vo(n),vo(t));case 5:return hl(n.stringValue,t.stringValue);case 6:return(function(o,u){let l=Cn(o),h=Cn(u);return l.compareTo(h)})(n.bytesValue,t.bytesValue);case 7:return(function(o,u){let l=o.split("/"),h=u.split("/");for(let f=0;f<l.length&&f<h.length;f++){let g=nt(l[f],h[f]);if(g!==0)return g}return nt(l.length,h.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,u){let l=nt(It(o.latitude),It(u.latitude));return l!==0?l:nt(It(o.longitude),It(u.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return Wg(n.arrayValue,t.arrayValue);case 10:return(function(o,u){var l,h,f,g;let E=o.fields||{},T=u.fields||{},S=(l=E[fi])===null||l===void 0?void 0:l.arrayValue,C=(h=T[fi])===null||h===void 0?void 0:h.arrayValue,V=nt(((f=S?.values)===null||f===void 0?void 0:f.length)||0,((g=C?.values)===null||g===void 0?void 0:g.length)||0);return V!==0?V:Wg(S,C)})(n.mapValue,t.mapValue);case 11:return(function(o,u){if(o===ga.mapValue&&u===ga.mapValue)return 0;if(o===ga.mapValue)return 1;if(u===ga.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),f=u.fields||{},g=Object.keys(f);h.sort(),g.sort();for(let E=0;E<h.length&&E<g.length;++E){let T=hl(h[E],g[E]);if(T!==0)return T;let S=mi(l[h[E]],f[g[E]]);if(S!==0)return S}return nt(h.length,g.length)})(n.mapValue,t.mapValue);default:throw z(23264,{le:e})}}function Qg(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return nt(n,t);let e=Pn(n),r=Pn(t),s=nt(e.seconds,r.seconds);return s!==0?s:nt(e.nanos,r.nanos)}function Wg(n,t){let e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){let o=mi(e[s],r[s]);if(o)return o}return nt(e.length,r.length)}function gi(n){return gl(n)}function gl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){let r=Pn(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return Cn(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return $.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",s=!0;for(let o of e.values||[])s?s=!1:r+=",",r+=gl(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){let r=Object.keys(e.fields||{}).sort(),s="{",o=!0;for(let u of r)o?o=!1:s+=",",s+=`${u}:${gl(e.fields[u])}`;return s+"}"})(n.mapValue):z(61005,{value:n})}function _a(n){switch(Kn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=nu(n);return t?16+_a(t):16;case 5:return 2*n.stringValue.length;case 6:return Cn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((s,o)=>s+_a(o),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Xn(r.fields,(o,u)=>{s+=o.length+_a(u)}),s})(n.mapValue);default:throw z(13486,{value:n})}}function Hg(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function pl(n){return!!n&&"integerValue"in n}function Zh(n){return!!n&&"arrayValue"in n}function Jg(n){return!!n&&"nullValue"in n}function Xg(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function wa(n){return!!n&&"mapValue"in n}function ty(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Xh])===null||e===void 0?void 0:e.stringValue)===Yh}function ho(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return Xn(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=ho(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=ho(n.arrayValue.values[e]);return t}return Object.assign({},n)}function ey(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Zp}var LA={mapValue:{fields:{[Xh]:{stringValue:Yh},[fi]:{arrayValue:{}}}}};var ie=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!wa(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ho(e)}setAll(t){let e=he.emptyPath(),r={},s=[];t.forEach((u,l)=>{if(!e.isImmediateParentOf(l)){let h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=l.popLast()}u?r[l.lastSegment()]=ho(u):s.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){let e=this.field(t.popLast());wa(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ke(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];wa(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){Xn(e,(s,o)=>t[s]=o);for(let s of r)delete t[s]}clone(){return new n(ho(this.value))}};function ny(n){let t=[];return Xn(n.fields,(e,r)=>{let s=new he([e]);if(wa(r)){let o=ny(r.mapValue).fields;if(o.length===0)t.push(s);else for(let u of o)t.push(s.child(u))}else t.push(s)}),new _e(t)}var fe=class n{constructor(t,e,r,s,o,u,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=u,this.documentState=l}static newInvalidDocument(t){return new n(t,0,J.min(),J.min(),J.min(),ie.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,J.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,J.min(),J.min(),ie.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,J.min(),J.min(),ie.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(J.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ie.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ie.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=J.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var pi=class{constructor(t,e){this.position=t,this.inclusive=e}};function Yg(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let o=t[s],u=n.position[s];if(o.field.isKeyField()?r=$.comparator($.fromName(u.referenceValue),e.key):r=mi(u,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Zg(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ke(n.position[e],t.position[e]))return!1;return!0}var Or=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function RI(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Pa=class{},Pt=class n extends Pa{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new _l(t,e,r):e==="array-contains"?new Il(t,r):e==="in"?new El(t,r):e==="not-in"?new Tl(t,r):e==="array-contains-any"?new Al(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new wl(t,r):new vl(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(mi(e,this.value)):e!==null&&Kn(this.value)===Kn(e)&&this.matchesComparison(mi(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return z(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},je=class n extends Pa{constructor(t,e){super(),this.filters=t,this.op=e,this.he=null}static create(t,e){return new n(t,e)}matches(t){return ry(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function ry(n){return n.op==="and"}function iy(n){return PI(n)&&ry(n)}function PI(n){for(let t of n.filters)if(t instanceof je)return!1;return!0}function yl(n){if(n instanceof Pt)return n.field.canonicalString()+n.op.toString()+gi(n.value);if(iy(n))return n.filters.map(t=>yl(t)).join(",");{let t=n.filters.map(e=>yl(e)).join(",");return`${n.op}(${t})`}}function sy(n,t){return n instanceof Pt?(function(r,s){return s instanceof Pt&&r.op===s.op&&r.field.isEqual(s.field)&&Ke(r.value,s.value)})(n,t):n instanceof je?(function(r,s){return s instanceof je&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,u,l)=>o&&sy(u,s.filters[l]),!0):!1})(n,t):void z(19439)}function oy(n){return n instanceof Pt?(function(e){return`${e.field.canonicalString()} ${e.op} ${gi(e.value)}`})(n):n instanceof je?(function(e){return e.op.toString()+" {"+e.getFilters().map(oy).join(" ,")+"}"})(n):"Filter"}var _l=class extends Pt{constructor(t,e,r){super(t,e,r),this.key=$.fromName(r.referenceValue)}matches(t){let e=$.comparator(t.key,this.key);return this.matchesComparison(e)}},wl=class extends Pt{constructor(t,e){super(t,"in",e),this.keys=ay("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},vl=class extends Pt{constructor(t,e){super(t,"not-in",e),this.keys=ay("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function ay(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>$.fromName(r.referenceValue))}var Il=class extends Pt{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Zh(e)&&Io(e.arrayValue,this.value)}},El=class extends Pt{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Io(this.value.arrayValue,e)}},Tl=class extends Pt{constructor(t,e){super(t,"not-in",e)}matches(t){if(Io(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Io(this.value.arrayValue,e)}},Al=class extends Pt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Zh(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Io(this.value.arrayValue,r))}};var bl=class{constructor(t,e=null,r=[],s=[],o=null,u=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=u,this.endAt=l,this.Pe=null}};function tp(n,t=null,e=[],r=[],s=null,o=null,u=null){return new bl(n,t,e,r,s,o,u)}function td(n){let t=X(n);if(t.Pe===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>yl(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>(function(o){return o.field.canonicalString()+o.dir})(r)).join(","),xo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>gi(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>gi(r)).join(",")),t.Pe=e}return t.Pe}function ed(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!RI(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!sy(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Zg(n.startAt,t.startAt)&&Zg(n.endAt,t.endAt)}function Sl(n){return $.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Qn=class{constructor(t,e=null,r=[],s=[],o=null,u="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=u,this.startAt=l,this.endAt=h,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function CI(n,t,e,r,s,o,u,l){return new Qn(n,t,e,r,s,o,u,l)}function ru(n){return new Qn(n)}function ep(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function uy(n){return n.collectionGroup!==null}function fo(n){let t=X(n);if(t.Te===null){t.Te=[];let e=new Set;for(let o of t.explicitOrderBy)t.Te.push(o),e.add(o.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(u){let l=new Bt(he.comparator);return u.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.Te.push(new Or(o,r))}),e.has(he.keyField().canonicalString())||t.Te.push(new Or(he.keyField(),r))}return t.Te}function Ge(n){let t=X(n);return t.Ie||(t.Ie=VI(t,fo(n))),t.Ie}function VI(n,t){if(n.limitType==="F")return tp(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let o=s.dir==="desc"?"asc":"desc";return new Or(s.field,o)});let e=n.endAt?new pi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new pi(n.startAt.position,n.startAt.inclusive):null;return tp(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Rl(n,t){let e=n.filters.concat([t]);return new Qn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function Pl(n,t,e){return new Qn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function iu(n,t){return ed(Ge(n),Ge(t))&&n.limitType===t.limitType}function cy(n){return`${td(Ge(n))}|lt:${n.limitType}`}function oi(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>oy(s)).join(", ")}]`),xo(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>gi(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>gi(s)).join(",")),`Target(${r})`})(Ge(n))}; limitType=${n.limitType})`}function su(n,t){return t.isFoundDocument()&&(function(r,s){let o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):$.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,s){for(let o of fo(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,s){for(let o of r.filters)if(!o.matches(s))return!1;return!0})(n,t)&&(function(r,s){return!(r.startAt&&!(function(u,l,h){let f=Yg(u,l,h);return u.inclusive?f<=0:f<0})(r.startAt,fo(r),s)||r.endAt&&!(function(u,l,h){let f=Yg(u,l,h);return u.inclusive?f>=0:f>0})(r.endAt,fo(r),s))})(n,t)}function xI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ly(n){return(t,e)=>{let r=!1;for(let s of fo(n)){let o=DI(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function DI(n,t,e){let r=n.field.isKeyField()?$.comparator(t.key,e.key):(function(o,u,l){let h=u.data.field(o),f=l.data.field(o);return h!==null&&f!==null?mi(h,f):z(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return z(19790,{direction:n.dir})}}var Vn=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Xn(this.inner,(e,r)=>{for(let[s,o]of r)t(s,o)})}isEmpty(){return Wp(this.inner)}size(){return this.innerSize}};var NI=new At($.comparator);function xn(){return NI}var hy=new At($.comparator);function co(...n){let t=hy;for(let e of n)t=t.insert(e.key,e);return t}function dy(n){let t=hy;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function Vr(){return mo()}function fy(){return mo()}function mo(){return new Vn(n=>n.toString(),(n,t)=>n.isEqual(t))}var kI=new At($.comparator),OI=new Bt($.comparator);function rt(...n){let t=OI;for(let e of n)t=t.add(e);return t}var FI=new Bt(nt);function MI(){return FI}function nd(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wo(t)?"-0":t}}function my(n){return{integerValue:""+n}}function LI(n,t){return fI(t)?my(t):nd(n,t)}var yi=class{constructor(){this._=void 0}};function qI(n,t,e){return n instanceof Fr?(function(s,o){let u={fields:{[Jp]:{stringValue:Hp},[Yp]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Jh(o)&&(o=nu(o)),o&&(u.fields[Xp]=o),{mapValue:u}})(e,t):n instanceof Mr?py(n,t):n instanceof Lr?yy(n,t):(function(s,o){let u=gy(s,o),l=np(u)+np(s.Ee);return pl(u)&&pl(s.Ee)?my(l):nd(s.serializer,l)})(n,t)}function BI(n,t,e){return n instanceof Mr?py(n,t):n instanceof Lr?yy(n,t):e}function gy(n,t){return n instanceof _i?(function(r){return pl(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}var Fr=class extends yi{},Mr=class extends yi{constructor(t){super(),this.elements=t}};function py(n,t){let e=_y(t);for(let r of n.elements)e.some(s=>Ke(s,r))||e.push(r);return{arrayValue:{values:e}}}var Lr=class extends yi{constructor(t){super(),this.elements=t}};function yy(n,t){let e=_y(t);for(let r of n.elements)e=e.filter(s=>!Ke(s,r));return{arrayValue:{values:e}}}var _i=class extends yi{constructor(t,e){super(),this.serializer=t,this.Ee=e}};function np(n){return It(n.integerValue||n.doubleValue)}function _y(n){return Zh(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Cl=class{constructor(t,e){this.field=t,this.transform=e}};function UI(n,t){return n.field.isEqual(t.field)&&(function(r,s){return r instanceof Mr&&s instanceof Mr||r instanceof Lr&&s instanceof Lr?di(r.elements,s.elements,Ke):r instanceof _i&&s instanceof _i?Ke(r.Ee,s.Ee):r instanceof Fr&&s instanceof Fr})(n.transform,t.transform)}var Vl=class{constructor(t,e){this.version=t,this.transformResults=e}},ne=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function va(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var wi=class{};function wy(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new vi(n.key,ne.none()):new qr(n.key,n.data,ne.none());{let e=n.data,r=ie.empty(),s=new Bt(he.comparator);for(let o of t.fields)if(!s.has(o)){let u=e.field(o);u===null&&o.length>1&&(o=o.popLast(),u=e.field(o)),u===null?r.delete(o):r.set(o,u),s=s.add(o)}return new Qe(n.key,r,new _e(s.toArray()),ne.none())}}function jI(n,t,e){n instanceof qr?(function(s,o,u){let l=s.value.clone(),h=ip(s.fieldTransforms,o,u.transformResults);l.setAll(h),o.convertToFoundDocument(u.version,l).setHasCommittedMutations()})(n,t,e):n instanceof Qe?(function(s,o,u){if(!va(s.precondition,o))return void o.convertToUnknownDocument(u.version);let l=ip(s.fieldTransforms,o,u.transformResults),h=o.data;h.setAll(vy(s)),h.setAll(l),o.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(n,t,e):(function(s,o,u){o.convertToNoDocument(u.version).setHasCommittedMutations()})(0,t,e)}function go(n,t,e,r){return n instanceof qr?(function(o,u,l,h){if(!va(o.precondition,u))return l;let f=o.value.clone(),g=sp(o.fieldTransforms,h,u);return f.setAll(g),u.convertToFoundDocument(u.version,f).setHasLocalMutations(),null})(n,t,e,r):n instanceof Qe?(function(o,u,l,h){if(!va(o.precondition,u))return l;let f=sp(o.fieldTransforms,h,u),g=u.data;return g.setAll(vy(o)),g.setAll(f),u.convertToFoundDocument(u.version,g).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(E=>E.field))})(n,t,e,r):(function(o,u,l){return va(o.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):l})(n,t,e)}function zI(n,t){let e=null;for(let r of n.fieldTransforms){let s=t.data.field(r.field),o=gy(r.transform,s||null);o!=null&&(e===null&&(e=ie.empty()),e.set(r.field,o))}return e||null}function rp(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&di(r,s,(o,u)=>UI(o,u))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var qr=class extends wi{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},Qe=class extends wi{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function vy(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function ip(n,t,e){let r=new Map;ut(n.length===e.length,32656,{Ae:e.length,Re:n.length});for(let s=0;s<e.length;s++){let o=n[s],u=o.transform,l=t.data.field(o.field);r.set(o.field,BI(u,l,e[s]))}return r}function sp(n,t,e){let r=new Map;for(let s of n){let o=s.transform,u=e.data.field(s.field);r.set(s.field,qI(o,u,t))}return r}var vi=class extends wi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ca=class extends wi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var xl=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let o=this.mutations[s];o.key.isEqual(t.key)&&jI(o,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=go(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=go(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=fy();return this.mutations.forEach(s=>{let o=t.get(s.key),u=o.overlayedDocument,l=this.applyToLocalView(u,o.mutatedFields);l=e.has(s.key)?null:l;let h=wy(u,l);h!==null&&r.set(s.key,h),u.isValidDocument()||u.convertToNoDocument(J.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),rt())}isEqual(t){return this.batchId===t.batchId&&di(this.mutations,t.mutations,(e,r)=>rp(e,r))&&di(this.baseMutations,t.baseMutations,(e,r)=>rp(e,r))}},Dl=class n{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){ut(t.mutations.length===r.length,58842,{Ve:t.mutations.length,me:r.length});let s=(function(){return kI})(),o=t.mutations;for(let u=0;u<o.length;u++)s=s.insert(o[u].key,r[u].version);return new n(t,e,r,s)}};var Nl=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var kl=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var St,at;function Iy(n){switch(n){case x.OK:return z(64938);case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return z(15467,{code:n})}}function Ey(n){if(n===void 0)return Rn("GRPC error has no .code"),x.UNKNOWN;switch(n){case St.OK:return x.OK;case St.CANCELLED:return x.CANCELLED;case St.UNKNOWN:return x.UNKNOWN;case St.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case St.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case St.INTERNAL:return x.INTERNAL;case St.UNAVAILABLE:return x.UNAVAILABLE;case St.UNAUTHENTICATED:return x.UNAUTHENTICATED;case St.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case St.NOT_FOUND:return x.NOT_FOUND;case St.ALREADY_EXISTS:return x.ALREADY_EXISTS;case St.PERMISSION_DENIED:return x.PERMISSION_DENIED;case St.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case St.ABORTED:return x.ABORTED;case St.OUT_OF_RANGE:return x.OUT_OF_RANGE;case St.UNIMPLEMENTED:return x.UNIMPLEMENTED;case St.DATA_LOSS:return x.DATA_LOSS;default:return z(39323,{code:n})}}(at=St||(St={}))[at.OK=0]="OK",at[at.CANCELLED=1]="CANCELLED",at[at.UNKNOWN=2]="UNKNOWN",at[at.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",at[at.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",at[at.NOT_FOUND=5]="NOT_FOUND",at[at.ALREADY_EXISTS=6]="ALREADY_EXISTS",at[at.PERMISSION_DENIED=7]="PERMISSION_DENIED",at[at.UNAUTHENTICATED=16]="UNAUTHENTICATED",at[at.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",at[at.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",at[at.ABORTED=10]="ABORTED",at[at.OUT_OF_RANGE=11]="OUT_OF_RANGE",at[at.UNIMPLEMENTED=12]="UNIMPLEMENTED",at[at.INTERNAL=13]="INTERNAL",at[at.UNAVAILABLE=14]="UNAVAILABLE",at[at.DATA_LOSS=15]="DATA_LOSS";var op=null;var $I=new An([4294967295,4294967295],0);function ap(n){let t=xp().encode(n),e=new Jc;return e.update(t),new Uint8Array(e.digest())}function up(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new An([e,r],0),new An([s,o],0)]}var Ol=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new xr(`Invalid padding: ${e}`);if(r<0)throw new xr(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new xr(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new xr(`Invalid padding when bitmap length is 0: ${e}`);this.fe=8*t.length-e,this.ge=An.fromNumber(this.fe)}pe(t,e,r){let s=t.add(e.multiply(An.fromNumber(r)));return s.compare($I)===1&&(s=new An([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ge).toNumber()}ye(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.fe===0)return!1;let e=ap(t),[r,s]=up(e);for(let o=0;o<this.hashCount;o++){let u=this.pe(r,s,o);if(!this.ye(u))return!1}return!0}static create(t,e,r){let s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),u=new n(o,s,e);return r.forEach(l=>u.insert(l)),u}insert(t){if(this.fe===0)return;let e=ap(t),[r,s]=up(e);for(let o=0;o<this.hashCount;o++){let u=this.pe(r,s,o);this.we(u)}}we(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},xr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Va=class n{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let s=new Map;return s.set(t,Eo.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(J.min(),s,new At(nt),xn(),rt())}},Eo=class n{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,rt(),rt(),rt())}};var li=class{constructor(t,e,r,s){this.Se=t,this.removedTargetIds=e,this.key=r,this.be=s}},xa=class{constructor(t,e){this.targetId=t,this.De=e}},Da=class{constructor(t,e,r=Wt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}},Na=class{constructor(){this.ve=0,this.Ce=cp(),this.Fe=Wt.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(t){t.approximateByteSize()>0&&(this.xe=!0,this.Fe=t)}Le(){let t=rt(),e=rt(),r=rt();return this.Ce.forEach((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:z(38017,{changeType:o})}}),new Eo(this.Fe,this.Me,t,e,r)}ke(){this.xe=!1,this.Ce=cp()}qe(t,e){this.xe=!0,this.Ce=this.Ce.insert(t,e)}Qe(t){this.xe=!0,this.Ce=this.Ce.remove(t)}$e(){this.ve+=1}Ue(){this.ve-=1,ut(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},Fl=class{constructor(t){this.We=t,this.Ge=new Map,this.ze=xn(),this.je=pa(),this.Je=pa(),this.He=new At(nt)}Ye(t){for(let e of t.Se)t.be&&t.be.isFoundDocument()?this.Ze(e,t.be):this.Xe(e,t.key,t.be);for(let e of t.removedTargetIds)this.Xe(e,t.key,t.be)}et(t){this.forEachTarget(t,e=>{let r=this.tt(e);switch(t.state){case 0:this.nt(e)&&r.Be(t.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(t.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(e);break;case 3:this.nt(e)&&(r.Ke(),r.Be(t.resumeToken));break;case 4:this.nt(e)&&(this.rt(e),r.Be(t.resumeToken));break;default:z(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ge.forEach((r,s)=>{this.nt(s)&&e(s)})}it(t){let e=t.targetId,r=t.De.count,s=this.st(e);if(s){let o=s.target;if(Sl(o))if(r===0){let u=new $(o.path);this.Xe(e,u,fe.newNoDocument(u,J.min()))}else ut(r===1,20013,{expectedCount:r});else{let u=this.ot(e);if(u!==r){let l=this._t(t),h=l?this.ut(l,t,u):1;if(h!==0){this.rt(e);let f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(e,f)}op?.ct((function(g,E,T,S,C){var V,P,M,F,q,H;let vt={localCacheCount:g,existenceFilterCount:E.count,databaseId:T.database,projectId:T.projectId},K=E.unchangedNames;return K&&(vt.bloomFilter={applied:C===0,hashCount:(V=K?.hashCount)!==null&&V!==void 0?V:0,bitmapLength:(F=(M=(P=K?.bits)===null||P===void 0?void 0:P.bitmap)===null||M===void 0?void 0:M.length)!==null&&F!==void 0?F:0,padding:(H=(q=K?.bits)===null||q===void 0?void 0:q.padding)!==null&&H!==void 0?H:0,mightContain:v=>{var m;return(m=S?.mightContain(v))!==null&&m!==void 0&&m}}),vt})(u,t.De,this.We.lt(),l,h))}}}}_t(t){let e=t.De.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e,u,l;try{u=Cn(r).toUint8Array()}catch(h){if(h instanceof ba)return Gn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Ol(u,s,o)}catch(h){return Gn(h instanceof xr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.fe===0?null:l}ut(t,e,r){return e.De.count===r-this.ht(t,e.targetId)?0:2}ht(t,e){let r=this.We.getRemoteKeysForTarget(e),s=0;return r.forEach(o=>{let u=this.We.lt(),l=`projects/${u.projectId}/databases/${u.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.Xe(e,o,null),s++)}),s}Pt(t){let e=new Map;this.Ge.forEach((o,u)=>{let l=this.st(u);if(l){if(o.current&&Sl(l.target)){let h=new $(l.target.path);this.Tt(h).has(u)||this.It(u,h)||this.Xe(u,h,fe.newNoDocument(h,t))}o.Ne&&(e.set(u,o.Le()),o.ke())}});let r=rt();this.Je.forEach((o,u)=>{let l=!0;u.forEachWhile(h=>{let f=this.st(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.ze.forEach((o,u)=>u.setReadTime(t));let s=new Va(t,e,this.He,this.ze,r);return this.ze=xn(),this.je=pa(),this.Je=pa(),this.He=new At(nt),s}Ze(t,e){if(!this.nt(t))return;let r=this.It(t,e.key)?2:0;this.tt(t).qe(e.key,r),this.ze=this.ze.insert(e.key,e),this.je=this.je.insert(e.key,this.Tt(e.key).add(t)),this.Je=this.Je.insert(e.key,this.dt(e.key).add(t))}Xe(t,e,r){if(!this.nt(t))return;let s=this.tt(t);this.It(t,e)?s.qe(e,1):s.Qe(e),this.Je=this.Je.insert(e,this.dt(e).delete(t)),this.Je=this.Je.insert(e,this.dt(e).add(t)),r&&(this.ze=this.ze.insert(e,r))}removeTarget(t){this.Ge.delete(t)}ot(t){let e=this.tt(t).Le();return this.We.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.tt(t).$e()}tt(t){let e=this.Ge.get(t);return e||(e=new Na,this.Ge.set(t,e)),e}dt(t){let e=this.Je.get(t);return e||(e=new Bt(nt),this.Je=this.Je.insert(t,e)),e}Tt(t){let e=this.je.get(t);return e||(e=new Bt(nt),this.je=this.je.insert(t,e)),e}nt(t){let e=this.st(t)!==null;return e||L("WatchChangeAggregator","Detected inactive target",t),e}st(t){let e=this.Ge.get(t);return e&&e.Oe?null:this.We.Et(t)}rt(t){this.Ge.set(t,new Na),this.We.getRemoteKeysForTarget(t).forEach(e=>{this.Xe(t,e,null)})}It(t,e){return this.We.getRemoteKeysForTarget(t).has(e)}};function pa(){return new At($.comparator)}function cp(){return new At($.comparator)}var GI={asc:"ASCENDING",desc:"DESCENDING"},KI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},QI={and:"AND",or:"OR"},Ml=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Ll(n,t){return n.useProto3Json||xo(t)?t:{value:t}}function ka(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ty(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function WI(n,t){return ka(n,t.toTimestamp())}function de(n){return ut(!!n,49232),J.fromTimestamp((function(e){let r=Pn(e);return new Vt(r.seconds,r.nanos)})(n))}function rd(n,t){return ql(n,t).canonicalString()}function ql(n,t){let e=(function(s){return new wt(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function Ay(n){let t=wt.fromString(n);return ut(Vy(t),10190,{key:t.toString()}),t}function Oa(n,t){return rd(n.databaseId,t.path)}function po(n,t){let e=Ay(t);if(e.get(1)!==n.databaseId.projectId)throw new O(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new O(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new $(Sy(e))}function by(n,t){return rd(n.databaseId,t)}function HI(n){let t=Ay(n);return t.length===4?wt.emptyPath():Sy(t)}function Bl(n){return new wt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Sy(n){return ut(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function lp(n,t,e){return{name:Oa(n,t),fields:e.value.mapValue.fields}}function JI(n,t){return"found"in t?(function(r,s){ut(!!s.found,43571),s.found.name,s.found.updateTime;let o=po(r,s.found.name),u=de(s.found.updateTime),l=s.found.createTime?de(s.found.createTime):J.min(),h=new ie({mapValue:{fields:s.found.fields}});return fe.newFoundDocument(o,u,l,h)})(n,t):"missing"in t?(function(r,s){ut(!!s.missing,3894),ut(!!s.readTime,22933);let o=po(r,s.missing),u=de(s.readTime);return fe.newNoDocument(o,u)})(n,t):z(7234,{result:t})}function XI(n,t){let e;if("targetChange"in t){t.targetChange;let r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:z(39313,{state:f})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(f,g){return f.useProto3Json?(ut(g===void 0||typeof g=="string",58123),Wt.fromBase64String(g||"")):(ut(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),Wt.fromUint8Array(g||new Uint8Array))})(n,t.targetChange.resumeToken),u=t.targetChange.cause,l=u&&(function(f){let g=f.code===void 0?x.UNKNOWN:Ey(f.code);return new O(g,f.message||"")})(u);e=new Da(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=po(n,r.document.name),o=de(r.document.updateTime),u=r.document.createTime?de(r.document.createTime):J.min(),l=new ie({mapValue:{fields:r.document.fields}}),h=fe.newFoundDocument(s,o,u,l),f=r.targetIds||[],g=r.removedTargetIds||[];e=new li(f,g,h.key,h)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=po(n,r.document),o=r.readTime?de(r.readTime):J.min(),u=fe.newNoDocument(s,o),l=r.removedTargetIds||[];e=new li([],l,u.key,u)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=po(n,r.document),o=r.removedTargetIds||[];e=new li([],o,s,null)}else{if(!("filter"in t))return z(11601,{At:t});{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:o}=r,u=new kl(s,o),l=r.targetId;e=new xa(l,u)}}return e}function Ry(n,t){let e;if(t instanceof qr)e={update:lp(n,t.key,t.value)};else if(t instanceof vi)e={delete:Oa(n,t.key)};else if(t instanceof Qe)e={update:lp(n,t.key,t.data),updateMask:oE(t.fieldMask)};else{if(!(t instanceof Ca))return z(16599,{Rt:t.type});e={verify:Oa(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>(function(o,u){let l=u.transform;if(l instanceof Fr)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Mr)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Lr)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof _i)return{fieldPath:u.field.canonicalString(),increment:l.Ee};throw z(20930,{transform:u.transform})})(0,r))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:WI(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:z(27497)})(n,t.precondition)),e}function YI(n,t){return n&&n.length>0?(ut(t!==void 0,14353),n.map(e=>(function(s,o){let u=s.updateTime?de(s.updateTime):de(o);return u.isEqual(J.min())&&(u=de(o)),new Vl(u,s.transformResults||[])})(e,t))):[]}function ZI(n,t){return{documents:[by(n,t.path)]}}function tE(n,t){let e={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=by(n,s);let o=(function(f){if(f.length!==0)return Cy(je.create(f,"and"))})(t.filters);o&&(e.structuredQuery.where=o);let u=(function(f){if(f.length!==0)return f.map(g=>(function(T){return{field:ai(T.field),direction:rE(T.dir)}})(g))})(t.orderBy);u&&(e.structuredQuery.orderBy=u);let l=Ll(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(t.endAt)),{Vt:e,parent:s}}function eE(n){let t=HI(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){ut(r===1,65062);let g=e.from[0];g.allDescendants?s=g.collectionId:t=t.child(g.collectionId)}let o=[];e.where&&(o=(function(E){let T=Py(E);return T instanceof je&&iy(T)?T.getFilters():[T]})(e.where));let u=[];e.orderBy&&(u=(function(E){return E.map(T=>(function(C){return new Or(ui(C.field),(function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(T))})(e.orderBy));let l=null;e.limit&&(l=(function(E){let T;return T=typeof E=="object"?E.value:E,xo(T)?null:T})(e.limit));let h=null;e.startAt&&(h=(function(E){let T=!!E.before,S=E.values||[];return new pi(S,T)})(e.startAt));let f=null;return e.endAt&&(f=(function(E){let T=!E.before,S=E.values||[];return new pi(S,T)})(e.endAt)),CI(t,s,u,o,l,"F",h,f)}function nE(n,t){let e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return z(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Py(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=ui(e.unaryFilter.field);return Pt.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=ui(e.unaryFilter.field);return Pt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=ui(e.unaryFilter.field);return Pt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let u=ui(e.unaryFilter.field);return Pt.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return z(61313);default:return z(60726)}})(n):n.fieldFilter!==void 0?(function(e){return Pt.create(ui(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return z(58110);default:return z(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return je.create(e.compositeFilter.filters.map(r=>Py(r)),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return z(1026)}})(e.compositeFilter.op))})(n):z(30097,{filter:n})}function rE(n){return GI[n]}function iE(n){return KI[n]}function sE(n){return QI[n]}function ai(n){return{fieldPath:n.canonicalString()}}function ui(n){return he.fromServerFormat(n.fieldPath)}function Cy(n){return n instanceof Pt?(function(e){if(e.op==="=="){if(Xg(e.value))return{unaryFilter:{field:ai(e.field),op:"IS_NAN"}};if(Jg(e.value))return{unaryFilter:{field:ai(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Xg(e.value))return{unaryFilter:{field:ai(e.field),op:"IS_NOT_NAN"}};if(Jg(e.value))return{unaryFilter:{field:ai(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ai(e.field),op:iE(e.op),value:e.value}}})(n):n instanceof je?(function(e){let r=e.getFilters().map(s=>Cy(s));return r.length===1?r[0]:{compositeFilter:{op:sE(e.op),filters:r}}})(n):z(54877,{filter:n})}function oE(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Vy(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var To=class n{constructor(t,e,r,s,o=J.min(),u=J.min(),l=Wt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Ul=class{constructor(t){this.gt=t}};function aE(n){let t=eE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Pl(t,t.limit,"L"):t}var Fa=class{constructor(){}bt(t,e){this.Dt(t,e),e.vt()}Dt(t,e){if("nullValue"in t)this.Ct(e,5);else if("booleanValue"in t)this.Ct(e,10),e.Ft(t.booleanValue?1:0);else if("integerValue"in t)this.Ct(e,15),e.Ft(It(t.integerValue));else if("doubleValue"in t){let r=It(t.doubleValue);isNaN(r)?this.Ct(e,13):(this.Ct(e,15),wo(r)?e.Ft(0):e.Ft(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Ct(e,20),typeof r=="string"&&(r=Pn(r)),e.Mt(`${r.seconds||""}`),e.Ft(r.nanos||0)}else if("stringValue"in t)this.xt(t.stringValue,e),this.Ot(e);else if("bytesValue"in t)this.Ct(e,30),e.Nt(Cn(t.bytesValue)),this.Ot(e);else if("referenceValue"in t)this.Bt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Ct(e,45),e.Ft(r.latitude||0),e.Ft(r.longitude||0)}else"mapValue"in t?ey(t)?this.Ct(e,Number.MAX_SAFE_INTEGER):ty(t)?this.Lt(t.mapValue,e):(this.kt(t.mapValue,e),this.Ot(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Ot(e)):z(19022,{Qt:t})}xt(t,e){this.Ct(e,25),this.$t(t,e)}$t(t,e){e.Mt(t)}kt(t,e){let r=t.fields||{};this.Ct(e,55);for(let s of Object.keys(r))this.xt(s,e),this.Dt(r[s],e)}Lt(t,e){var r,s;let o=t.fields||{};this.Ct(e,53);let u=fi,l=((s=(r=o[u].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.Ct(e,15),e.Ft(It(l)),this.xt(u,e),this.Dt(o[u],e)}qt(t,e){let r=t.values||[];this.Ct(e,50);for(let s of r)this.Dt(s,e)}Bt(t,e){this.Ct(e,37),$.fromName(t).path.forEach(r=>{this.Ct(e,60),this.$t(r,e)})}Ct(t,e){t.Ft(e)}Ot(t){t.Ft(2)}};Fa.Ut=new Fa;var jl=class{constructor(){this.Dn=new zl}addToCollectionParentIndex(t,e){return this.Dn.add(e),D.resolve()}getCollectionParents(t,e){return D.resolve(this.Dn.getEntries(e))}addFieldIndex(t,e){return D.resolve()}deleteFieldIndex(t,e){return D.resolve()}deleteAllFieldIndexes(t){return D.resolve()}createTargetIndexes(t,e){return D.resolve()}getDocumentsMatchingTarget(t,e){return D.resolve(null)}getIndexType(t,e){return D.resolve(0)}getFieldIndexes(t,e){return D.resolve([])}getNextCollectionGroupToUpdate(t){return D.resolve(null)}getMinOffset(t,e){return D.resolve(kr.min())}getMinOffsetFromCollectionGroup(t,e){return D.resolve(kr.min())}updateCollectionGroup(t,e,r){return D.resolve()}updateIndexEntries(t,e){return D.resolve()}},zl=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new Bt(wt.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new Bt(wt.comparator)).toArray()}};var qA=new Uint8Array(0);var hp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},xy=41943040,ye=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};ye.DEFAULT_COLLECTION_PERCENTILE=10,ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ye.DEFAULT=new ye(xy,ye.DEFAULT_COLLECTION_PERCENTILE,ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ye.DISABLED=new ye(-1,0,0);var Ao=class n{constructor(t){this._r=t}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var dp="LruGarbageCollector",uE=1048576;function fp([n,t],[e,r]){let s=nt(n,e);return s===0?nt(t,r):s}var $l=class{constructor(t){this.Tr=t,this.buffer=new Bt(fp),this.Ir=0}dr(){return++this.Ir}Er(t){let e=[t,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();fp(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},Gl=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(t){L(dp,`Garbage collection scheduled in ${t}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Pi(e)?L(dp,"Ignoring IndexedDB error during garbage collection: ",e):await Ri(e)}await this.Rr(3e5)})}},Kl=class{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.mr(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return D.resolve(Wh.ue);let r=new $l(e);return this.Vr.forEachTarget(t,s=>r.Er(s.sequenceNumber)).next(()=>this.Vr.gr(t,s=>r.Er(s))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.Vr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(hp)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hp):this.pr(t,e))}getCacheSize(t){return this.Vr.getCacheSize(t)}pr(t,e){let r,s,o,u,l,h,f,g=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(E=>(E>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),s=this.params.maximumSequenceNumbersToCollect):s=E,u=Date.now(),this.nthSequenceNumber(t,s))).next(E=>(r=E,l=Date.now(),this.removeTargets(t,r,e))).next(E=>(o=E,h=Date.now(),this.removeOrphanedDocuments(t,r))).next(E=>(f=Date.now(),si()<=ot.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-g}ms
	Determined least recently used ${s} in `+(l-u)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${E} documents in `+(f-h)+`ms
Total Duration: ${f-g}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:E})))}};function cE(n,t){return new Kl(n,t)}var Ql=class{constructor(){this.changes=new Vn(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,fe.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?D.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Wl=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Hl=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&go(r.mutation,s,_e.empty(),Vt.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,rt()).next(()=>r))}getLocalViewOfDocuments(t,e,r=rt()){let s=Vr();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(o=>{let u=co();return o.forEach((l,h)=>{u=u.insert(l,h.overlayedDocument)}),u}))}getOverlayedDocuments(t,e){let r=Vr();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,rt()))}populateOverlays(t,e,r){let s=[];return r.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((u,l)=>{e.set(u,l)})})}computeViews(t,e,r,s){let o=xn(),u=mo(),l=(function(){return mo()})();return e.forEach((h,f)=>{let g=r.get(f.key);s.has(f.key)&&(g===void 0||g.mutation instanceof Qe)?o=o.insert(f.key,f):g!==void 0?(u.set(f.key,g.mutation.getFieldMask()),go(g.mutation,f,g.mutation.getFieldMask(),Vt.now())):u.set(f.key,_e.empty())}),this.recalculateAndSaveOverlays(t,o).next(h=>(h.forEach((f,g)=>u.set(f,g)),e.forEach((f,g)=>{var E;return l.set(f,new Wl(g,(E=u.get(f))!==null&&E!==void 0?E:null))}),l))}recalculateAndSaveOverlays(t,e){let r=mo(),s=new At((u,l)=>u-l),o=rt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(u=>{for(let l of u)l.keys().forEach(h=>{let f=e.get(h);if(f===null)return;let g=r.get(h)||_e.empty();g=l.applyToLocalView(f,g),r.set(h,g);let E=(s.get(l.batchId)||rt()).add(h);s=s.insert(l.batchId,E)})}).next(()=>{let u=[],l=s.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),f=h.key,g=h.value,E=fy();g.forEach(T=>{if(!o.has(T)){let S=wy(e.get(T),r.get(T));S!==null&&E.set(T,S),o=o.add(T)}}),u.push(this.documentOverlayCache.saveOverlays(t,f,E))}return D.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return(function(u){return $.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):uy(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(o=>{let u=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):D.resolve(Vr()),l=_o,h=o;return u.next(f=>D.forEach(f,(g,E)=>(l<E.largestBatchId&&(l=E.largestBatchId),o.get(g)?D.resolve():this.remoteDocumentCache.getEntry(t,g).next(T=>{h=h.insert(g,T)}))).next(()=>this.populateOverlays(t,f,o)).next(()=>this.computeViews(t,h,f,rt())).next(g=>({batchId:l,changes:dy(g)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new $(e)).next(r=>{let s=co();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let o=e.collectionGroup,u=co();return this.indexManager.getCollectionParents(t,o).next(l=>D.forEach(l,h=>{let f=(function(E,T){return new Qn(T,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,r,s).next(g=>{g.forEach((E,T)=>{u=u.insert(E,T)})})}).next(()=>u))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(u=>(o=u,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s))).next(u=>{o.forEach((h,f)=>{let g=f.getKey();u.get(g)===null&&(u=u.insert(g,fe.newInvalidDocument(g)))});let l=co();return u.forEach((h,f)=>{let g=o.get(h);g!==void 0&&go(g.mutation,f,_e.empty(),Vt.now()),su(e,f)&&(l=l.insert(h,f))}),l})}};var Jl=class{constructor(t){this.serializer=t,this.Br=new Map,this.Lr=new Map}getBundleMetadata(t,e){return D.resolve(this.Br.get(e))}saveBundleMetadata(t,e){return this.Br.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:de(s.createTime)}})(e)),D.resolve()}getNamedQuery(t,e){return D.resolve(this.Lr.get(e))}saveNamedQuery(t,e){return this.Lr.set(e.name,(function(s){return{name:s.name,query:aE(s.bundledQuery),readTime:de(s.readTime)}})(e)),D.resolve()}};var Xl=class{constructor(){this.overlays=new At($.comparator),this.kr=new Map}getOverlay(t,e){return D.resolve(this.overlays.get(e))}getOverlays(t,e){let r=Vr();return D.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,o)=>{this.wt(t,e,o)}),D.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.kr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.kr.delete(r)),D.resolve()}getOverlaysForCollection(t,e,r){let s=Vr(),o=e.length+1,u=new $(e.child("")),l=this.overlays.getIteratorFrom(u);for(;l.hasNext();){let h=l.getNext().value,f=h.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return D.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new At((f,g)=>f-g),u=this.overlays.getIterator();for(;u.hasNext();){let f=u.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>r){let g=o.get(f.largestBatchId);g===null&&(g=Vr(),o=o.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}let l=Vr(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,g)=>l.set(f,g)),!(l.size()>=s)););return D.resolve(l)}wt(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let u=this.kr.get(s.largestBatchId).delete(r.key);this.kr.set(s.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new Nl(e,r));let o=this.kr.get(e);o===void 0&&(o=rt(),this.kr.set(e,o)),this.kr.set(e,o.add(r.key))}};var Yl=class{constructor(){this.sessionToken=Wt.EMPTY_BYTE_STRING}getSessionToken(t){return D.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,D.resolve()}};var bo=class{constructor(){this.qr=new Bt(Rt.Qr),this.$r=new Bt(Rt.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(t,e){let r=new Rt(t,e);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Wr(new Rt(t,e))}Gr(t,e){t.forEach(r=>this.removeReference(r,e))}zr(t){let e=new $(new wt([])),r=new Rt(e,t),s=new Rt(e,t+1),o=[];return this.$r.forEachInRange([r,s],u=>{this.Wr(u),o.push(u.key)}),o}jr(){this.qr.forEach(t=>this.Wr(t))}Wr(t){this.qr=this.qr.delete(t),this.$r=this.$r.delete(t)}Jr(t){let e=new $(new wt([])),r=new Rt(e,t),s=new Rt(e,t+1),o=rt();return this.$r.forEachInRange([r,s],u=>{o=o.add(u.key)}),o}containsKey(t){let e=new Rt(t,0),r=this.qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},Rt=class{constructor(t,e){this.key=t,this.Hr=e}static Qr(t,e){return $.comparator(t.key,e.key)||nt(t.Hr,e.Hr)}static Ur(t,e){return nt(t.Hr,e.Hr)||$.comparator(t.key,e.key)}};var Zl=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.er=1,this.Yr=new Bt(Rt.Qr)}checkEmpty(t){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let o=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let u=new xl(o,e,r,s);this.mutationQueue.push(u);for(let l of s)this.Yr=this.Yr.add(new Rt(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return D.resolve(u)}lookupMutationBatch(t,e){return D.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.Xr(r),o=s<0?0:s;return D.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?Hh:this.er-1)}getAllMutationBatches(t){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new Rt(e,0),s=new Rt(e,Number.POSITIVE_INFINITY),o=[];return this.Yr.forEachInRange([r,s],u=>{let l=this.Zr(u.Hr);o.push(l)}),D.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new Bt(nt);return e.forEach(s=>{let o=new Rt(s,0),u=new Rt(s,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([o,u],l=>{r=r.add(l.Hr)})}),D.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,o=r;$.isDocumentKey(o)||(o=o.child(""));let u=new Rt(new $(o),0),l=new Bt(nt);return this.Yr.forEachWhile(h=>{let f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(l=l.add(h.Hr)),!0)},u),D.resolve(this.ei(l))}ei(t){let e=[];return t.forEach(r=>{let s=this.Zr(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){ut(this.ti(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return D.forEach(e.mutations,s=>{let o=new Rt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.Yr=r})}rr(t){}containsKey(t,e){let r=new Rt(e,0),s=this.Yr.firstAfterOrEqual(r);return D.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,D.resolve()}ti(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){let e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var th=class{constructor(t){this.ni=t,this.docs=(function(){return new At($.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),o=s?s.size:0,u=this.ni(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return D.resolve(r?r.document.mutableCopy():fe.newInvalidDocument(e))}getEntries(t,e){let r=xn();return e.forEach(s=>{let o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():fe.newInvalidDocument(s))}),D.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=xn(),u=e.path,l=new $(u.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:f,value:{document:g}}=h.getNext();if(!u.isPrefixOf(f.path))break;f.path.length>u.length+1||lI(cI(g),r)<=0||(s.has(g.key)||su(e,g))&&(o=o.insert(g.key,g.mutableCopy()))}return D.resolve(o)}getAllFromCollectionGroup(t,e,r,s){z(9500)}ri(t,e){return D.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new eh(this)}getSize(t){return D.resolve(this.size)}},eh=class extends Ql{constructor(t){super(),this.Or=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.Or.addEntry(t,s)):this.Or.removeEntry(r)}),D.waitFor(e)}getFromCache(t,e){return this.Or.getEntry(t,e)}getAllFromCache(t,e){return this.Or.getEntries(t,e)}};var nh=class{constructor(t){this.persistence=t,this.ii=new Vn(e=>td(e),ed),this.lastRemoteSnapshotVersion=J.min(),this.highestTargetId=0,this.si=0,this.oi=new bo,this.targetCount=0,this._i=Ao.ar()}forEachTarget(t,e){return this.ii.forEach((r,s)=>e(s)),D.resolve()}getLastRemoteSnapshotVersion(t){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return D.resolve(this.si)}allocateTargetId(t){return this.highestTargetId=this._i.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.si&&(this.si=e),D.resolve()}hr(t){this.ii.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this._i=new Ao(e),this.highestTargetId=e),t.sequenceNumber>this.si&&(this.si=t.sequenceNumber)}addTargetData(t,e){return this.hr(e),this.targetCount+=1,D.resolve()}updateTargetData(t,e){return this.hr(e),D.resolve()}removeTargetData(t,e){return this.ii.delete(e.target),this.oi.zr(e.targetId),this.targetCount-=1,D.resolve()}removeTargets(t,e,r){let s=0,o=[];return this.ii.forEach((u,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.ii.delete(u),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),D.waitFor(o).next(()=>s)}getTargetCount(t){return D.resolve(this.targetCount)}getTargetData(t,e){let r=this.ii.get(e)||null;return D.resolve(r)}addMatchingKeys(t,e,r){return this.oi.Kr(e,r),D.resolve()}removeMatchingKeys(t,e,r){this.oi.Gr(e,r);let s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(u=>{o.push(s.markPotentiallyOrphaned(t,u))}),D.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.oi.zr(e),D.resolve()}getMatchingKeysForTargetId(t,e){let r=this.oi.Jr(e);return D.resolve(r)}containsKey(t,e){return D.resolve(this.oi.containsKey(e))}};var Ma=class{constructor(t,e){this.ai={},this.overlays={},this.ui=new Wh(0),this.ci=!1,this.ci=!0,this.li=new Yl,this.referenceDelegate=t(this),this.hi=new nh(this),this.indexManager=new jl,this.remoteDocumentCache=(function(s){return new th(s)})(r=>this.referenceDelegate.Pi(r)),this.serializer=new Ul(e),this.Ti=new Jl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Xl,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ai[t.toKey()];return r||(r=new Zl(e,this.referenceDelegate),this.ai[t.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(t,e,r){L("MemoryPersistence","Starting transaction:",t);let s=new rh(this.ui.next());return this.referenceDelegate.Ii(),r(s).next(o=>this.referenceDelegate.di(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ei(t,e){return D.or(Object.values(this.ai).map(r=>()=>r.containsKey(t,e)))}},rh=class extends fl{constructor(t){super(),this.currentSequenceNumber=t}},ih=class n{constructor(t){this.persistence=t,this.Ai=new bo,this.Ri=null}static Vi(t){return new n(t)}get mi(){if(this.Ri)return this.Ri;throw z(60996)}addReference(t,e,r){return this.Ai.addReference(r,e),this.mi.delete(r.toString()),D.resolve()}removeReference(t,e,r){return this.Ai.removeReference(r,e),this.mi.add(r.toString()),D.resolve()}markPotentiallyOrphaned(t,e){return this.mi.add(e.toString()),D.resolve()}removeTarget(t,e){this.Ai.zr(e.targetId).forEach(s=>this.mi.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.mi.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}Ii(){this.Ri=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.mi,r=>{let s=$.fromPath(r);return this.fi(t,s).next(o=>{o||e.removeEntry(s,J.min())})}).next(()=>(this.Ri=null,e.apply(t)))}updateLimboDocument(t,e){return this.fi(t,e).next(r=>{r?this.mi.delete(e.toString()):this.mi.add(e.toString())})}Pi(t){return 0}fi(t,e){return D.or([()=>D.resolve(this.Ai.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}},La=class n{constructor(t,e){this.persistence=t,this.gi=new Vn(r=>mI(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=cE(this,e)}static Vi(t,e){return new n(t,e)}Ii(){}di(t){return D.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}mr(t){let e=this.yr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(s=>r+s))}yr(t){let e=0;return this.gr(t,r=>{e++}).next(()=>e)}gr(t,e){return D.forEach(this.gi,(r,s)=>this.Sr(t,r,s).next(o=>o?D.resolve():e(s)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ri(t,u=>this.Sr(t,u,e).next(l=>{l||(r++,o.removeEntry(u,J.min()))})).next(()=>o.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.gi.set(e,t.currentSequenceNumber),D.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.gi.set(r,t.currentSequenceNumber),D.resolve()}removeReference(t,e,r){return this.gi.set(r,t.currentSequenceNumber),D.resolve()}updateLimboDocument(t,e){return this.gi.set(e,t.currentSequenceNumber),D.resolve()}Pi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=_a(t.data.value)),e}Sr(t,e,r){return D.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let s=this.gi.get(e);return D.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var sh=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Is=r,this.ds=s}static Es(t,e){let r=rt(),s=rt();for(let o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new n(t,e.fromCache,r,s)}};var oh=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var ah=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return Eg()?8:dI(Ig())>0?6:4})()}initialize(t,e){this.gs=t,this.indexManager=e,this.As=!0}getDocumentsMatchingQuery(t,e,r,s){let o={result:null};return this.ps(t,e).next(u=>{o.result=u}).next(()=>{if(!o.result)return this.ys(t,e,s,r).next(u=>{o.result=u})}).next(()=>{if(o.result)return;let u=new oh;return this.ws(t,e,u).next(l=>{if(o.result=l,this.Rs)return this.Ss(t,e,u,l.size)})}).next(()=>o.result)}Ss(t,e,r,s){return r.documentReadCount<this.Vs?(si()<=ot.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",oi(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),D.resolve()):(si()<=ot.DEBUG&&L("QueryEngine","Query:",oi(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.fs*s?(si()<=ot.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",oi(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ge(e))):D.resolve())}ps(t,e){if(ep(e))return D.resolve(null);let r=Ge(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Pl(e,null,"F"),r=Ge(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{let u=rt(...o);return this.gs.getDocuments(t,u).next(l=>this.indexManager.getMinOffset(t,r).next(h=>{let f=this.bs(e,l);return this.Ds(e,f,u,h.readTime)?this.ps(t,Pl(e,null,"F")):this.vs(t,f,e,h)}))})))}ys(t,e,r,s){return ep(e)||s.isEqual(J.min())?D.resolve(null):this.gs.getDocuments(t,r).next(o=>{let u=this.bs(e,o);return this.Ds(e,u,r,s)?D.resolve(null):(si()<=ot.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),oi(e)),this.vs(t,u,e,uI(s,_o)).next(l=>l))})}bs(t,e){let r=new Bt(ly(t));return e.forEach((s,o)=>{su(t,o)&&(r=r.add(o))}),r}Ds(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ws(t,e,r){return si()<=ot.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",oi(e)),this.gs.getDocumentsMatchingQuery(t,e,kr.min(),r)}vs(t,e,r,s){return this.gs.getDocumentsMatchingQuery(t,r,s).next(o=>(e.forEach(u=>{o=o.insert(u.key,u)}),o))}};var id="LocalStore",lE=3e8,uh=class{constructor(t,e,r,s){this.persistence=t,this.Cs=e,this.serializer=s,this.Fs=new At(nt),this.Ms=new Vn(o=>td(o),ed),this.xs=new Map,this.Os=t.getRemoteDocumentCache(),this.hi=t.getTargetCache(),this.Ti=t.getBundleCache(),this.Ns(r)}Ns(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Hl(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Fs))}};function hE(n,t,e,r){return new uh(n,t,e,r)}async function Dy(n,t){let e=X(n);return await e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,e.Ns(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{let u=[],l=[],h=rt();for(let f of s){u.push(f.batchId);for(let g of f.mutations)h=h.add(g.key)}for(let f of o){l.push(f.batchId);for(let g of f.mutations)h=h.add(g.key)}return e.localDocuments.getDocuments(r,h).next(f=>({Bs:f,removedBatchIds:u,addedBatchIds:l}))})})}function dE(n,t){let e=X(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),o=e.Os.newChangeBuffer({trackRemovals:!0});return(function(l,h,f,g){let E=f.batch,T=E.keys(),S=D.resolve();return T.forEach(C=>{S=S.next(()=>g.getEntry(h,C)).next(V=>{let P=f.docVersions.get(C);ut(P!==null,48541),V.version.compareTo(P)<0&&(E.applyToRemoteDocument(V,f),V.isValidDocument()&&(V.setReadTime(f.commitVersion),g.addEntry(V)))})}),S.next(()=>l.mutationQueue.removeMutationBatch(h,E))})(e,r,t,o).next(()=>o.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=rt();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h})(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function Ny(n){let t=X(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function fE(n,t){let e=X(n),r=t.snapshotVersion,s=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let u=e.Os.newChangeBuffer({trackRemovals:!0});s=e.Fs;let l=[];t.targetChanges.forEach((g,E)=>{let T=s.get(E);if(!T)return;l.push(e.hi.removeMatchingKeys(o,g.removedDocuments,E).next(()=>e.hi.addMatchingKeys(o,g.addedDocuments,E)));let S=T.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(E)!==null?S=S.withResumeToken(Wt.EMPTY_BYTE_STRING,J.min()).withLastLimboFreeSnapshotVersion(J.min()):g.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(g.resumeToken,r)),s=s.insert(E,S),(function(V,P,M){return V.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=lE?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0})(T,S,g)&&l.push(e.hi.updateTargetData(o,S))});let h=xn(),f=rt();if(t.documentUpdates.forEach(g=>{t.resolvedLimboDocuments.has(g)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,g))}),l.push(mE(o,u,t.documentUpdates).next(g=>{h=g.Ls,f=g.ks})),!r.isEqual(J.min())){let g=e.hi.getLastRemoteSnapshotVersion(o).next(E=>e.hi.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(g)}return D.waitFor(l).next(()=>u.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(e.Fs=s,o))}function mE(n,t,e){let r=rt(),s=rt();return e.forEach(o=>r=r.add(o)),t.getEntries(n,r).next(o=>{let u=xn();return e.forEach((l,h)=>{let f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(J.min())?(t.removeEntry(l,h.readTime),u=u.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(h),u=u.insert(l,h)):L(id,"Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{Ls:u,ks:s}})}function gE(n,t){let e=X(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=Hh),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function pE(n,t){let e=X(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.hi.getTargetData(r,t).next(o=>o?(s=o,D.resolve(s)):e.hi.allocateTargetId(r).next(u=>(s=new To(t,u,"TargetPurposeListen",r.currentSequenceNumber),e.hi.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=e.Fs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(r.targetId,r),e.Ms.set(t,r.targetId)),r})}async function ch(n,t,e){let r=X(n),s=r.Fs.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,u=>r.persistence.referenceDelegate.removeTarget(u,s))}catch(u){if(!Pi(u))throw u;L(id,`Failed to update sequence numbers for target ${t}: ${u}`)}r.Fs=r.Fs.remove(t),r.Ms.delete(s.target)}function mp(n,t,e){let r=X(n),s=J.min(),o=rt();return r.persistence.runTransaction("Execute query","readwrite",u=>(function(h,f,g){let E=X(h),T=E.Ms.get(g);return T!==void 0?D.resolve(E.Fs.get(T)):E.hi.getTargetData(f,g)})(r,u,Ge(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(u,l.targetId).next(h=>{o=h})}).next(()=>r.Cs.getDocumentsMatchingQuery(u,t,e?s:J.min(),e?o:rt())).next(l=>(yE(r,xI(t),l),{documents:l,qs:o})))}function yE(n,t,e){let r=n.xs.get(t)||J.min();e.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.xs.set(t,r)}var qa=class{constructor(){this.activeTargetIds=MI()}Gs(t){this.activeTargetIds=this.activeTargetIds.add(t)}zs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var lh=class{constructor(){this.Fo=new qa,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Fo.Gs(t),this.Mo[t]||"not-current"}updateQueryState(t,e,r){this.Mo[t]=e}removeLocalQueryTarget(t){this.Fo.zs(t)}isLocalQueryTarget(t){return this.Fo.activeTargetIds.has(t)}clearQueryState(t){delete this.Mo[t]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(t){return this.Fo.activeTargetIds.has(t)}start(){return this.Fo=new qa,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var hh=class{xo(t){}shutdown(){}};var gp="ConnectivityMonitor",Ba=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(t){this.ko.push(t)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){L(gp,"Network connectivity changed: AVAILABLE");for(let t of this.ko)t(0)}Lo(){L(gp,"Network connectivity changed: UNAVAILABLE");for(let t of this.ko)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ya=null;function dh(){return ya===null?ya=(function(){return 268435456+Math.round(2147483648*Math.random())})():ya++,"0x"+ya.toString(16)}var nl="RestConnection",_E={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},fh=class{get Qo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.$o=e+"://"+t.host,this.Uo=`projects/${r}/databases/${s}`,this.Ko=this.databaseId.database===Sa?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(t,e,r,s,o){let u=dh(),l=this.Go(t,e.toUriEncodedString());L(nl,`Sending RPC '${t}' ${u}:`,l,r);let h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(h,s,o);let{host:f}=new URL(l),g=la(f);return this.jo(t,l,h,r,g).then(E=>(L(nl,`Received RPC '${t}' ${u}: `,E),E),E=>{throw Gn(nl,`RPC '${t}' ${u} failed with error: `,E,"url: ",l,"request:",r),E})}Jo(t,e,r,s,o,u){return this.Wo(t,e,r,s,o)}zo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Si})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((s,o)=>t[o]=s),r&&r.headers.forEach((s,o)=>t[o]=s)}Go(t,e){let r=_E[t];return`${this.$o}/v1/${e}:${r}`}terminate(){}};var mh=class{constructor(t){this.Ho=t.Ho,this.Yo=t.Yo}Zo(t){this.Xo=t}e_(t){this.t_=t}n_(t){this.r_=t}onMessage(t){this.i_=t}close(){this.Yo()}send(t){this.Ho(t)}s_(){this.Xo()}o_(){this.t_()}__(t){this.r_(t)}a_(t){this.i_(t)}};var Qt="WebChannelConnection",gh=class extends fh{constructor(t){super(t),this.u_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}jo(t,e,r,s,o){let u=dh();return new Promise((l,h)=>{let f=new Xc;f.setWithCredentials(!0),f.listenOnce(Yc.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case uo.NO_ERROR:let E=f.getResponseJson();L(Qt,`XHR for RPC '${t}' ${u} received:`,JSON.stringify(E)),l(E);break;case uo.TIMEOUT:L(Qt,`RPC '${t}' ${u} timed out`),h(new O(x.DEADLINE_EXCEEDED,"Request time out"));break;case uo.HTTP_ERROR:let T=f.getStatus();if(L(Qt,`RPC '${t}' ${u} failed with status:`,T,"response text:",f.getResponseText()),T>0){let S=f.getResponseJson();Array.isArray(S)&&(S=S[0]);let C=S?.error;if(C&&C.status&&C.message){let V=(function(M){let F=M.toLowerCase().replace(/_/g,"-");return Object.values(x).indexOf(F)>=0?F:x.UNKNOWN})(C.status);h(new O(V,C.message))}else h(new O(x.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new O(x.UNAVAILABLE,"Connection failed."));break;default:z(9055,{c_:t,streamId:u,l_:f.getLastErrorCode(),h_:f.getLastError()})}}finally{L(Qt,`RPC '${t}' ${u} completed.`)}});let g=JSON.stringify(s);L(Qt,`RPC '${t}' ${u} sending request:`,s),f.send(e,"POST",g,r,15)})}P_(t,e,r){let s=dh(),o=[this.$o,"/","google.firestore.v1.Firestore","/",t,"/channel"],u=el(),l=tl(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.zo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;let g=o.join("");L(Qt,`Creating RPC '${t}' stream ${s}: ${g}`,h);let E=u.createWebChannel(g,h);this.T_(E);let T=!1,S=!1,C=new mh({Ho:P=>{S?L(Qt,`Not sending because RPC '${t}' stream ${s} is closed:`,P):(T||(L(Qt,`Opening RPC '${t}' stream ${s} transport.`),E.open(),T=!0),L(Qt,`RPC '${t}' stream ${s} sending:`,P),E.send(P))},Yo:()=>E.close()}),V=(P,M,F)=>{P.listen(M,q=>{try{F(q)}catch(H){setTimeout(()=>{throw H},0)}})};return V(E,ii.EventType.OPEN,()=>{S||(L(Qt,`RPC '${t}' stream ${s} transport opened.`),C.s_())}),V(E,ii.EventType.CLOSE,()=>{S||(S=!0,L(Qt,`RPC '${t}' stream ${s} transport closed`),C.__(),this.I_(E))}),V(E,ii.EventType.ERROR,P=>{S||(S=!0,Gn(Qt,`RPC '${t}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),C.__(new O(x.UNAVAILABLE,"The operation could not be completed")))}),V(E,ii.EventType.MESSAGE,P=>{var M;if(!S){let F=P.data[0];ut(!!F,16349);let q=F,H=q?.error||((M=q[0])===null||M===void 0?void 0:M.error);if(H){L(Qt,`RPC '${t}' stream ${s} received error:`,H);let vt=H.status,K=(function(y){let _=St[y];if(_!==void 0)return Ey(_)})(vt),v=H.message;K===void 0&&(K=x.INTERNAL,v="Unknown error status: "+vt+" with message "+H.message),S=!0,C.__(new O(K,v)),E.close()}else L(Qt,`RPC '${t}' stream ${s} received:`,F),C.a_(F)}}),V(l,Zc.STAT_EVENT,P=>{P.stat===ma.PROXY?L(Qt,`RPC '${t}' stream ${s} detected buffering proxy`):P.stat===ma.NOPROXY&&L(Qt,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.o_()},0),C}terminate(){this.u_.forEach(t=>t.close()),this.u_=[]}T_(t){this.u_.push(t)}I_(t){this.u_=this.u_.filter(e=>e===t)}};function rl(){return typeof document<"u"?document:null}function ou(n){return new Ml(n,!0)}var So=class{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Fi=t,this.timerId=e,this.d_=r,this.E_=s,this.A_=o,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(t){this.cancel();let e=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),s=Math.max(0,e-r);s>0&&L("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.R_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,s,()=>(this.m_=Date.now(),t())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var pp="PersistentStream",Ua=class{constructor(t,e,r,s,o,u,l,h){this.Fi=t,this.w_=r,this.S_=s,this.connection=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new So(t,e)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(t){this.q_(),this.stream.send(t)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,t!==4?this.F_.reset():e&&e.code===x.RESOURCE_EXHAUSTED?(Rn(e.toString()),Rn("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):e&&e.code===x.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.n_(e)}U_(){}auth(){this.state=1;let t=this.K_(this.b_),e=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.b_===e&&this.W_(r,s)},r=>{t(()=>{let s=new O(x.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(s)})})}W_(t,e){let r=this.K_(this.b_);this.stream=this.z_(t,e),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(s=>{r(()=>this.G_(s))}),this.stream.onMessage(s=>{r(()=>++this.C_==1?this.j_(s):this.onNext(s))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(t){return L(pp,`close with error: ${t}`),this.stream=null,this.close(4,t)}K_(t){return e=>{this.Fi.enqueueAndForget(()=>this.b_===t?e():(L(pp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ph=class extends Ua{constructor(t,e,r,s,o,u){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,u),this.serializer=o}z_(t,e){return this.connection.P_("Listen",t,e)}j_(t){return this.onNext(t)}onNext(t){this.F_.reset();let e=XI(this.serializer,t),r=(function(o){if(!("targetChange"in o))return J.min();let u=o.targetChange;return u.targetIds&&u.targetIds.length?J.min():u.readTime?de(u.readTime):J.min()})(t);return this.listener.J_(e,r)}H_(t){let e={};e.database=Bl(this.serializer),e.addTarget=(function(o,u){let l,h=u.target;if(l=Sl(h)?{documents:ZI(o,h)}:{query:tE(o,h).Vt},l.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){l.resumeToken=Ty(o,u.resumeToken);let f=Ll(o,u.expectedCount);f!==null&&(l.expectedCount=f)}else if(u.snapshotVersion.compareTo(J.min())>0){l.readTime=ka(o,u.snapshotVersion.toTimestamp());let f=Ll(o,u.expectedCount);f!==null&&(l.expectedCount=f)}return l})(this.serializer,t);let r=nE(this.serializer,t);r&&(e.labels=r),this.k_(e)}Y_(t){let e={};e.database=Bl(this.serializer),e.removeTarget=t,this.k_(e)}},yh=class extends Ua{constructor(t,e,r,s,o,u){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,u),this.serializer=o}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(t,e){return this.connection.P_("Write",t,e)}j_(t){return ut(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,ut(!t.writeResults||t.writeResults.length===0,55816),this.listener.ea()}onNext(t){ut(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.F_.reset();let e=YI(t.writeResults,t.commitTime),r=de(t.commitTime);return this.listener.ta(r,e)}na(){let t={};t.database=Bl(this.serializer),this.k_(t)}X_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>Ry(this.serializer,r))};this.k_(e)}};var _h=class{},wh=class extends _h{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ra=!1}ia(){if(this.ra)throw new O(x.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,r,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Wo(t,ql(e,r),s,o,u)).catch(o=>{throw o.name==="FirebaseError"?(o.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(x.UNKNOWN,o.toString())})}Jo(t,e,r,s,o){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,l])=>this.connection.Jo(t,ql(e,r),s,u,l,o)).catch(u=>{throw u.name==="FirebaseError"?(u.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new O(x.UNKNOWN,u.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},vh=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(t){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ua("Offline")))}set(t){this.ha(),this.sa=0,t==="Online"&&(this._a=!1),this.ua(t)}ua(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ca(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Rn(e),this._a=!1):L("OnlineStateTracker",e)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var Br="RemoteStore",Ih=class{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=o,this.Ea.xo(u=>{r.enqueueAndForget(async()=>{jr(this)&&(L(Br,"Restarting streams for network reachability change."),await(async function(h){let f=X(h);f.Ia.add(4),await Do(f),f.Aa.set("Unknown"),f.Ia.delete(4),await au(f)})(this))})}),this.Aa=new vh(r,s)}};async function au(n){if(jr(n))for(let t of n.da)await t(!0)}async function Do(n){for(let t of n.da)await t(!1)}function ky(n,t){let e=X(n);e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),ud(e)?ad(e):Ci(e).x_()&&od(e,t))}function sd(n,t){let e=X(n),r=Ci(e);e.Ta.delete(t),r.x_()&&Oy(e,t),e.Ta.size===0&&(r.x_()?r.B_():jr(e)&&e.Aa.set("Unknown"))}function od(n,t){if(n.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(J.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Ci(n).H_(t)}function Oy(n,t){n.Ra.$e(t),Ci(n).Y_(t)}function ad(n){n.Ra=new Fl({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>n.Ta.get(t)||null,lt:()=>n.datastore.serializer.databaseId}),Ci(n).start(),n.Aa.aa()}function ud(n){return jr(n)&&!Ci(n).M_()&&n.Ta.size>0}function jr(n){return X(n).Ia.size===0}function Fy(n){n.Ra=void 0}async function wE(n){n.Aa.set("Online")}async function vE(n){n.Ta.forEach((t,e)=>{od(n,t)})}async function IE(n,t){Fy(n),ud(n)?(n.Aa.la(t),ad(n)):n.Aa.set("Unknown")}async function EE(n,t,e){if(n.Aa.set("Online"),t instanceof Da&&t.state===2&&t.cause)try{await(async function(s,o){let u=o.cause;for(let l of o.targetIds)s.Ta.has(l)&&(await s.remoteSyncer.rejectListen(l,u),s.Ta.delete(l),s.Ra.removeTarget(l))})(n,t)}catch(r){L(Br,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await ja(n,r)}else if(t instanceof li?n.Ra.Ye(t):t instanceof xa?n.Ra.it(t):n.Ra.et(t),!e.isEqual(J.min()))try{let r=await Ny(n.localStore);e.compareTo(r)>=0&&await(function(o,u){let l=o.Ra.Pt(u);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){let g=o.Ta.get(f);g&&o.Ta.set(f,g.withResumeToken(h.resumeToken,u))}}),l.targetMismatches.forEach((h,f)=>{let g=o.Ta.get(h);if(!g)return;o.Ta.set(h,g.withResumeToken(Wt.EMPTY_BYTE_STRING,g.snapshotVersion)),Oy(o,h);let E=new To(g.target,h,f,g.sequenceNumber);od(o,E)}),o.remoteSyncer.applyRemoteEvent(l)})(n,e)}catch(r){L(Br,"Failed to raise snapshot:",r),await ja(n,r)}}async function ja(n,t,e){if(!Pi(t))throw t;n.Ia.add(1),await Do(n),n.Aa.set("Offline"),e||(e=()=>Ny(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{L(Br,"Retrying IndexedDB access"),await e(),n.Ia.delete(1),await au(n)})}function My(n,t){return t().catch(e=>ja(n,e,t))}async function uu(n){let t=X(n),e=Wn(t),r=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:Hh;for(;TE(t);)try{let s=await gE(t.localStore,r);if(s===null){t.Pa.length===0&&e.B_();break}r=s.batchId,AE(t,s)}catch(s){await ja(t,s)}Ly(t)&&qy(t)}function TE(n){return jr(n)&&n.Pa.length<10}function AE(n,t){n.Pa.push(t);let e=Wn(n);e.x_()&&e.Z_&&e.X_(t.mutations)}function Ly(n){return jr(n)&&!Wn(n).M_()&&n.Pa.length>0}function qy(n){Wn(n).start()}async function bE(n){Wn(n).na()}async function SE(n){let t=Wn(n);for(let e of n.Pa)t.X_(e.mutations)}async function RE(n,t,e){let r=n.Pa.shift(),s=Dl.from(r,t,e);await My(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await uu(n)}async function PE(n,t){t&&Wn(n).Z_&&await(async function(r,s){if((function(u){return Iy(u)&&u!==x.ABORTED})(s.code)){let o=r.Pa.shift();Wn(r).N_(),await My(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),await uu(r)}})(n,t),Ly(n)&&qy(n)}async function yp(n,t){let e=X(n);e.asyncQueue.verifyOperationInProgress(),L(Br,"RemoteStore received new credentials");let r=jr(e);e.Ia.add(3),await Do(e),r&&e.Aa.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),await au(e)}async function CE(n,t){let e=X(n);t?(e.Ia.delete(2),await au(e)):t||(e.Ia.add(2),await Do(e),e.Aa.set("Unknown"))}function Ci(n){return n.Va||(n.Va=(function(e,r,s){let o=X(e);return o.ia(),new ph(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Zo:wE.bind(null,n),e_:vE.bind(null,n),n_:IE.bind(null,n),J_:EE.bind(null,n)}),n.da.push(async t=>{t?(n.Va.N_(),ud(n)?ad(n):n.Aa.set("Unknown")):(await n.Va.stop(),Fy(n))})),n.Va}function Wn(n){return n.ma||(n.ma=(function(e,r,s){let o=X(e);return o.ia(),new yh(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:bE.bind(null,n),n_:PE.bind(null,n),ea:SE.bind(null,n),ta:RE.bind(null,n)}),n.da.push(async t=>{t?(n.ma.N_(),await uu(n)):(await n.ma.stop(),n.Pa.length>0&&(L(Br,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))})),n.ma}var Eh=class n{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new we,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){let u=Date.now()+r,l=new n(t,e,u,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(x.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function cd(n,t){if(Rn("AsyncQueue",`${t}: ${n}`),Pi(n))return new O(x.UNAVAILABLE,`${t}: ${n}`);throw n}var za=class n{static emptySet(t){return new n(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||$.comparator(e.key,r.key):(e,r)=>$.comparator(e.key,r.key),this.keyedMap=co(),this.sortedSet=new At(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var $a=class{constructor(){this.fa=new At($.comparator)}track(t){let e=t.doc.key,r=this.fa.get(e);r?t.type!==0&&r.type===3?this.fa=this.fa.insert(e,t):t.type===3&&r.type!==1?this.fa=this.fa.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.fa=this.fa.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.fa=this.fa.remove(e):t.type===1&&r.type===2?this.fa=this.fa.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):z(63341,{At:t,ga:r}):this.fa=this.fa.insert(e,t)}pa(){let t=[];return this.fa.inorderTraversal((e,r)=>{t.push(r)}),t}},Ii=class n{constructor(t,e,r,s,o,u,l,h,f){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(t,e,r,s,o){let u=[];return e.forEach(l=>{u.push({type:0,doc:l})}),new n(t,e,za.emptySet(e),u,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&iu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}};var Th=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(t=>t.ba())}},Ah=class{constructor(){this.queries=_p(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(e,r){let s=X(e),o=s.queries;s.queries=_p(),o.forEach((u,l)=>{for(let h of l.wa)h.onError(r)})})(this,new O(x.ABORTED,"Firestore shutting down"))}};function _p(){return new Vn(n=>cy(n),iu)}async function ld(n,t){let e=X(n),r=3,s=t.query,o=e.queries.get(s);o?!o.Sa()&&t.ba()&&(r=2):(o=new Th,r=t.ba()?0:1);try{switch(r){case 0:o.ya=await e.onListen(s,!0);break;case 1:o.ya=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(u){let l=cd(u,`Initialization of query '${oi(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.wa.push(t),t.va(e.onlineState),o.ya&&t.Ca(o.ya)&&dd(e)}async function hd(n,t){let e=X(n),r=t.query,s=3,o=e.queries.get(r);if(o){let u=o.wa.indexOf(t);u>=0&&(o.wa.splice(u,1),o.wa.length===0?s=t.ba()?0:1:!o.Sa()&&t.ba()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function VE(n,t){let e=X(n),r=!1;for(let s of t){let o=s.query,u=e.queries.get(o);if(u){for(let l of u.wa)l.Ca(s)&&(r=!0);u.ya=s}}r&&dd(e)}function xE(n,t,e){let r=X(n),s=r.queries.get(t);if(s)for(let o of s.wa)o.onError(e);r.queries.delete(t)}function dd(n){n.Da.forEach(t=>{t.next()})}var bh,wp;(wp=bh||(bh={})).Fa="default",wp.Cache="cache";var Ro=class{constructor(t,e,r){this.query=t,this.Ma=e,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new Ii(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.xa?this.Na(t)&&(this.Ma.next(t),e=!0):this.Ba(t,this.onlineState)&&(this.La(t),e=!0),this.Oa=t,e}onError(t){this.Ma.error(t)}va(t){this.onlineState=t;let e=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,t)&&(this.La(this.Oa),e=!0),e}Ba(t,e){if(!t.fromCache||!this.ba())return!0;let r=e!=="Offline";return(!this.options.ka||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Na(t){if(t.docChanges.length>0)return!0;let e=this.Oa&&this.Oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}La(t){t=Ii.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.xa=!0,this.Ma.next(t)}ba(){return this.options.source!==bh.Cache}};var Ga=class{constructor(t){this.key=t}},Ka=class{constructor(t){this.key=t}},Sh=class{constructor(t,e){this.query=t,this.Ha=e,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=rt(),this.mutatedKeys=rt(),this.Xa=ly(t),this.eu=new za(this.Xa)}get tu(){return this.Ha}nu(t,e){let r=e?e.ru:new $a,s=e?e.eu:this.eu,o=e?e.mutatedKeys:this.mutatedKeys,u=s,l=!1,h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((g,E)=>{let T=s.get(g),S=su(this.query,E)?E:null,C=!!T&&this.mutatedKeys.has(T.key),V=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),P=!1;T&&S?T.data.isEqual(S.data)?C!==V&&(r.track({type:3,doc:S}),P=!0):this.iu(T,S)||(r.track({type:2,doc:S}),P=!0,(h&&this.Xa(S,h)>0||f&&this.Xa(S,f)<0)&&(l=!0)):!T&&S?(r.track({type:0,doc:S}),P=!0):T&&!S&&(r.track({type:1,doc:T}),P=!0,(h||f)&&(l=!0)),P&&(S?(u=u.add(S),o=V?o.add(g):o.delete(g)):(u=u.delete(g),o=o.delete(g)))}),this.query.limit!==null)for(;u.size>this.query.limit;){let g=this.query.limitType==="F"?u.last():u.first();u=u.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{eu:u,ru:r,Ds:l,mutatedKeys:o}}iu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){let o=this.eu;this.eu=t.eu,this.mutatedKeys=t.mutatedKeys;let u=t.ru.pa();u.sort((g,E)=>(function(S,C){let V=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z(20277,{At:P})}};return V(S)-V(C)})(g.type,E.type)||this.Xa(g.doc,E.doc)),this.su(r),s=s!=null&&s;let l=e&&!s?this.ou():[],h=this.Za.size===0&&this.current&&!s?1:0,f=h!==this.Ya;return this.Ya=h,u.length!==0||f?{snapshot:new Ii(this.query,t.eu,o,u,t.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:l}:{_u:l}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new $a,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(t){return!this.Ha.has(t)&&!!this.eu.has(t)&&!this.eu.get(t).hasLocalMutations}su(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}ou(){if(!this.current)return[];let t=this.Za;this.Za=rt(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let e=[];return t.forEach(r=>{this.Za.has(r)||e.push(new Ka(r))}),this.Za.forEach(r=>{t.has(r)||e.push(new Ga(r))}),e}uu(t){this.Ha=t.qs,this.Za=rt();let e=this.nu(t.documents);return this.applyChanges(e,!0)}cu(){return Ii.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},fd="SyncEngine",Rh=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Ph=class{constructor(t){this.key=t,this.lu=!1}},Ch=class{constructor(t,e,r,s,o,u){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.hu={},this.Pu=new Vn(l=>cy(l),iu),this.Tu=new Map,this.Iu=new Set,this.du=new At($.comparator),this.Eu=new Map,this.Au=new bo,this.Ru={},this.Vu=new Map,this.mu=Ao.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};async function DE(n,t,e=!0){let r=Gy(n),s,o=r.Pu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.cu()):s=await By(r,t,e,!0),s}async function NE(n,t){let e=Gy(n);await By(e,t,!0,!1)}async function By(n,t,e,r){let s=await pE(n.localStore,Ge(t)),o=s.targetId,u=n.sharedClientState.addLocalQueryTarget(o,e),l;return r&&(l=await kE(n,t,o,u==="current",s.resumeToken)),n.isPrimaryClient&&e&&ky(n.remoteStore,s),l}async function kE(n,t,e,r,s){n.gu=(E,T,S)=>(async function(V,P,M,F){let q=P.view.nu(M);q.Ds&&(q=await mp(V.localStore,P.query,!1).then(({documents:v})=>P.view.nu(v,q)));let H=F&&F.targetChanges.get(P.targetId),vt=F&&F.targetMismatches.get(P.targetId)!=null,K=P.view.applyChanges(q,V.isPrimaryClient,H,vt);return Ip(V,P.targetId,K._u),K.snapshot})(n,E,T,S);let o=await mp(n.localStore,t,!0),u=new Sh(t,o.qs),l=u.nu(o.documents),h=Eo.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),f=u.applyChanges(l,n.isPrimaryClient,h);Ip(n,e,f._u);let g=new Rh(t,e,u);return n.Pu.set(t,g),n.Tu.has(e)?n.Tu.get(e).push(t):n.Tu.set(e,[t]),f.snapshot}async function OE(n,t,e){let r=X(n),s=r.Pu.get(t),o=r.Tu.get(s.targetId);if(o.length>1)return r.Tu.set(s.targetId,o.filter(u=>!iu(u,t))),void r.Pu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ch(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&sd(r.remoteStore,s.targetId),Vh(r,s.targetId)}).catch(Ri)):(Vh(r,s.targetId),await ch(r.localStore,s.targetId,!0))}async function FE(n,t){let e=X(n),r=e.Pu.get(t),s=e.Tu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),sd(e.remoteStore,r.targetId))}async function ME(n,t,e){let r=$E(n);try{let s=await(function(u,l){let h=X(u),f=Vt.now(),g=l.reduce((S,C)=>S.add(C.key),rt()),E,T;return h.persistence.runTransaction("Locally write mutations","readwrite",S=>{let C=xn(),V=rt();return h.Os.getEntries(S,g).next(P=>{C=P,C.forEach((M,F)=>{F.isValidDocument()||(V=V.add(M))})}).next(()=>h.localDocuments.getOverlayedDocuments(S,C)).next(P=>{E=P;let M=[];for(let F of l){let q=zI(F,E.get(F.key).overlayedDocument);q!=null&&M.push(new Qe(F.key,q,ny(q.value.mapValue),ne.exists(!0)))}return h.mutationQueue.addMutationBatch(S,f,M,l)}).next(P=>{T=P;let M=P.applyToLocalDocumentSet(E,V);return h.documentOverlayCache.saveOverlays(S,P.batchId,M)})}).then(()=>({batchId:T.batchId,changes:dy(E)}))})(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),(function(u,l,h){let f=u.Ru[u.currentUser.toKey()];f||(f=new At(nt)),f=f.insert(l,h),u.Ru[u.currentUser.toKey()]=f})(r,s.batchId,e),await No(r,s.changes),await uu(r.remoteStore)}catch(s){let o=cd(s,"Failed to persist write");e.reject(o)}}async function Uy(n,t){let e=X(n);try{let r=await fE(e.localStore,t);t.targetChanges.forEach((s,o)=>{let u=e.Eu.get(o);u&&(ut(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?u.lu=!0:s.modifiedDocuments.size>0?ut(u.lu,14607):s.removedDocuments.size>0&&(ut(u.lu,42227),u.lu=!1))}),await No(e,r,t)}catch(r){await Ri(r)}}function vp(n,t,e){let r=X(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.Pu.forEach((o,u)=>{let l=u.view.va(t);l.snapshot&&s.push(l.snapshot)}),(function(u,l){let h=X(u);h.onlineState=l;let f=!1;h.queries.forEach((g,E)=>{for(let T of E.wa)T.va(l)&&(f=!0)}),f&&dd(h)})(r.eventManager,t),s.length&&r.hu.J_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function LE(n,t,e){let r=X(n);r.sharedClientState.updateQueryState(t,"rejected",e);let s=r.Eu.get(t),o=s&&s.key;if(o){let u=new At($.comparator);u=u.insert(o,fe.newNoDocument(o,J.min()));let l=rt().add(o),h=new Va(J.min(),new Map,new At(nt),u,l);await Uy(r,h),r.du=r.du.remove(o),r.Eu.delete(t),md(r)}else await ch(r.localStore,t,!1).then(()=>Vh(r,t,e)).catch(Ri)}async function qE(n,t){let e=X(n),r=t.batch.batchId;try{let s=await dE(e.localStore,t);zy(e,r,null),jy(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await No(e,s)}catch(s){await Ri(s)}}async function BE(n,t,e){let r=X(n);try{let s=await(function(u,l){let h=X(u);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let g;return h.mutationQueue.lookupMutationBatch(f,l).next(E=>(ut(E!==null,37113),g=E.keys(),h.mutationQueue.removeMutationBatch(f,E))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,g,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g)).next(()=>h.localDocuments.getDocuments(f,g))})})(r.localStore,t);zy(r,t,e),jy(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await No(r,s)}catch(s){await Ri(s)}}function jy(n,t){(n.Vu.get(t)||[]).forEach(e=>{e.resolve()}),n.Vu.delete(t)}function zy(n,t,e){let r=X(n),s=r.Ru[r.currentUser.toKey()];if(s){let o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Ru[r.currentUser.toKey()]=s}}function Vh(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Tu.get(t))n.Pu.delete(r),e&&n.hu.pu(r,e);n.Tu.delete(t),n.isPrimaryClient&&n.Au.zr(t).forEach(r=>{n.Au.containsKey(r)||$y(n,r)})}function $y(n,t){n.Iu.delete(t.path.canonicalString());let e=n.du.get(t);e!==null&&(sd(n.remoteStore,e),n.du=n.du.remove(t),n.Eu.delete(e),md(n))}function Ip(n,t,e){for(let r of e)r instanceof Ga?(n.Au.addReference(r.key,t),UE(n,r)):r instanceof Ka?(L(fd,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,t),n.Au.containsKey(r.key)||$y(n,r.key)):z(19791,{yu:r})}function UE(n,t){let e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Iu.has(r)||(L(fd,"New document in limbo: "+e),n.Iu.add(r),md(n))}function md(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let t=n.Iu.values().next().value;n.Iu.delete(t);let e=new $(wt.fromString(t)),r=n.mu.next();n.Eu.set(r,new Ph(e)),n.du=n.du.insert(e,r),ky(n.remoteStore,new To(Ge(ru(e.path)),r,"TargetPurposeLimboResolution",Wh.ue))}}async function No(n,t,e){let r=X(n),s=[],o=[],u=[];r.Pu.isEmpty()||(r.Pu.forEach((l,h)=>{u.push(r.gu(h,t,e).then(f=>{var g;if((f||e)&&r.isPrimaryClient){let E=f?!f.fromCache:(g=e?.targetChanges.get(h.targetId))===null||g===void 0?void 0:g.current;r.sharedClientState.updateQueryState(h.targetId,E?"current":"not-current")}if(f){s.push(f);let E=sh.Es(h.targetId,f);o.push(E)}}))}),await Promise.all(u),r.hu.J_(s),await(async function(h,f){let g=X(h);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",E=>D.forEach(f,T=>D.forEach(T.Is,S=>g.persistence.referenceDelegate.addReference(E,T.targetId,S)).next(()=>D.forEach(T.ds,S=>g.persistence.referenceDelegate.removeReference(E,T.targetId,S)))))}catch(E){if(!Pi(E))throw E;L(id,"Failed to update sequence numbers: "+E)}for(let E of f){let T=E.targetId;if(!E.fromCache){let S=g.Fs.get(T),C=S.snapshotVersion,V=S.withLastLimboFreeSnapshotVersion(C);g.Fs=g.Fs.insert(T,V)}}})(r.localStore,o))}async function jE(n,t){let e=X(n);if(!e.currentUser.isEqual(t)){L(fd,"User change. New user:",t.toKey());let r=await Dy(e.localStore,t);e.currentUser=t,(function(o,u){o.Vu.forEach(l=>{l.forEach(h=>{h.reject(new O(x.CANCELLED,u))})}),o.Vu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await No(e,r.Bs)}}function zE(n,t){let e=X(n),r=e.Eu.get(t);if(r&&r.lu)return rt().add(r.key);{let s=rt(),o=e.Tu.get(t);if(!o)return s;for(let u of o){let l=e.Pu.get(u);s=s.unionWith(l.view.tu)}return s}}function Gy(n){let t=X(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Uy.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=zE.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=LE.bind(null,t),t.hu.J_=VE.bind(null,t.eventManager),t.hu.pu=xE.bind(null,t.eventManager),t}function $E(n){let t=X(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=qE.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=BE.bind(null,t),t}var Ky=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ou(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,r){return null}Fu(e,r){return null}vu(e){return hE(this.persistence,new ah,e.initialUser,this.serializer)}Du(e){return new Ma(ih.Vi,this.serializer)}bu(e){return new lh}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return n.provider={build:()=>new n},n})(),xh=class extends Ky{constructor(t){super(),this.cacheSizeBytes=t}Cu(t,e){ut(this.persistence.referenceDelegate instanceof La,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Gl(r,t.asyncQueue,e)}Du(t){let e=this.cacheSizeBytes!==void 0?ye.withCacheSize(this.cacheSizeBytes):ye.DEFAULT;return new Ma(r=>La.Vi(r,e),this.serializer)}};var GE=(()=>{class n{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>vp(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=jE.bind(null,this.syncEngine),await CE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Ah})()}createDatastore(e){let r=ou(e.databaseInfo.databaseId),s=(function(u){return new gh(u)})(e.databaseInfo);return(function(u,l,h,f){return new wh(u,l,h,f)})(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return(function(s,o,u,l,h){return new Ih(s,o,u,l,h)})(this.localStore,this.datastore,e.asyncQueue,r=>vp(this.syncEngine,r,0),(function(){return Ba.C()?new Ba:new hh})())}createSyncEngine(e,r){return(function(o,u,l,h,f,g,E){let T=new Ch(o,u,l,h,f,g);return E&&(T.fu=!0),T})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await(async function(o){let u=X(o);L(Br,"RemoteStore shutting down."),u.Ia.add(5),await Do(u),u.Ea.shutdown(),u.Aa.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}return n.provider={build:()=>new n},n})();var Po=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.xu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.xu(this.observer.error,t):Rn("Uncaught Error in snapshot listener:",t.toString()))}Ou(){this.muted=!0}xu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var Dh=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new O(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=await(async function(s,o){let u=X(s),l={documents:o.map(E=>Oa(u.serializer,E))},h=await u.Jo("BatchGetDocuments",u.serializer.databaseId,wt.emptyPath(),l,o.length),f=new Map;h.forEach(E=>{let T=JI(u.serializer,E);f.set(T.key.toString(),T)});let g=[];return o.forEach(E=>{let T=f.get(E.toString());ut(!!T,55234,{key:E}),g.push(T)}),g})(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new vi(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let s=$.fromPath(r);this.mutations.push(new Ca(s,this.precondition(s)))}),await(async function(r,s){let o=X(r),u={writes:s.map(l=>Ry(o.serializer,l))};await o.Wo("Commit",o.serializer.databaseId,wt.emptyPath(),u)})(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw z(50498,{Wu:t.constructor.name});e=J.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new O(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(J.min())?ne.exists(!1):ne.updateTime(e):ne.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(J.min()))throw new O(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ne.updateTime(e)}return ne.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Nh=class{constructor(t,e,r,s,o){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=s,this.deferred=o,this.Gu=r.maxAttempts,this.F_=new So(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(async()=>{let t=new Dh(this.datastore),e=this.Ju(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Hu(s)}))}).catch(r=>{this.Hu(r)})})}Ju(t){try{let e=this.updateFunction(t);return!xo(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(t){this.Gu>0&&this.Yu(t)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(t)}Yu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Iy(e)}return!1}};var Hn="FirestoreClient",kh=class{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=qt.UNAUTHENTICATED,this.clientId=yo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async u=>{L(Hn,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u}),this.appCheckCredentials.start(r,u=>(L(Hn,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new we;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=cd(e,"Failed to shutdown persistence");t.reject(r)}}),t.promise}};async function il(n,t){n.asyncQueue.verifyOperationInProgress(),L(Hn,"Initializing OfflineComponentProvider");let e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Dy(t.localStore,s),r=s)}),t.persistence.setDatabaseDeletedListener(()=>{Gn("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{L("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(s=>{Gn("Terminating Firestore due to IndexedDb database deletion failed",s)})}),n._offlineComponents=t}async function Ep(n,t){n.asyncQueue.verifyOperationInProgress();let e=await KE(n);L(Hn,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>yp(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>yp(t.remoteStore,s)),n._onlineComponents=t}async function KE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(Hn,"Using user provided OfflineComponentProvider");try{await il(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===x.FAILED_PRECONDITION||s.code===x.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;Gn("Error using user provided cache. Falling back to memory cache: "+e),await il(n,new Ky)}}else L(Hn,"Using default OfflineComponentProvider"),await il(n,new xh(void 0));return n._offlineComponents}async function gd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(Hn,"Using user provided OnlineComponentProvider"),await Ep(n,n._uninitializedComponentsProvider._online)):(L(Hn,"Using default OnlineComponentProvider"),await Ep(n,new GE))),n._onlineComponents}function QE(n){return gd(n).then(t=>t.syncEngine)}function WE(n){return gd(n).then(t=>t.datastore)}async function Qa(n){let t=await gd(n),e=t.eventManager;return e.onListen=DE.bind(null,t.syncEngine),e.onUnlisten=OE.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=NE.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=FE.bind(null,t.syncEngine),e}function HE(n,t,e={}){let r=new we;return n.asyncQueue.enqueueAndForget(async()=>(function(o,u,l,h,f){let g=new Po({next:T=>{g.Ou(),u.enqueueAndForget(()=>hd(o,E));let S=T.docs.has(l);!S&&T.fromCache?f.reject(new O(x.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&T.fromCache&&h&&h.source==="server"?f.reject(new O(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(T)},error:T=>f.reject(T)}),E=new Ro(ru(l.path),g,{includeMetadataChanges:!0,ka:!0});return ld(o,E)})(await Qa(n),n.asyncQueue,t,e,r)),r.promise}function JE(n,t,e={}){let r=new we;return n.asyncQueue.enqueueAndForget(async()=>(function(o,u,l,h,f){let g=new Po({next:T=>{g.Ou(),u.enqueueAndForget(()=>hd(o,E)),T.fromCache&&h.source==="server"?f.reject(new O(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(T)},error:T=>f.reject(T)}),E=new Ro(l,g,{includeMetadataChanges:!0,ka:!0});return ld(o,E)})(await Qa(n),n.asyncQueue,t,e,r)),r.promise}function Qy(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var Tp=new Map;var Wy="firestore.googleapis.com",Ap=!0,Wa=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new O(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Wy,this.ssl=Ap}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:Ap;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=xy;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<uE)throw new O(x.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}aI("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Qy((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new O(x.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Ei=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wa({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new O(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wa(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new sl;switch(r.type){case"firstParty":return new cl(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){let r=Tp.get(e);r&&(L("ComponentProvider","Removing Datastore"),Tp.delete(e),r.terminate())})(this),Promise.resolve()}};function XE(n,t,e,r={}){var s;n=re(n,Ei);let o=la(t),u=n._getSettings(),l=Object.assign(Object.assign({},u),{emulatorOptions:n._getEmulatorOptions()}),h=`${t}:${e}`;o&&(_g(`https://${h}`),vg("Firestore",!0)),u.host!==Wy&&u.host!==h&&Gn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let f=Object.assign(Object.assign({},u),{host:h,ssl:o,emulatorOptions:r});if(!ei(f,l)&&(n._setSettings(f),r.mockUserToken)){let g,E;if(typeof r.mockUserToken=="string")g=r.mockUserToken,E=qt.MOCK_USER;else{g=wg(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);let T=r.mockUserToken.sub||r.mockUserToken.user_id;if(!T)throw new O(x.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");E=new qt(T)}n._authCredentials=new ol(new Ia(g,E))}}var Jn=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},xt=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Un(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(Vo(e,n._jsonSchema))return new n(t,r||null,new $(wt.fromString(e.referencePath)))}};xt._jsonSchemaVersion="firestore/documentReference/1.0",xt._jsonSchema={type:Ct("string",xt._jsonSchemaVersion),referencePath:Ct("string")};var Un=class n extends Jn{constructor(t,e,r){super(t,e,ru(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new xt(this.firestore,null,new $(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function BA(n,t,...e){if(n=le(n),Dp("collection","path",t),n instanceof Ei){let r=wt.fromString(t,...e);return jg(r),new Un(n,null,r)}{if(!(n instanceof xt||n instanceof Un))throw new O(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(wt.fromString(t,...e));return jg(r),new Un(n.firestore,null,r)}}function YE(n,t,...e){if(n=le(n),arguments.length===1&&(t=yo.newId()),Dp("doc","path",t),n instanceof Ei){let r=wt.fromString(t,...e);return Ug(r),new xt(n,null,new $(r))}{if(!(n instanceof xt||n instanceof Un))throw new O(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(wt.fromString(t,...e));return Ug(r),new xt(n.firestore,n instanceof Un?n.converter:null,new $(r))}}var bp="AsyncQueue",Ha=class{constructor(t=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new So(this,"async_queue_retry"),this.oc=()=>{let r=rl();r&&L(bp,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=t;let e=rl();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ac(),this.uc(t)}enterRestrictedMode(t){if(!this.Xu){this.Xu=!0,this.rc=t||!1;let e=rl();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.oc)}}enqueue(t){if(this.ac(),this.Xu)return new Promise(()=>{});let e=new we;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Zu.push(t),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(t){if(!Pi(t))throw t;L(bp,"Operation failed with retryable error: "+t)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(t){let e=this._c.then(()=>(this.nc=!0,t().catch(r=>{throw this.tc=r,this.nc=!1,Rn("INTERNAL UNHANDLED ERROR: ",Sp(r)),r}).then(r=>(this.nc=!1,r))));return this._c=e,e}enqueueAfterDelay(t,e,r){this.ac(),this.sc.indexOf(t)>-1&&(e=0);let s=Eh.createAndSchedule(this,t,e,r,o=>this.lc(o));return this.ec.push(s),s}ac(){this.tc&&z(47125,{hc:Sp(this.tc)})}verifyOperationInProgress(){}async Pc(){let t;do t=this._c,await t;while(t!==this._c)}Tc(t){for(let e of this.ec)if(e.timerId===t)return!0;return!1}Ic(t){return this.Pc().then(()=>{this.ec.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.ec)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Pc()})}dc(t){this.sc.push(t)}lc(t){let e=this.ec.indexOf(t);this.ec.splice(e,1)}};function Sp(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function Rp(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;let s=e;for(let o of r)if(o in s&&typeof s[o]=="function")return!0;return!1})(n,["next","error","complete"])}var ve=class extends Ei{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Ha,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Ha(t),this._firestoreClient=void 0,await t}}};function UA(n,t){let e=typeof n=="object"?n:Dg(),r=typeof n=="string"?n:t||Sa,s=Cg(e,"firestore").getImmediate({identifier:r});if(!s._initialized){let o=yg("firestore");o&&XE(s,...o)}return s}function ko(n){if(n._terminated)throw new O(x.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||ZE(n),n._firestoreClient}function ZE(n){var t,e,r;let s=n._freezeSettings(),o=(function(l,h,f,g){return new ml(l,h,f,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,Qy(g.experimentalLongPollingOptions),g.useFetchStreams,g.isUsingEmulator)})(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new kh(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&(function(l){let h=l?._online.build();return{_offline:l?._offline.build(h),_online:h}})(n._componentsProvider))}var Sn=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(Wt.fromBase64String(t))}catch(e){throw new O(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(Wt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Vo(t,n._jsonSchema))return n.fromBase64String(t.bytes)}};Sn._jsonSchemaVersion="firestore/bytes/1.0",Sn._jsonSchema={type:Ct("string",Sn._jsonSchemaVersion),bytes:Ct("string")};var Ur=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new O(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new he(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Ti=class{constructor(t){this._methodName=t}};var jn=class n{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new O(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new O(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return nt(this._lat,t._lat)||nt(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(t){if(Vo(t,n._jsonSchema))return new n(t.latitude,t.longitude)}};jn._jsonSchemaVersion="firestore/geoPoint/1.0",jn._jsonSchema={type:Ct("string",jn._jsonSchemaVersion),latitude:Ct("number"),longitude:Ct("number")};var zn=class n{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Vo(t,n._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new n(t.vectorValues);throw new O(x.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};zn._jsonSchemaVersion="firestore/vectorValue/1.0",zn._jsonSchema={type:Ct("string",zn._jsonSchemaVersion),vectorValues:Ct("object")};var tT=/^__.*__$/,Oh=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Qe(t,this.data,this.fieldMask,e,this.fieldTransforms):new qr(t,this.data,e,this.fieldTransforms)}},Ja=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Qe(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Hy(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z(40011,{Ec:n})}}var Fh=class n{constructor(t,e,r,s,o,u){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Ac(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Rc({path:r,mc:!1});return s.fc(t),s}gc(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Rc({path:r,mc:!1});return s.Ac(),s}yc(t){return this.Rc({path:void 0,mc:!0})}wc(t){return Ya(t,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ac(){if(this.path)for(let t=0;t<this.path.length;t++)this.fc(this.path.get(t))}fc(t){if(t.length===0)throw this.wc("Document fields must not be empty");if(Hy(this.Ec)&&tT.test(t))throw this.wc('Document fields cannot begin and end with "__"')}},Mh=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||ou(t)}Dc(t,e,r,s=!1){return new Fh({Ec:t,methodName:e,bc:r,path:he.emptyPath(),mc:!1,Sc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Oo(n){let t=n._freezeSettings(),e=ou(n._databaseId);return new Mh(n._databaseId,!!t.ignoreUndefinedProperties,e)}function pd(n,t,e,r,s,o={}){let u=n.Dc(o.merge||o.mergeFields?2:0,t,e,s);yd("Data must be an object, but it was:",u,r);let l=Yy(r,u),h,f;if(o.merge)h=new _e(u.fieldMask),f=u.fieldTransforms;else if(o.mergeFields){let g=[];for(let E of o.mergeFields){let T=qh(t,E,e);if(!u.contains(T))throw new O(x.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);t_(g,T)||g.push(T)}h=new _e(g),f=u.fieldTransforms.filter(E=>h.covers(E.field))}else h=null,f=u.fieldTransforms;return new Oh(new ie(l),h,f)}var Xa=class n extends Ti{_toFieldTransform(t){if(t.Ec!==2)throw t.Ec===1?t.wc(`${this._methodName}() can only appear at the top level of your update data`):t.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};var Lh=class n extends Ti{_toFieldTransform(t){return new Cl(t.path,new Fr)}isEqual(t){return t instanceof n}};function Jy(n,t,e,r){let s=n.Dc(1,t,e);yd("Data must be an object, but it was:",s,r);let o=[],u=ie.empty();Xn(r,(h,f)=>{let g=_d(t,h,e);f=le(f);let E=s.gc(g);if(f instanceof Xa)o.push(g);else{let T=Fo(f,E);T!=null&&(o.push(g),u.set(g,T))}});let l=new _e(o);return new Ja(u,l,s.fieldTransforms)}function Xy(n,t,e,r,s,o){let u=n.Dc(1,t,e),l=[qh(t,r,e)],h=[s];if(o.length%2!=0)throw new O(x.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<o.length;T+=2)l.push(qh(t,o[T])),h.push(o[T+1]);let f=[],g=ie.empty();for(let T=l.length-1;T>=0;--T)if(!t_(f,l[T])){let S=l[T],C=h[T];C=le(C);let V=u.gc(S);if(C instanceof Xa)f.push(S);else{let P=Fo(C,V);P!=null&&(f.push(S),g.set(S,P))}}let E=new _e(f);return new Ja(g,E,u.fieldTransforms)}function eT(n,t,e,r=!1){return Fo(e,n.Dc(r?4:3,t))}function Fo(n,t){if(Zy(n=le(n)))return yd("Unsupported field value:",t,n),Yy(n,t);if(n instanceof Ti)return(function(r,s){if(!Hy(s.Ec))throw s.wc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.wc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.mc&&t.Ec!==4)throw t.wc("Nested arrays are not supported");return(function(r,s){let o=[],u=0;for(let l of r){let h=Fo(l,s.yc(u));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),u++}return{arrayValue:{values:o}}})(n,t)}return(function(r,s){if((r=le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return LI(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=Vt.fromDate(r);return{timestampValue:ka(s.serializer,o)}}if(r instanceof Vt){let o=new Vt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ka(s.serializer,o)}}if(r instanceof jn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Sn)return{bytesValue:Ty(s.serializer,r._byteString)};if(r instanceof xt){let o=s.databaseId,u=r.firestore._databaseId;if(!u.isEqual(o))throw s.wc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:rd(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof zn)return(function(u,l){return{mapValue:{fields:{[Xh]:{stringValue:Yh},[fi]:{arrayValue:{values:u.toArray().map(f=>{if(typeof f!="number")throw l.wc("VectorValues must only contain numeric values.");return nd(l.serializer,f)})}}}}}})(r,s);throw s.wc(`Unsupported field value: ${eu(r)}`)})(n,t)}function Yy(n,t){let e={};return Wp(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Xn(n,(r,s)=>{let o=Fo(s,t.Vc(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function Zy(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Vt||n instanceof jn||n instanceof Sn||n instanceof xt||n instanceof Ti||n instanceof zn)}function yd(n,t,e){if(!Zy(e)||!Np(e)){let r=eu(e);throw r==="an object"?t.wc(n+" a custom object"):t.wc(n+" "+r)}}function qh(n,t,e){if((t=le(t))instanceof Ur)return t._internalPath;if(typeof t=="string")return _d(n,t);throw Ya("Field path arguments must be of type string or ",n,!1,void 0,e)}var nT=new RegExp("[~\\*/\\[\\]]");function _d(n,t,e){if(t.search(nT)>=0)throw Ya(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Ur(...t.split("."))._internalPath}catch{throw Ya(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Ya(n,t,e,r,s){let o=r&&!r.isEmpty(),u=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||u)&&(h+=" (found",o&&(h+=` in field ${r}`),u&&(h+=` in document ${s}`),h+=")"),new O(x.INVALID_ARGUMENT,l+n+h)}function t_(n,t){return n.some(e=>e.isEqual(t))}var Ai=class{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new xt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Bh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(wd("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},Bh=class extends Ai{data(){return super.data()}};function wd(n,t){return typeof t=="string"?_d(n,t):t instanceof Ur?t._internalPath:t._delegate._internalPath}function e_(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Co=class{},Za=class extends Co{};function jA(n,t,...e){let r=[];t instanceof Co&&r.push(t),r=r.concat(e),(function(o){let u=o.filter(h=>h instanceof jh).length,l=o.filter(h=>h instanceof Uh).length;if(u>1||u>0&&l>0)throw new O(x.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let s of r)n=s._apply(n);return n}var Uh=class n extends Za{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return n_(t._query,e),new Jn(t.firestore,t.converter,Rl(t._query,e))}_parse(t){let e=Oo(t.firestore);return(function(o,u,l,h,f,g,E){let T;if(f.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new O(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){Cp(E,g);let C=[];for(let V of E)C.push(Pp(h,o,V));T={arrayValue:{values:C}}}else T=Pp(h,o,E)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||Cp(E,g),T=eT(l,u,E,g==="in"||g==="not-in");return Pt.create(f,g,T)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};var jh=class n extends Co{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:je.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:((function(s,o){let u=s,l=o.getFlattenedFilters();for(let h of l)n_(u,h),u=Rl(u,h)})(t._query,e),new Jn(t.firestore,t.converter,Rl(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var zh=class n extends Za{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=(function(s,o,u){if(s.startAt!==null)throw new O(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new O(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Or(o,u)})(t._query,this._field,this._direction);return new Jn(t.firestore,t.converter,(function(s,o){let u=s.explicitOrderBy.concat([o]);return new Qn(s.path,s.collectionGroup,u,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(t._query,e))}};function zA(n,t="asc"){let e=t,r=wd("orderBy",n);return zh._create(r,e)}function Pp(n,t,e){if(typeof(e=le(e))=="string"){if(e==="")throw new O(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!uy(t)&&e.indexOf("/")!==-1)throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(wt.fromString(e));if(!$.isDocumentKey(r))throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Hg(n,new $(r))}if(e instanceof xt)return Hg(n,e._key);throw new O(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${eu(e)}.`)}function Cp(n,t){if(!Array.isArray(n)||n.length===0)throw new O(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function n_(n,t){let e=(function(s,o){for(let u of s)for(let l of u.getFlattenedFilters())if(o.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new O(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new O(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var tu=class{convertValue(t,e="none"){switch(Kn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return It(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Cn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw z(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return Xn(t,(s,o)=>{r[s]=this.convertValue(o,e)}),r}convertVectorValue(t){var e,r,s;let o=(s=(r=(e=t.fields)===null||e===void 0?void 0:e[fi].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(u=>It(u.doubleValue));return new zn(o)}convertGeoPoint(t){return new jn(It(t.latitude),It(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=nu(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(vo(t));default:return null}}convertTimestamp(t){let e=Pn(t);return new Vt(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=wt.fromString(t);ut(Vy(r),9688,{name:t});let s=new Ra(r.get(1),r.get(3)),o=new $(r.popFirst(5));return s.isEqual(e)||Rn(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function vd(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var $h=class extends tu{constructor(t){super(),this.firestore=t}convertBytes(t){return new Sn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new xt(this.firestore,null,e)}};var Bn=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},$n=class n extends Ai{constructor(t,e,r,s,o,u){super(t,e,r,s,u),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new hi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(wd("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(x.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=n._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};$n._jsonSchemaVersion="firestore/documentSnapshot/1.0",$n._jsonSchema={type:Ct("string",$n._jsonSchemaVersion),bundleSource:Ct("string","DocumentSnapshot"),bundleName:Ct("string"),bundle:Ct("string")};var hi=class extends $n{data(t={}){return super.data(t)}},Dr=class n{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Bn(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new hi(this._firestore,this._userDataWriter,r.key,r,new Bn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let u=0;return s._snapshot.docChanges.map(l=>{let h=new hi(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Bn(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:u++}})}{let u=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let h=new hi(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Bn(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter),f=-1,g=-1;return l.type!==0&&(f=u.indexOf(l.doc.key),u=u.delete(l.doc.key)),l.type!==1&&(u=u.add(l.doc),g=u.indexOf(l.doc.key)),{type:rT(l.type),doc:h,oldIndex:f,newIndex:g}})}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(x.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=n._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=yo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],r=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function rT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z(61501,{type:n})}}function $A(n){n=re(n,xt);let t=re(n.firestore,ve);return HE(ko(t),n._key).then(e=>i_(t,n,e))}Dr._jsonSchemaVersion="firestore/querySnapshot/1.0",Dr._jsonSchema={type:Ct("string",Dr._jsonSchemaVersion),bundleSource:Ct("string","QuerySnapshot"),bundleName:Ct("string"),bundle:Ct("string")};var bi=class extends tu{constructor(t){super(),this.firestore=t}convertBytes(t){return new Sn(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new xt(this.firestore,null,e)}};function GA(n){n=re(n,Jn);let t=re(n.firestore,ve),e=ko(t),r=new bi(t);return e_(n._query),JE(e,n._query).then(s=>new Dr(t,r,n,s))}function KA(n,t,e){n=re(n,xt);let r=re(n.firestore,ve),s=vd(n.converter,t,e);return cu(r,[pd(Oo(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,ne.none())])}function QA(n,t,e,...r){n=re(n,xt);let s=re(n.firestore,ve),o=Oo(s),u;return u=typeof(t=le(t))=="string"||t instanceof Ur?Xy(o,"updateDoc",n._key,t,e,r):Jy(o,"updateDoc",n._key,t),cu(s,[u.toMutation(n._key,ne.exists(!0))])}function WA(n){return cu(re(n.firestore,ve),[new vi(n._key,ne.none())])}function HA(n,t){let e=re(n.firestore,ve),r=YE(n),s=vd(n.converter,t);return cu(e,[pd(Oo(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,ne.exists(!1))]).then(()=>r)}function r_(n,...t){var e,r,s;n=le(n);let o={includeMetadataChanges:!1,source:"default"},u=0;typeof t[u]!="object"||Rp(t[u])||(o=t[u++]);let l={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Rp(t[u])){let E=t[u];t[u]=(e=E.next)===null||e===void 0?void 0:e.bind(E),t[u+1]=(r=E.error)===null||r===void 0?void 0:r.bind(E),t[u+2]=(s=E.complete)===null||s===void 0?void 0:s.bind(E)}let h,f,g;if(n instanceof xt)f=re(n.firestore,ve),g=ru(n._key.path),h={next:E=>{t[u]&&t[u](i_(f,n,E))},error:t[u+1],complete:t[u+2]};else{let E=re(n,Jn);f=re(E.firestore,ve),g=E._query;let T=new bi(f);h={next:S=>{t[u]&&t[u](new Dr(f,T,E,S))},error:t[u+1],complete:t[u+2]},e_(n._query)}return(function(T,S,C,V){let P=new Po(V),M=new Ro(S,P,C);return T.asyncQueue.enqueueAndForget(async()=>ld(await Qa(T),M)),()=>{P.Ou(),T.asyncQueue.enqueueAndForget(async()=>hd(await Qa(T),M))}})(ko(f),g,l,h)}function cu(n,t){return(function(r,s){let o=new we;return r.asyncQueue.enqueueAndForget(async()=>ME(await QE(r),s,o)),o.promise})(ko(n),t)}function i_(n,t,e){let r=e.docs.get(t._key),s=new bi(n);return new $n(n,s,t._key,r,new Bn(e.hasPendingWrites,e.fromCache),t.converter)}var iT={maxAttempts:5};function lo(n,t){if((n=le(n)).firestore!==t)throw new O(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Gh=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Oo(t)}get(t){let e=lo(t,this._firestore),r=new $h(this._firestore);return this._transaction.lookup([e._key]).then(s=>{if(!s||s.length!==1)return z(24041);let o=s[0];if(o.isFoundDocument())return new Ai(this._firestore,r,o.key,o,e.converter);if(o.isNoDocument())return new Ai(this._firestore,r,e._key,null,e.converter);throw z(18433,{doc:o})})}set(t,e,r){let s=lo(t,this._firestore),o=vd(s.converter,e,r),u=pd(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,u),this}update(t,e,r,...s){let o=lo(t,this._firestore),u;return u=typeof(e=le(e))=="string"||e instanceof Ur?Xy(this._dataReader,"Transaction.update",o._key,e,r,s):Jy(this._dataReader,"Transaction.update",o._key,e),this._transaction.update(o._key,u),this}delete(t){let e=lo(t,this._firestore);return this._transaction.delete(e._key),this}};var Kh=class extends Gh{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=lo(t,this._firestore),r=new bi(this._firestore);return super.get(t).then(s=>new $n(this._firestore,r,e._key,s._document,new Bn(!1,!1),e.converter))}};function JA(n,t,e){n=re(n,ve);let r=Object.assign(Object.assign({},iT),e);return(function(o){if(o.maxAttempts<1)throw new O(x.INVALID_ARGUMENT,"Max attempts must be at least 1")})(r),(function(o,u,l){let h=new we;return o.asyncQueue.enqueueAndForget(async()=>{let f=await WE(o);new Nh(o.asyncQueue,f,l,u,h).zu()}),h.promise})(ko(n),s=>t(new Kh(n,s)),r)}function XA(){return new Lh("serverTimestamp")}(function(t,e=!0){(function(s){Si=s})(xg),oo(new En("firestore",(r,{instanceIdentifier:s,options:o})=>{let u=r.getProvider("app").getImmediate(),l=new ve(new al(r.getProvider("auth-internal")),new ll(u,r.getProvider("app-check-internal")),(function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new O(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ra(f.options.projectId,g)})(u,s),u);return o=Object.assign({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),ri(Mg,Lg,t),ri(Mg,Lg,"esm2017")})();var lu=function(){return lu=Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},lu.apply(this,arguments)};var sT={includeMetadataChanges:!1};function s_(n,t){return t===void 0&&(t=sT),new Om(function(e){var r=r_(n,t,{next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)});return{unsubscribe:r}})}function o_(n,t){var e;t===void 0&&(t={});var r=n.data(t);return!n.exists()||typeof r!="object"||r===null||!t.idField?r:lu(lu({},r),(e={},e[t.idField]=n.id,e))}function a_(n){return s_(n,{includeMetadataChanges:!0}).pipe(Fc(function(t){return t.docs}))}function u_(n,t){return t===void 0&&(t={}),a_(n).pipe(Fc(function(e){return e.map(function(r){return o_(r,t)})}))}var c_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},l_={};var Yn,Id;(function(){var n;function t(v,m){function y(){}y.prototype=m.prototype,v.D=m.prototype,v.prototype=new y,v.prototype.constructor=v,v.C=function(_,w,A){for(var p=Array(arguments.length-2),Ot=2;Ot<arguments.length;Ot++)p[Ot-2]=arguments[Ot];return m.prototype[w].apply(_,p)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,m,y){y||(y=0);var _=Array(16);if(typeof m=="string")for(var w=0;16>w;++w)_[w]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(w=0;16>w;++w)_[w]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=v.g[0],y=v.g[1],w=v.g[2];var A=v.g[3],p=m+(A^y&(w^A))+_[0]+3614090360&4294967295;m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[1]+3905402710&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[2]+606105819&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[3]+3250441966&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[4]+4118548399&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[5]+1200080426&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[6]+2821735955&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[7]+4249261313&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[8]+1770035416&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[9]+2336552879&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[10]+4294925233&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[11]+2304563134&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(A^y&(w^A))+_[12]+1804603682&4294967295,m=y+(p<<7&4294967295|p>>>25),p=A+(w^m&(y^w))+_[13]+4254626195&4294967295,A=m+(p<<12&4294967295|p>>>20),p=w+(y^A&(m^y))+_[14]+2792965006&4294967295,w=A+(p<<17&4294967295|p>>>15),p=y+(m^w&(A^m))+_[15]+1236535329&4294967295,y=w+(p<<22&4294967295|p>>>10),p=m+(w^A&(y^w))+_[1]+4129170786&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[6]+3225465664&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[11]+643717713&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[0]+3921069994&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[5]+3593408605&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[10]+38016083&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[15]+3634488961&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[4]+3889429448&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[9]+568446438&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[14]+3275163606&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[3]+4107603335&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[8]+1163531501&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(w^A&(y^w))+_[13]+2850285829&4294967295,m=y+(p<<5&4294967295|p>>>27),p=A+(y^w&(m^y))+_[2]+4243563512&4294967295,A=m+(p<<9&4294967295|p>>>23),p=w+(m^y&(A^m))+_[7]+1735328473&4294967295,w=A+(p<<14&4294967295|p>>>18),p=y+(A^m&(w^A))+_[12]+2368359562&4294967295,y=w+(p<<20&4294967295|p>>>12),p=m+(y^w^A)+_[5]+4294588738&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[8]+2272392833&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[11]+1839030562&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[14]+4259657740&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[1]+2763975236&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[4]+1272893353&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[7]+4139469664&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[10]+3200236656&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[13]+681279174&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[0]+3936430074&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[3]+3572445317&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[6]+76029189&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(y^w^A)+_[9]+3654602809&4294967295,m=y+(p<<4&4294967295|p>>>28),p=A+(m^y^w)+_[12]+3873151461&4294967295,A=m+(p<<11&4294967295|p>>>21),p=w+(A^m^y)+_[15]+530742520&4294967295,w=A+(p<<16&4294967295|p>>>16),p=y+(w^A^m)+_[2]+3299628645&4294967295,y=w+(p<<23&4294967295|p>>>9),p=m+(w^(y|~A))+_[0]+4096336452&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[7]+1126891415&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[14]+2878612391&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[5]+4237533241&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[12]+1700485571&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[3]+2399980690&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[10]+4293915773&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[1]+2240044497&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[8]+1873313359&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[15]+4264355552&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[6]+2734768916&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[13]+1309151649&4294967295,y=w+(p<<21&4294967295|p>>>11),p=m+(w^(y|~A))+_[4]+4149444226&4294967295,m=y+(p<<6&4294967295|p>>>26),p=A+(y^(m|~w))+_[11]+3174756917&4294967295,A=m+(p<<10&4294967295|p>>>22),p=w+(m^(A|~y))+_[2]+718787259&4294967295,w=A+(p<<15&4294967295|p>>>17),p=y+(A^(w|~m))+_[9]+3951481745&4294967295,v.g[0]=v.g[0]+m&4294967295,v.g[1]=v.g[1]+(w+(p<<21&4294967295|p>>>11))&4294967295,v.g[2]=v.g[2]+w&4294967295,v.g[3]=v.g[3]+A&4294967295}r.prototype.u=function(v,m){m===void 0&&(m=v.length);for(var y=m-this.blockSize,_=this.B,w=this.h,A=0;A<m;){if(w==0)for(;A<=y;)s(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<m;)if(_[w++]=v.charCodeAt(A++),w==this.blockSize){s(this,_),w=0;break}}else for(;A<m;)if(_[w++]=v[A++],w==this.blockSize){s(this,_),w=0;break}}this.h=w,this.o+=m},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var m=1;m<v.length-8;++m)v[m]=0;var y=8*this.o;for(m=v.length-8;m<v.length;++m)v[m]=y&255,y/=256;for(this.u(v),v=Array(16),m=y=0;4>m;++m)for(var _=0;32>_;_+=8)v[y++]=this.g[m]>>>_&255;return v};function o(v,m){var y=l;return Object.prototype.hasOwnProperty.call(y,v)?y[v]:y[v]=m(v)}function u(v,m){this.h=m;for(var y=[],_=!0,w=v.length-1;0<=w;w--){var A=v[w]|0;_&&A==m||(y[w]=A,_=!1)}this.g=y}var l={};function h(v){return-128<=v&&128>v?o(v,function(m){return new u([m|0],0>m?-1:0)}):new u([v|0],0>v?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return E;if(0>v)return P(f(-v));for(var m=[],y=1,_=0;v>=y;_++)m[_]=v/y|0,y*=4294967296;return new u(m,0)}function g(v,m){if(v.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(v.charAt(0)=="-")return P(g(v.substring(1),m));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=f(Math.pow(m,8)),_=E,w=0;w<v.length;w+=8){var A=Math.min(8,v.length-w),p=parseInt(v.substring(w,w+A),m);8>A?(A=f(Math.pow(m,A)),_=_.j(A).add(f(p))):(_=_.j(y),_=_.add(f(p)))}return _}var E=h(0),T=h(1),S=h(16777216);n=u.prototype,n.m=function(){if(V(this))return-P(this).m();for(var v=0,m=1,y=0;y<this.g.length;y++){var _=this.i(y);v+=(0<=_?_:4294967296+_)*m,m*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(C(this))return"0";if(V(this))return"-"+P(this).toString(v);for(var m=f(Math.pow(v,6)),y=this,_="";;){var w=H(y,m).g;y=M(y,w.j(m));var A=((0<y.g.length?y.g[0]:y.h)>>>0).toString(v);if(y=w,C(y))return A+_;for(;6>A.length;)A="0"+A;_=A+_}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function C(v){if(v.h!=0)return!1;for(var m=0;m<v.g.length;m++)if(v.g[m]!=0)return!1;return!0}function V(v){return v.h==-1}n.l=function(v){return v=M(this,v),V(v)?-1:C(v)?0:1};function P(v){for(var m=v.g.length,y=[],_=0;_<m;_++)y[_]=~v.g[_];return new u(y,~v.h).add(T)}n.abs=function(){return V(this)?P(this):this},n.add=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0,w=0;w<=m;w++){var A=_+(this.i(w)&65535)+(v.i(w)&65535),p=(A>>>16)+(this.i(w)>>>16)+(v.i(w)>>>16);_=p>>>16,A&=65535,p&=65535,y[w]=p<<16|A}return new u(y,y[y.length-1]&-2147483648?-1:0)};function M(v,m){return v.add(P(m))}n.j=function(v){if(C(this)||C(v))return E;if(V(this))return V(v)?P(this).j(P(v)):P(P(this).j(v));if(V(v))return P(this.j(P(v)));if(0>this.l(S)&&0>v.l(S))return f(this.m()*v.m());for(var m=this.g.length+v.g.length,y=[],_=0;_<2*m;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(var w=0;w<v.g.length;w++){var A=this.i(_)>>>16,p=this.i(_)&65535,Ot=v.i(w)>>>16,Te=v.i(w)&65535;y[2*_+2*w]+=p*Te,F(y,2*_+2*w),y[2*_+2*w+1]+=A*Te,F(y,2*_+2*w+1),y[2*_+2*w+1]+=p*Ot,F(y,2*_+2*w+1),y[2*_+2*w+2]+=A*Ot,F(y,2*_+2*w+2)}for(_=0;_<m;_++)y[_]=y[2*_+1]<<16|y[2*_];for(_=m;_<2*m;_++)y[_]=0;return new u(y,0)};function F(v,m){for(;(v[m]&65535)!=v[m];)v[m+1]+=v[m]>>>16,v[m]&=65535,m++}function q(v,m){this.g=v,this.h=m}function H(v,m){if(C(m))throw Error("division by zero");if(C(v))return new q(E,E);if(V(v))return m=H(P(v),m),new q(P(m.g),P(m.h));if(V(m))return m=H(v,P(m)),new q(P(m.g),m.h);if(30<v.g.length){if(V(v)||V(m))throw Error("slowDivide_ only works with positive integers.");for(var y=T,_=m;0>=_.l(v);)y=vt(y),_=vt(_);var w=K(y,1),A=K(_,1);for(_=K(_,2),y=K(y,2);!C(_);){var p=A.add(_);0>=p.l(v)&&(w=w.add(y),A=p),_=K(_,1),y=K(y,1)}return m=M(v,w.j(m)),new q(w,m)}for(w=E;0<=v.l(m);){for(y=Math.max(1,Math.floor(v.m()/m.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),A=f(y),p=A.j(m);V(p)||0<p.l(v);)y-=_,A=f(y),p=A.j(m);C(A)&&(A=T),w=w.add(A),v=M(v,p)}return new q(w,v)}n.A=function(v){return H(this,v).h},n.and=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)&v.i(_);return new u(y,this.h&v.h)},n.or=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)|v.i(_);return new u(y,this.h|v.h)},n.xor=function(v){for(var m=Math.max(this.g.length,v.g.length),y=[],_=0;_<m;_++)y[_]=this.i(_)^v.i(_);return new u(y,this.h^v.h)};function vt(v){for(var m=v.g.length+1,y=[],_=0;_<m;_++)y[_]=v.i(_)<<1|v.i(_-1)>>>31;return new u(y,v.h)}function K(v,m){var y=m>>5;m%=32;for(var _=v.g.length-y,w=[],A=0;A<_;A++)w[A]=0<m?v.i(A+y)>>>m|v.i(A+y+1)<<32-m:v.i(A+y);return new u(w,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Id=l_.Md5=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=f,u.fromString=g,Yn=l_.Integer=u}).apply(typeof c_<"u"?c_:typeof self<"u"?self:typeof window<"u"?window:{});var hu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Dn={};var Ed,oT,Vi,Td,Mo,du,Ad,bd,Sd;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(i,a,c){return i==Array.prototype||i==Object.prototype||(i[a]=c.value),i};function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof hu=="object"&&hu];for(var a=0;a<i.length;++a){var c=i[a];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")}var r=e(this);function s(i,a){if(a)t:{var c=r;i=i.split(".");for(var d=0;d<i.length-1;d++){var I=i[d];if(!(I in c))break t;c=c[I]}i=i[i.length-1],d=c[i],a=a(d),a!=d&&a!=null&&t(c,i,{configurable:!0,writable:!0,value:a})}}function o(i,a){i instanceof String&&(i+="");var c=0,d=!1,I={next:function(){if(!d&&c<i.length){var b=c++;return{value:a(b,i[b]),done:!1}}return d=!0,{done:!0,value:void 0}}};return I[Symbol.iterator]=function(){return I},I}s("Array.prototype.values",function(i){return i||function(){return o(this,function(a,c){return c})}});var u=u||{},l=this||self;function h(i){var a=typeof i;return a=a!="object"?a:i?Array.isArray(i)?"array":a:"null",a=="array"||a=="object"&&typeof i.length=="number"}function f(i){var a=typeof i;return a=="object"&&i!=null||a=="function"}function g(i,a,c){return i.call.apply(i.bind,arguments)}function E(i,a,c){if(!i)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var I=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(I,d),i.apply(a,I)}}return function(){return i.apply(a,arguments)}}function T(i,a,c){return T=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?g:E,T.apply(null,arguments)}function S(i,a){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();return d.push.apply(d,arguments),i.apply(this,d)}}function C(i,a){function c(){}c.prototype=a.prototype,i.aa=a.prototype,i.prototype=new c,i.prototype.constructor=i,i.Qb=function(d,I,b){for(var R=Array(arguments.length-2),j=2;j<arguments.length;j++)R[j-2]=arguments[j];return a.prototype[I].apply(d,R)}}function V(i){let a=i.length;if(0<a){let c=Array(a);for(let d=0;d<a;d++)c[d]=i[d];return c}return[]}function P(i,a){for(let c=1;c<arguments.length;c++){let d=arguments[c];if(h(d)){let I=i.length||0,b=d.length||0;i.length=I+b;for(let R=0;R<b;R++)i[I+R]=d[R]}else i.push(d)}}class M{constructor(a,c){this.i=a,this.j=c,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}function F(i){return/^[\s\xa0]*$/.test(i)}function q(){var i=l.navigator;return i&&(i=i.userAgent)?i:""}function H(i){return H[" "](i),i}H[" "]=function(){};var vt=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function K(i,a,c){for(let d in i)a.call(c,i[d],d,i)}function v(i,a){for(let c in i)a.call(void 0,i[c],c,i)}function m(i){let a={};for(let c in i)a[c]=i[c];return a}let y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function _(i,a){let c,d;for(let I=1;I<arguments.length;I++){d=arguments[I];for(c in d)i[c]=d[c];for(let b=0;b<y.length;b++)c=y[b],Object.prototype.hasOwnProperty.call(d,c)&&(i[c]=d[c])}}function w(i){var a=1;i=i.split(":");let c=[];for(;0<a&&i.length;)c.push(i.shift()),a--;return i.length&&c.push(i.join(":")),c}function A(i){l.setTimeout(()=>{throw i},0)}function p(){var i=ir;let a=null;return i.g&&(a=i.g,i.g=i.g.next,i.g||(i.h=null),a.next=null),a}class Ot{constructor(){this.h=this.g=null}add(a,c){let d=Te.get();d.set(a,c),this.h?this.h.next=d:this.g=d,this.h=d}}var Te=new M(()=>new ec,i=>i.reset());class ec{constructor(){this.next=this.g=this.h=null}set(a,c){this.h=a,this.g=c,this.next=null}reset(){this.next=this.g=this.h=null}}let Ae,be=!1,ir=new Ot,Zi=()=>{let i=l.Promise.resolve(void 0);Ae=()=>{i.then(nc)}};var nc=()=>{for(var i;i=p();){try{i.h.call(i.g)}catch(c){A(c)}var a=Te;a.j(i),100>a.h&&(a.h++,i.next=a.g,a.g=i)}be=!1};function jt(){this.s=this.s,this.C=this.C}jt.prototype.s=!1,jt.prototype.ma=function(){this.s||(this.s=!0,this.N())},jt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function lt(i,a){this.type=i,this.g=this.target=a,this.defaultPrevented=!1}lt.prototype.h=function(){this.defaultPrevented=!0};var rc=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,a=Object.defineProperty({},"passive",{get:function(){i=!0}});try{let c=()=>{};l.addEventListener("test",c,a),l.removeEventListener("test",c,a)}catch{}return i})();function Se(i,a){if(lt.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i){var c=this.type=i.type,d=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;if(this.target=i.target||i.srcElement,this.g=a,a=i.relatedTarget){if(vt){t:{try{H(a.nodeName);var I=!0;break t}catch{}I=!1}I||(a=null)}}else c=="mouseover"?a=i.fromElement:c=="mouseout"&&(a=i.toElement);this.relatedTarget=a,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=typeof i.pointerType=="string"?i.pointerType:ic[i.pointerType]||"",this.state=i.state,this.i=i,i.defaultPrevented&&Se.aa.h.call(this)}}C(Se,lt);var ic={2:"touch",3:"pen",4:"mouse"};Se.prototype.h=function(){Se.aa.h.call(this);var i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Re="closure_listenable_"+(1e6*Math.random()|0),sc=0;function oc(i,a,c,d,I){this.listener=i,this.proxy=null,this.src=a,this.type=c,this.capture=!!d,this.ha=I,this.key=++sc,this.da=this.fa=!1}function nn(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function rn(i){this.src=i,this.g={},this.h=0}rn.prototype.add=function(i,a,c,d,I){var b=i.toString();i=this.g[b],i||(i=this.g[b]=[],this.h++);var R=or(i,a,d,I);return-1<R?(a=i[R],c||(a.fa=!1)):(a=new oc(a,this.src,b,!!d,I),a.fa=c,i.push(a)),a};function sr(i,a){var c=a.type;if(c in i.g){var d=i.g[c],I=Array.prototype.indexOf.call(d,a,void 0),b;(b=0<=I)&&Array.prototype.splice.call(d,I,1),b&&(nn(a),i.g[c].length==0&&(delete i.g[c],i.h--))}}function or(i,a,c,d){for(var I=0;I<i.length;++I){var b=i[I];if(!b.da&&b.listener==a&&b.capture==!!c&&b.ha==d)return I}return-1}var ar="closure_lm_"+(1e6*Math.random()|0),ur={};function ts(i,a,c,d,I){if(d&&d.once)return ns(i,a,c,d,I);if(Array.isArray(a)){for(var b=0;b<a.length;b++)ts(i,a[b],c,d,I);return null}return c=dr(c),i&&i[Re]?i.K(a,c,f(d)?!!d.capture:!!d,I):es(i,a,c,!1,d,I)}function es(i,a,c,d,I,b){if(!a)throw Error("Invalid event type");var R=f(I)?!!I.capture:!!I,j=lr(i);if(j||(i[ar]=j=new rn(i)),c=j.add(a,c,d,R,b),c.proxy)return c;if(d=ac(),c.proxy=d,d.src=i,d.listener=c,i.addEventListener)rc||(I=R),I===void 0&&(I=!1),i.addEventListener(a.toString(),d,I);else if(i.attachEvent)i.attachEvent(is(a.toString()),d);else if(i.addListener&&i.removeListener)i.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return c}function ac(){function i(c){return a.call(i.src,i.listener,c)}let a=uc;return i}function ns(i,a,c,d,I){if(Array.isArray(a)){for(var b=0;b<a.length;b++)ns(i,a[b],c,d,I);return null}return c=dr(c),i&&i[Re]?i.L(a,c,f(d)?!!d.capture:!!d,I):es(i,a,c,!0,d,I)}function rs(i,a,c,d,I){if(Array.isArray(a))for(var b=0;b<a.length;b++)rs(i,a[b],c,d,I);else d=f(d)?!!d.capture:!!d,c=dr(c),i&&i[Re]?(i=i.i,a=String(a).toString(),a in i.g&&(b=i.g[a],c=or(b,c,d,I),-1<c&&(nn(b[c]),Array.prototype.splice.call(b,c,1),b.length==0&&(delete i.g[a],i.h--)))):i&&(i=lr(i))&&(a=i.g[a.toString()],i=-1,a&&(i=or(a,c,d,I)),(c=-1<i?a[i]:null)&&cr(c))}function cr(i){if(typeof i!="number"&&i&&!i.da){var a=i.src;if(a&&a[Re])sr(a.i,i);else{var c=i.type,d=i.proxy;a.removeEventListener?a.removeEventListener(c,d,i.capture):a.detachEvent?a.detachEvent(is(c),d):a.addListener&&a.removeListener&&a.removeListener(d),(c=lr(a))?(sr(c,i),c.h==0&&(c.src=null,a[ar]=null)):nn(i)}}}function is(i){return i in ur?ur[i]:ur[i]="on"+i}function uc(i,a){if(i.da)i=!0;else{a=new Se(a,this);var c=i.listener,d=i.ha||i.src;i.fa&&cr(i),i=c.call(d,a)}return i}function lr(i){return i=i[ar],i instanceof rn?i:null}var hr="__closure_events_fn_"+(1e9*Math.random()>>>0);function dr(i){return typeof i=="function"?i:(i[hr]||(i[hr]=function(a){return i.handleEvent(a)}),i[hr])}function ht(){jt.call(this),this.i=new rn(this),this.M=this,this.F=null}C(ht,jt),ht.prototype[Re]=!0,ht.prototype.removeEventListener=function(i,a,c,d){rs(this,i,a,c,d)};function gt(i,a){var c,d=i.F;if(d)for(c=[];d;d=d.F)c.push(d);if(i=i.M,d=a.type||a,typeof a=="string")a=new lt(a,i);else if(a instanceof lt)a.target=a.target||i;else{var I=a;a=new lt(d,i),_(a,I)}if(I=!0,c)for(var b=c.length-1;0<=b;b--){var R=a.g=c[b];I=sn(R,d,!0,a)&&I}if(R=a.g=i,I=sn(R,d,!0,a)&&I,I=sn(R,d,!1,a)&&I,c)for(b=0;b<c.length;b++)R=a.g=c[b],I=sn(R,d,!1,a)&&I}ht.prototype.N=function(){if(ht.aa.N.call(this),this.i){var i=this.i,a;for(a in i.g){for(var c=i.g[a],d=0;d<c.length;d++)nn(c[d]);delete i.g[a],i.h--}}this.F=null},ht.prototype.K=function(i,a,c,d){return this.i.add(String(i),a,!1,c,d)},ht.prototype.L=function(i,a,c,d){return this.i.add(String(i),a,!0,c,d)};function sn(i,a,c,d){if(a=i.i.g[String(a)],!a)return!0;a=a.concat();for(var I=!0,b=0;b<a.length;++b){var R=a[b];if(R&&!R.da&&R.capture==c){var j=R.listener,st=R.ha||R.src;R.fa&&sr(i.i,R),I=j.call(st,d)!==!1&&I}}return I&&!d.defaultPrevented}function ss(i,a,c){if(typeof i=="function")c&&(i=T(i,c));else if(i&&typeof i.handleEvent=="function")i=T(i.handleEvent,i);else throw Error("Invalid listener argument");return 2147483647<Number(a)?-1:l.setTimeout(i,a||0)}function os(i){i.g=ss(()=>{i.g=null,i.i&&(i.i=!1,os(i))},i.l);let a=i.h;i.h=null,i.m.apply(null,a)}class cc extends jt{constructor(a,c){super(),this.m=a,this.l=c,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:os(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pe(i){jt.call(this),this.h=i,this.g={}}C(Pe,jt);var as=[];function us(i){K(i.g,function(a,c){this.g.hasOwnProperty(c)&&cr(a)},i),i.g={}}Pe.prototype.N=function(){Pe.aa.N.call(this),us(this)},Pe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fr=l.JSON.stringify,lc=l.JSON.parse,hc=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function mr(){}mr.prototype.h=null;function cs(i){return i.h||(i.h=i.i())}function ls(){}var Ce={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function gr(){lt.call(this,"d")}C(gr,lt);function pr(){lt.call(this,"c")}C(pr,lt);var Yt={},hs=null;function on(){return hs=hs||new ht}Yt.La="serverreachability";function ds(i){lt.call(this,Yt.La,i)}C(ds,lt);function Ve(i){let a=on();gt(a,new ds(a))}Yt.STAT_EVENT="statevent";function fs(i,a){lt.call(this,Yt.STAT_EVENT,i),this.stat=a}C(fs,lt);function pt(i){let a=on();gt(a,new fs(a,i))}Yt.Ma="timingevent";function ms(i,a){lt.call(this,Yt.Ma,i),this.size=a}C(ms,lt);function xe(i,a){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},a)}function De(){this.g=!0}De.prototype.xa=function(){this.g=!1};function dc(i,a,c,d,I,b){i.info(function(){if(i.g)if(b)for(var R="",j=b.split("&"),st=0;st<j.length;st++){var B=j[st].split("=");if(1<B.length){var dt=B[0];B=B[1];var ft=dt.split("_");R=2<=ft.length&&ft[1]=="type"?R+(dt+"="+B+"&"):R+(dt+"=redacted&")}}else R=null;else R=b;return"XMLHTTP REQ ("+d+") [attempt "+I+"]: "+a+`
`+c+`
`+R})}function fc(i,a,c,d,I,b,R){i.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+I+"]: "+a+`
`+c+`
`+b+" "+R})}function oe(i,a,c,d){i.info(function(){return"XMLHTTP TEXT ("+a+"): "+gc(i,c)+(d?" "+d:"")})}function mc(i,a){i.info(function(){return"TIMEOUT: "+a})}De.prototype.info=function(){};function gc(i,a){if(!i.g)return a;if(!a)return null;try{var c=JSON.parse(a);if(c){for(i=0;i<c.length;i++)if(Array.isArray(c[i])){var d=c[i];if(!(2>d.length)){var I=d[1];if(Array.isArray(I)&&!(1>I.length)){var b=I[0];if(b!="noop"&&b!="stop"&&b!="close")for(var R=1;R<I.length;R++)I[R]=""}}}}return fr(c)}catch{return a}}var an={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},gs={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},yr;function un(){}C(un,mr),un.prototype.g=function(){return new XMLHttpRequest},un.prototype.i=function(){return{}},yr=new un;function zt(i,a,c,d){this.j=i,this.i=a,this.l=c,this.R=d||1,this.U=new Pe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ps}function ps(){this.i=null,this.g="",this.h=!1}var ys={},_r={};function wr(i,a,c){i.L=1,i.v=dn(Ft(a)),i.m=c,i.P=!0,_s(i,null)}function _s(i,a){i.F=Date.now(),cn(i),i.A=Ft(i.v);var c=i.A,d=i.R;Array.isArray(d)||(d=[String(d)]),Ds(c.i,"t",d),i.C=0,c=i.j.J,i.h=new ps,i.g=Js(i.j,c?a:null,!i.m),0<i.O&&(i.M=new cc(T(i.Y,i,i.g),i.O)),a=i.U,c=i.g,d=i.ca;var I="readystatechange";Array.isArray(I)||(I&&(as[0]=I.toString()),I=as);for(var b=0;b<I.length;b++){var R=ts(c,I[b],d||a.handleEvent,!1,a.h||a);if(!R)break;a.g[R.key]=R}a=i.H?m(i.H):{},i.m?(i.u||(i.u="POST"),a["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.A,i.u,i.m,a)):(i.u="GET",i.g.ea(i.A,i.u,null,a)),Ve(),dc(i.i,i.u,i.A,i.l,i.R,i.m)}zt.prototype.ca=function(i){i=i.target;let a=this.M;a&&Mt(i)==3?a.j():this.Y(i)},zt.prototype.Y=function(i){try{if(i==this.g)t:{let ft=Mt(this.g);var a=this.g.Ba();let ce=this.g.Z();if(!(3>ft)&&(ft!=3||this.g&&(this.h.h||this.g.oa()||qs(this.g)))){this.J||ft!=4||a==7||(a==8||0>=ce?Ve(3):Ve(2)),vr(this);var c=this.g.Z();this.X=c;e:if(ws(this)){var d=qs(this.g);i="";var I=d.length,b=Mt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Zt(this),Ne(this);var R="";break e}this.h.i=new l.TextDecoder}for(a=0;a<I;a++)this.h.h=!0,i+=this.h.i.decode(d[a],{stream:!(b&&a==I-1)});d.length=0,this.h.g+=i,this.C=0,R=this.h.g}else R=this.g.oa();if(this.o=c==200,fc(this.i,this.u,this.A,this.l,this.R,ft,c),this.o){if(this.T&&!this.K){e:{if(this.g){var j,st=this.g;if((j=st.g?st.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(j)){var B=j;break e}}B=null}if(c=B)oe(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ir(this,c);else{this.o=!1,this.s=3,pt(12),Zt(this),Ne(this);break t}}if(this.P){c=!0;let Tt;for(;!this.J&&this.C<R.length;)if(Tt=pc(this,R),Tt==_r){ft==4&&(this.s=4,pt(14),c=!1),oe(this.i,this.l,null,"[Incomplete Response]");break}else if(Tt==ys){this.s=4,pt(15),oe(this.i,this.l,R,"[Invalid Chunk]"),c=!1;break}else oe(this.i,this.l,Tt,null),Ir(this,Tt);if(ws(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ft!=4||R.length!=0||this.h.h||(this.s=1,pt(16),c=!1),this.o=this.o&&c,!c)oe(this.i,this.l,R,"[Invalid Chunked Response]"),Zt(this),Ne(this);else if(0<R.length&&!this.W){this.W=!0;var dt=this.j;dt.g==this&&dt.ba&&!dt.M&&(dt.j.info("Great, no buffering proxy detected. Bytes received: "+R.length),Rr(dt),dt.M=!0,pt(11))}}else oe(this.i,this.l,R,null),Ir(this,R);ft==4&&Zt(this),this.o&&!this.J&&(ft==4?Ks(this.j,this):(this.o=!1,cn(this)))}else Nc(this.g),c==400&&0<R.indexOf("Unknown SID")?(this.s=3,pt(12)):(this.s=0,pt(13)),Zt(this),Ne(this)}}}catch{}finally{}};function ws(i){return i.g?i.u=="GET"&&i.L!=2&&i.j.Ca:!1}function pc(i,a){var c=i.C,d=a.indexOf(`
`,c);return d==-1?_r:(c=Number(a.substring(c,d)),isNaN(c)?ys:(d+=1,d+c>a.length?_r:(a=a.slice(d,d+c),i.C=d+c,a)))}zt.prototype.cancel=function(){this.J=!0,Zt(this)};function cn(i){i.S=Date.now()+i.I,vs(i,i.I)}function vs(i,a){if(i.B!=null)throw Error("WatchDog timer not null");i.B=xe(T(i.ba,i),a)}function vr(i){i.B&&(l.clearTimeout(i.B),i.B=null)}zt.prototype.ba=function(){this.B=null;let i=Date.now();0<=i-this.S?(mc(this.i,this.A),this.L!=2&&(Ve(),pt(17)),Zt(this),this.s=2,Ne(this)):vs(this,this.S-i)};function Ne(i){i.j.G==0||i.J||Ks(i.j,i)}function Zt(i){vr(i);var a=i.M;a&&typeof a.ma=="function"&&a.ma(),i.M=null,us(i.U),i.g&&(a=i.g,i.g=null,a.abort(),a.ma())}function Ir(i,a){try{var c=i.j;if(c.G!=0&&(c.g==i||Er(c.h,i))){if(!i.K&&Er(c.h,i)&&c.G==3){try{var d=c.Da.g.parse(a)}catch{d=null}if(Array.isArray(d)&&d.length==3){var I=d;if(I[0]==0){t:if(!c.u){if(c.g)if(c.g.F+3e3<i.F)yn(c),gn(c);else break t;Sr(c),pt(18)}}else c.za=I[1],0<c.za-c.T&&37500>I[2]&&c.F&&c.v==0&&!c.C&&(c.C=xe(T(c.Za,c),6e3));if(1>=Ts(c.h)&&c.ca){try{c.ca()}catch{}c.ca=void 0}}else ee(c,11)}else if((i.K||c.g==i)&&yn(c),!F(a))for(I=c.Da.g.parse(a),a=0;a<I.length;a++){let B=I[a];if(c.T=B[0],B=B[1],c.G==2)if(B[0]=="c"){c.K=B[1],c.ia=B[2];let dt=B[3];dt!=null&&(c.la=dt,c.j.info("VER="+c.la));let ft=B[4];ft!=null&&(c.Aa=ft,c.j.info("SVER="+c.Aa));let ce=B[5];ce!=null&&typeof ce=="number"&&0<ce&&(d=1.5*ce,c.L=d,c.j.info("backChannelRequestTimeoutMs_="+d)),d=c;let Tt=i.g;if(Tt){let wn=Tt.g?Tt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wn){var b=d.h;b.g||wn.indexOf("spdy")==-1&&wn.indexOf("quic")==-1&&wn.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(Tr(b,b.h),b.h=null))}if(d.D){let Pr=Tt.g?Tt.g.getResponseHeader("X-HTTP-Session-Id"):null;Pr&&(d.ya=Pr,Q(d.I,d.D,Pr))}}c.G=3,c.l&&c.l.ua(),c.ba&&(c.R=Date.now()-i.F,c.j.info("Handshake RTT: "+c.R+"ms")),d=c;var R=i;if(d.qa=Hs(d,d.J?d.ia:null,d.W),R.K){As(d.h,R);var j=R,st=d.L;st&&(j.I=st),j.B&&(vr(j),cn(j)),d.g=R}else $s(d);0<c.i.length&&pn(c)}else B[0]!="stop"&&B[0]!="close"||ee(c,7);else c.G==3&&(B[0]=="stop"||B[0]=="close"?B[0]=="stop"?ee(c,7):br(c):B[0]!="noop"&&c.l&&c.l.ta(B),c.v=0)}}Ve(4)}catch{}}var yc=class{constructor(i,a){this.g=i,this.map=a}};function Is(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=0<i.length&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Es(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Ts(i){return i.h?1:i.g?i.g.size:0}function Er(i,a){return i.h?i.h==a:i.g?i.g.has(a):!1}function Tr(i,a){i.g?i.g.add(a):i.h=a}function As(i,a){i.h&&i.h==a?i.h=null:i.g&&i.g.has(a)&&i.g.delete(a)}Is.prototype.cancel=function(){if(this.i=bs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let i of this.g.values())i.cancel();this.g.clear()}};function bs(i){if(i.h!=null)return i.i.concat(i.h.D);if(i.g!=null&&i.g.size!==0){let a=i.i;for(let c of i.g.values())a=a.concat(c.D);return a}return V(i.i)}function _c(i){if(i.V&&typeof i.V=="function")return i.V();if(typeof Map<"u"&&i instanceof Map||typeof Set<"u"&&i instanceof Set)return Array.from(i.values());if(typeof i=="string")return i.split("");if(h(i)){for(var a=[],c=i.length,d=0;d<c;d++)a.push(i[d]);return a}a=[],c=0;for(d in i)a[c++]=i[d];return a}function wc(i){if(i.na&&typeof i.na=="function")return i.na();if(!i.V||typeof i.V!="function"){if(typeof Map<"u"&&i instanceof Map)return Array.from(i.keys());if(!(typeof Set<"u"&&i instanceof Set)){if(h(i)||typeof i=="string"){var a=[];i=i.length;for(var c=0;c<i;c++)a.push(c);return a}a=[],c=0;for(let d in i)a[c++]=d;return a}}}function Ss(i,a){if(i.forEach&&typeof i.forEach=="function")i.forEach(a,void 0);else if(h(i)||typeof i=="string")Array.prototype.forEach.call(i,a,void 0);else for(var c=wc(i),d=_c(i),I=d.length,b=0;b<I;b++)a.call(void 0,d[b],c&&c[b],i)}var Rs=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vc(i,a){if(i){i=i.split("&");for(var c=0;c<i.length;c++){var d=i[c].indexOf("="),I=null;if(0<=d){var b=i[c].substring(0,d);I=i[c].substring(d+1)}else b=i[c];a(b,I?decodeURIComponent(I.replace(/\+/g," ")):"")}}}function te(i){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,i instanceof te){this.h=i.h,ln(this,i.j),this.o=i.o,this.g=i.g,hn(this,i.s),this.l=i.l;var a=i.i,c=new Fe;c.i=a.i,a.g&&(c.g=new Map(a.g),c.h=a.h),Ps(this,c),this.m=i.m}else i&&(a=String(i).match(Rs))?(this.h=!1,ln(this,a[1]||"",!0),this.o=ke(a[2]||""),this.g=ke(a[3]||"",!0),hn(this,a[4]),this.l=ke(a[5]||"",!0),Ps(this,a[6]||"",!0),this.m=ke(a[7]||"")):(this.h=!1,this.i=new Fe(null,this.h))}te.prototype.toString=function(){var i=[],a=this.j;a&&i.push(Oe(a,Cs,!0),":");var c=this.g;return(c||a=="file")&&(i.push("//"),(a=this.o)&&i.push(Oe(a,Cs,!0),"@"),i.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.s,c!=null&&i.push(":",String(c))),(c=this.l)&&(this.g&&c.charAt(0)!="/"&&i.push("/"),i.push(Oe(c,c.charAt(0)=="/"?Tc:Ec,!0))),(c=this.i.toString())&&i.push("?",c),(c=this.m)&&i.push("#",Oe(c,bc)),i.join("")};function Ft(i){return new te(i)}function ln(i,a,c){i.j=c?ke(a,!0):a,i.j&&(i.j=i.j.replace(/:$/,""))}function hn(i,a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);i.s=a}else i.s=null}function Ps(i,a,c){a instanceof Fe?(i.i=a,Sc(i.i,i.h)):(c||(a=Oe(a,Ac)),i.i=new Fe(a,i.h))}function Q(i,a,c){i.i.set(a,c)}function dn(i){return Q(i,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),i}function ke(i,a){return i?a?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Oe(i,a,c){return typeof i=="string"?(i=encodeURI(i).replace(a,Ic),c&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Ic(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Cs=/[#\/\?@]/g,Ec=/[#\?:]/g,Tc=/[#\?]/g,Ac=/[#\?@]/g,bc=/#/g;function Fe(i,a){this.h=this.g=null,this.i=i||null,this.j=!!a}function $t(i){i.g||(i.g=new Map,i.h=0,i.i&&vc(i.i,function(a,c){i.add(decodeURIComponent(a.replace(/\+/g," ")),c)}))}n=Fe.prototype,n.add=function(i,a){$t(this),this.i=null,i=ae(this,i);var c=this.g.get(i);return c||this.g.set(i,c=[]),c.push(a),this.h+=1,this};function Vs(i,a){$t(i),a=ae(i,a),i.g.has(a)&&(i.i=null,i.h-=i.g.get(a).length,i.g.delete(a))}function xs(i,a){return $t(i),a=ae(i,a),i.g.has(a)}n.forEach=function(i,a){$t(this),this.g.forEach(function(c,d){c.forEach(function(I){i.call(a,I,d,this)},this)},this)},n.na=function(){$t(this);let i=Array.from(this.g.values()),a=Array.from(this.g.keys()),c=[];for(let d=0;d<a.length;d++){let I=i[d];for(let b=0;b<I.length;b++)c.push(a[d])}return c},n.V=function(i){$t(this);let a=[];if(typeof i=="string")xs(this,i)&&(a=a.concat(this.g.get(ae(this,i))));else{i=Array.from(this.g.values());for(let c=0;c<i.length;c++)a=a.concat(i[c])}return a},n.set=function(i,a){return $t(this),this.i=null,i=ae(this,i),xs(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[a]),this.h+=1,this},n.get=function(i,a){return i?(i=this.V(i),0<i.length?String(i[0]):a):a};function Ds(i,a,c){Vs(i,a),0<c.length&&(i.i=null,i.g.set(ae(i,a),V(c)),i.h+=c.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let i=[],a=Array.from(this.g.keys());for(var c=0;c<a.length;c++){var d=a[c];let b=encodeURIComponent(String(d)),R=this.V(d);for(d=0;d<R.length;d++){var I=b;R[d]!==""&&(I+="="+encodeURIComponent(String(R[d]))),i.push(I)}}return this.i=i.join("&")};function ae(i,a){return a=String(a),i.j&&(a=a.toLowerCase()),a}function Sc(i,a){a&&!i.j&&($t(i),i.i=null,i.g.forEach(function(c,d){var I=d.toLowerCase();d!=I&&(Vs(this,d),Ds(this,I,c))},i)),i.j=a}function Rc(i,a){let c=new De;if(l.Image){let d=new Image;d.onload=S(Gt,c,"TestLoadImage: loaded",!0,a,d),d.onerror=S(Gt,c,"TestLoadImage: error",!1,a,d),d.onabort=S(Gt,c,"TestLoadImage: abort",!1,a,d),d.ontimeout=S(Gt,c,"TestLoadImage: timeout",!1,a,d),l.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=i}else a(!1)}function Pc(i,a){let c=new De,d=new AbortController,I=setTimeout(()=>{d.abort(),Gt(c,"TestPingServer: timeout",!1,a)},1e4);fetch(i,{signal:d.signal}).then(b=>{clearTimeout(I),b.ok?Gt(c,"TestPingServer: ok",!0,a):Gt(c,"TestPingServer: server error",!1,a)}).catch(()=>{clearTimeout(I),Gt(c,"TestPingServer: error",!1,a)})}function Gt(i,a,c,d,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),d(c)}catch{}}function Cc(){this.g=new hc}function Vc(i,a,c){let d=c||"";try{Ss(i,function(I,b){let R=I;f(I)&&(R=fr(I)),a.push(d+b+"="+encodeURIComponent(R))})}catch(I){throw a.push(d+"type="+encodeURIComponent("_badmap")),I}}function Me(i){this.l=i.Ub||null,this.j=i.eb||!1}C(Me,mr),Me.prototype.g=function(){return new fn(this.l,this.j)},Me.prototype.i=(function(i){return function(){return i}})({});function fn(i,a){ht.call(this),this.D=i,this.o=a,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(fn,ht),n=fn.prototype,n.open=function(i,a){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=i,this.A=a,this.readyState=1,qe(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let a={headers:this.u,method:this.B,credentials:this.m,cache:void 0};i&&(a.body=i),(this.D||l).fetch(new Request(this.A,a)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Le(this)),this.readyState=0},n.Sa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,qe(this)),this.g&&(this.readyState=3,qe(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ns(this)}else i.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ns(i){i.j.read().then(i.Pa.bind(i)).catch(i.ga.bind(i))}n.Pa=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var a=i.value?i.value:new Uint8Array(0);(a=this.v.decode(a,{stream:!i.done}))&&(this.response=this.responseText+=a)}i.done?Le(this):qe(this),this.readyState==3&&Ns(this)}},n.Ra=function(i){this.g&&(this.response=this.responseText=i,Le(this))},n.Qa=function(i){this.g&&(this.response=i,Le(this))},n.ga=function(){this.g&&Le(this)};function Le(i){i.readyState=4,i.l=null,i.j=null,i.v=null,qe(i)}n.setRequestHeader=function(i,a){this.u.append(i,a)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let i=[],a=this.h.entries();for(var c=a.next();!c.done;)c=c.value,i.push(c[0]+": "+c[1]),c=a.next();return i.join(`\r
`)};function qe(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(fn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ks(i){let a="";return K(i,function(c,d){a+=d,a+=":",a+=c,a+=`\r
`}),a}function Ar(i,a,c){t:{for(d in c){var d=!1;break t}d=!0}d||(c=ks(c),typeof i=="string"?c!=null&&encodeURIComponent(String(c)):Q(i,a,c))}function Z(i){ht.call(this),this.headers=new Map,this.o=i||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(Z,ht);var xc=/^https?$/i,Dc=["POST","PUT"];n=Z.prototype,n.Ha=function(i){this.J=i},n.ea=function(i,a,c,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);a=a?a.toUpperCase():"GET",this.D=i,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():yr.g(),this.v=this.o?cs(this.o):cs(yr),this.g.onreadystatechange=T(this.Ea,this);try{this.B=!0,this.g.open(a,String(i),!0),this.B=!1}catch(b){Os(this,b);return}if(i=c||"",c=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var I in d)c.set(I,d[I]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let b of d.keys())c.set(b,d.get(b));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(c.keys()).find(b=>b.toLowerCase()=="content-type"),I=l.FormData&&i instanceof l.FormData,!(0<=Array.prototype.indexOf.call(Dc,a,void 0))||d||I||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,R]of c)this.g.setRequestHeader(b,R);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ls(this),this.u=!0,this.g.send(i),this.u=!1}catch(b){Os(this,b)}};function Os(i,a){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=a,i.m=5,Fs(i),mn(i)}function Fs(i){i.A||(i.A=!0,gt(i,"complete"),gt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=i||7,gt(this,"complete"),gt(this,"abort"),mn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),mn(this,!0)),Z.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ms(this):this.bb())},n.bb=function(){Ms(this)};function Ms(i){if(i.h&&typeof u<"u"&&(!i.v[1]||Mt(i)!=4||i.Z()!=2)){if(i.u&&Mt(i)==4)ss(i.Ea,0,i);else if(gt(i,"readystatechange"),Mt(i)==4){i.h=!1;try{let R=i.Z();t:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break t;default:a=!1}var c;if(!(c=a)){var d;if(d=R===0){var I=String(i.D).match(Rs)[1]||null;!I&&l.self&&l.self.location&&(I=l.self.location.protocol.slice(0,-1)),d=!xc.test(I?I.toLowerCase():"")}c=d}if(c)gt(i,"complete"),gt(i,"success");else{i.m=6;try{var b=2<Mt(i)?i.g.statusText:""}catch{b=""}i.l=b+" ["+i.Z()+"]",Fs(i)}}finally{mn(i)}}}}function mn(i,a){if(i.g){Ls(i);let c=i.g,d=i.v[0]?()=>{}:null;i.g=null,i.v=null,a||gt(i,"ready");try{c.onreadystatechange=d}catch{}}}function Ls(i){i.I&&(l.clearTimeout(i.I),i.I=null)}n.isActive=function(){return!!this.g};function Mt(i){return i.g?i.g.readyState:0}n.Z=function(){try{return 2<Mt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(i){if(this.g){var a=this.g.responseText;return i&&a.indexOf(i)==0&&(a=a.substring(i.length)),lc(a)}};function qs(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.H){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Nc(i){let a={};i=(i.g&&2<=Mt(i)&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<i.length;d++){if(F(i[d]))continue;var c=w(i[d]);let I=c[0];if(c=c[1],typeof c!="string")continue;c=c.trim();let b=a[I]||[];a[I]=b,b.push(c)}v(a,function(d){return d.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Be(i,a,c){return c&&c.internalChannelParams&&c.internalChannelParams[i]||a}function Bs(i){this.Aa=0,this.i=[],this.j=new De,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Be("failFast",!1,i),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Be("baseRetryDelayMs",5e3,i),this.cb=Be("retryDelaySeedMs",1e4,i),this.Wa=Be("forwardChannelMaxRetries",2,i),this.wa=Be("forwardChannelRequestTimeoutMs",2e4,i),this.pa=i&&i.xmlHttpFactory||void 0,this.Xa=i&&i.Tb||void 0,this.Ca=i&&i.useFetchStreams||!1,this.L=void 0,this.J=i&&i.supportsCrossDomainXhr||!1,this.K="",this.h=new Is(i&&i.concurrentRequestLimit),this.Da=new Cc,this.P=i&&i.fastHandshake||!1,this.O=i&&i.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=i&&i.Rb||!1,i&&i.xa&&this.j.xa(),i&&i.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&i&&i.detectBufferingProxy||!1,this.ja=void 0,i&&i.longPollingTimeout&&0<i.longPollingTimeout&&(this.ja=i.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Bs.prototype,n.la=8,n.G=1,n.connect=function(i,a,c,d){pt(0),this.W=i,this.H=a||{},c&&d!==void 0&&(this.H.OSID=c,this.H.OAID=d),this.F=this.X,this.I=Hs(this,null,this.W),pn(this)};function br(i){if(Us(i),i.G==3){var a=i.U++,c=Ft(i.I);if(Q(c,"SID",i.K),Q(c,"RID",a),Q(c,"TYPE","terminate"),Ue(i,c),a=new zt(i,i.j,a),a.L=2,a.v=dn(Ft(c)),c=!1,l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(a.v.toString(),"")}catch{}!c&&l.Image&&(new Image().src=a.v,c=!0),c||(a.g=Js(a.j,null),a.g.ea(a.v)),a.F=Date.now(),cn(a)}Ws(i)}function gn(i){i.g&&(Rr(i),i.g.cancel(),i.g=null)}function Us(i){gn(i),i.u&&(l.clearTimeout(i.u),i.u=null),yn(i),i.h.cancel(),i.s&&(typeof i.s=="number"&&l.clearTimeout(i.s),i.s=null)}function pn(i){if(!Es(i.h)&&!i.s){i.s=!0;var a=i.Ga;Ae||Zi(),be||(Ae(),be=!0),ir.add(a,i),i.B=0}}function kc(i,a){return Ts(i.h)>=i.h.j-(i.s?1:0)?!1:i.s?(i.i=a.D.concat(i.i),!0):i.G==1||i.G==2||i.B>=(i.Va?0:i.Wa)?!1:(i.s=xe(T(i.Ga,i,a),Qs(i,i.B)),i.B++,!0)}n.Ga=function(i){if(this.s)if(this.s=null,this.G==1){if(!i){this.U=Math.floor(1e5*Math.random()),i=this.U++;let I=new zt(this,this.j,i),b=this.o;if(this.S&&(b?(b=m(b),_(b,this.S)):b=this.S),this.m!==null||this.O||(I.H=b,b=null),this.P)t:{for(var a=0,c=0;c<this.i.length;c++){e:{var d=this.i[c];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break e}d=void 0}if(d===void 0)break;if(a+=d,4096<a){a=c;break t}if(a===4096||c===this.i.length-1){a=c+1;break t}}a=1e3}else a=1e3;a=zs(this,I,a),c=Ft(this.I),Q(c,"RID",i),Q(c,"CVER",22),this.D&&Q(c,"X-HTTP-Session-Id",this.D),Ue(this,c),b&&(this.O?a="headers="+encodeURIComponent(String(ks(b)))+"&"+a:this.m&&Ar(c,this.m,b)),Tr(this.h,I),this.Ua&&Q(c,"TYPE","init"),this.P?(Q(c,"$req",a),Q(c,"SID","null"),I.T=!0,wr(I,c,null)):wr(I,c,a),this.G=2}}else this.G==3&&(i?js(this,i):this.i.length==0||Es(this.h)||js(this))};function js(i,a){var c;a?c=a.l:c=i.U++;let d=Ft(i.I);Q(d,"SID",i.K),Q(d,"RID",c),Q(d,"AID",i.T),Ue(i,d),i.m&&i.o&&Ar(d,i.m,i.o),c=new zt(i,i.j,c,i.B+1),i.m===null&&(c.H=i.o),a&&(i.i=a.D.concat(i.i)),a=zs(i,c,1e3),c.I=Math.round(.5*i.wa)+Math.round(.5*i.wa*Math.random()),Tr(i.h,c),wr(c,d,a)}function Ue(i,a){i.H&&K(i.H,function(c,d){Q(a,d,c)}),i.l&&Ss({},function(c,d){Q(a,d,c)})}function zs(i,a,c){c=Math.min(i.i.length,c);var d=i.l?T(i.l.Na,i.l,i):null;t:{var I=i.i;let b=-1;for(;;){let R=["count="+c];b==-1?0<c?(b=I[0].g,R.push("ofs="+b)):b=0:R.push("ofs="+b);let j=!0;for(let st=0;st<c;st++){let B=I[st].g,dt=I[st].map;if(B-=b,0>B)b=Math.max(0,I[st].g-100),j=!1;else try{Vc(dt,R,"req"+B+"_")}catch{d&&d(dt)}}if(j){d=R.join("&");break t}}}return i=i.i.splice(0,c),a.D=i,d}function $s(i){if(!i.g&&!i.u){i.Y=1;var a=i.Fa;Ae||Zi(),be||(Ae(),be=!0),ir.add(a,i),i.v=0}}function Sr(i){return i.g||i.u||3<=i.v?!1:(i.Y++,i.u=xe(T(i.Fa,i),Qs(i,i.v)),i.v++,!0)}n.Fa=function(){if(this.u=null,Gs(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var i=2*this.R;this.j.info("BP detection timer enabled: "+i),this.A=xe(T(this.ab,this),i)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,pt(10),gn(this),Gs(this))};function Rr(i){i.A!=null&&(l.clearTimeout(i.A),i.A=null)}function Gs(i){i.g=new zt(i,i.j,"rpc",i.Y),i.m===null&&(i.g.H=i.o),i.g.O=0;var a=Ft(i.qa);Q(a,"RID","rpc"),Q(a,"SID",i.K),Q(a,"AID",i.T),Q(a,"CI",i.F?"0":"1"),!i.F&&i.ja&&Q(a,"TO",i.ja),Q(a,"TYPE","xmlhttp"),Ue(i,a),i.m&&i.o&&Ar(a,i.m,i.o),i.L&&(i.g.I=i.L);var c=i.g;i=i.ia,c.L=1,c.v=dn(Ft(a)),c.m=null,c.P=!0,_s(c,i)}n.Za=function(){this.C!=null&&(this.C=null,gn(this),Sr(this),pt(19))};function yn(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function Ks(i,a){var c=null;if(i.g==a){yn(i),Rr(i),i.g=null;var d=2}else if(Er(i.h,a))c=a.D,As(i.h,a),d=1;else return;if(i.G!=0){if(a.o)if(d==1){c=a.m?a.m.length:0,a=Date.now()-a.F;var I=i.B;d=on(),gt(d,new ms(d,c)),pn(i)}else $s(i);else if(I=a.s,I==3||I==0&&0<a.X||!(d==1&&kc(i,a)||d==2&&Sr(i)))switch(c&&0<c.length&&(a=i.h,a.i=a.i.concat(c)),I){case 1:ee(i,5);break;case 4:ee(i,10);break;case 3:ee(i,6);break;default:ee(i,2)}}}function Qs(i,a){let c=i.Ta+Math.floor(Math.random()*i.cb);return i.isActive()||(c*=2),c*a}function ee(i,a){if(i.j.info("Error code "+a),a==2){var c=T(i.fb,i),d=i.Xa;let I=!d;d=new te(d||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||ln(d,"https"),dn(d),I?Rc(d.toString(),c):Pc(d.toString(),c)}else pt(2);i.G=0,i.l&&i.l.sa(a),Ws(i),Us(i)}n.fb=function(i){i?(this.j.info("Successfully pinged google.com"),pt(2)):(this.j.info("Failed to ping google.com"),pt(1))};function Ws(i){if(i.G=0,i.ka=[],i.l){let a=bs(i.h);(a.length!=0||i.i.length!=0)&&(P(i.ka,a),P(i.ka,i.i),i.h.i.length=0,V(i.i),i.i.length=0),i.l.ra()}}function Hs(i,a,c){var d=c instanceof te?Ft(c):new te(c);if(d.g!="")a&&(d.g=a+"."+d.g),hn(d,d.s);else{var I=l.location;d=I.protocol,a=a?a+"."+I.hostname:I.hostname,I=+I.port;var b=new te(null);d&&ln(b,d),a&&(b.g=a),I&&hn(b,I),c&&(b.l=c),d=b}return c=i.D,a=i.ya,c&&a&&Q(d,c,a),Q(d,"VER",i.la),Ue(i,d),d}function Js(i,a,c){if(a&&!i.J)throw Error("Can't create secondary domain capable XhrIo object.");return a=i.Ca&&!i.pa?new Z(new Me({eb:c})):new Z(i.pa),a.Ha(i.J),a}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Xs(){}n=Xs.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function _n(){}_n.prototype.g=function(i,a){return new _t(i,a)};function _t(i,a){ht.call(this),this.g=new Bs(a),this.l=i,this.h=a&&a.messageUrlParams||null,i=a&&a.messageHeaders||null,a&&a.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=a&&a.initMessageHeaders||null,a&&a.messageContentType&&(i?i["X-WebChannel-Content-Type"]=a.messageContentType:i={"X-WebChannel-Content-Type":a.messageContentType}),a&&a.va&&(i?i["X-WebChannel-Client-Profile"]=a.va:i={"X-WebChannel-Client-Profile":a.va}),this.g.S=i,(i=a&&a.Sb)&&!F(i)&&(this.g.m=i),this.v=a&&a.supportsCrossDomainXhr||!1,this.u=a&&a.sendRawJson||!1,(a=a&&a.httpSessionIdParam)&&!F(a)&&(this.g.D=a,i=this.h,i!==null&&a in i&&(i=this.h,a in i&&delete i[a])),this.j=new ue(this)}C(_t,ht),_t.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},_t.prototype.close=function(){br(this.g)},_t.prototype.o=function(i){var a=this.g;if(typeof i=="string"){var c={};c.__data__=i,i=c}else this.u&&(c={},c.__data__=fr(i),i=c);a.i.push(new yc(a.Ya++,i)),a.G==3&&pn(a)},_t.prototype.N=function(){this.g.l=null,delete this.j,br(this.g),delete this.g,_t.aa.N.call(this)};function Ys(i){gr.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var a=i.__sm__;if(a){t:{for(let c in a){i=c;break t}i=void 0}(this.i=i)&&(i=this.i,a=a!==null&&i in a?a[i]:void 0),this.data=a}else this.data=i}C(Ys,gr);function Zs(){pr.call(this),this.status=1}C(Zs,pr);function ue(i){this.g=i}C(ue,Xs),ue.prototype.ua=function(){gt(this.g,"a")},ue.prototype.ta=function(i){gt(this.g,new Ys(i))},ue.prototype.sa=function(i){gt(this.g,new Zs)},ue.prototype.ra=function(){gt(this.g,"b")},_n.prototype.createWebChannel=_n.prototype.g,_t.prototype.send=_t.prototype.o,_t.prototype.open=_t.prototype.m,_t.prototype.close=_t.prototype.close,Sd=Dn.createWebChannelTransport=function(){return new _n},bd=Dn.getStatEventTarget=function(){return on()},Ad=Dn.Event=Yt,du=Dn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},an.NO_ERROR=0,an.TIMEOUT=8,an.HTTP_ERROR=6,Mo=Dn.ErrorCode=an,gs.COMPLETE="complete",Td=Dn.EventType=gs,ls.EventType=Ce,Ce.OPEN="a",Ce.CLOSE="b",Ce.ERROR="c",Ce.MESSAGE="d",ht.prototype.listen=ht.prototype.K,Vi=Dn.WebChannel=ls,oT=Dn.FetchXmlHttpFactory=Me,Z.prototype.listenOnce=Z.prototype.L,Z.prototype.getLastError=Z.prototype.Ka,Z.prototype.getLastErrorCode=Z.prototype.Ba,Z.prototype.getStatus=Z.prototype.Z,Z.prototype.getResponseJson=Z.prototype.Oa,Z.prototype.getResponseText=Z.prototype.oa,Z.prototype.send=Z.prototype.ea,Z.prototype.setWithCredentials=Z.prototype.Ha,Ed=Dn.XhrIo=Z}).apply(typeof hu<"u"?hu:typeof self<"u"?self:typeof window<"u"?window:{});var h_="@firebase/firestore";var Ut=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};Ut.UNAUTHENTICATED=new Ut(null),Ut.GOOGLE_CREDENTIALS=new Ut("google-credentials-uid"),Ut.FIRST_PARTY=new Ut("first-party-uid"),Ut.MOCK_USER=new Ut("mock-user");var Ji="10.14.0";var Gr=new Km("@firebase/firestore");function Lo(){return Gr.logLevel}function U(n,...t){if(Gr.logLevel<=vn.DEBUG){let e=t.map(mm);Gr.debug(`Firestore (${Ji}): ${n}`,...e)}}function Nn(n,...t){if(Gr.logLevel<=vn.ERROR){let e=t.map(mm);Gr.error(`Firestore (${Ji}): ${n}`,...e)}}function Fi(n,...t){if(Gr.logLevel<=vn.WARN){let e=t.map(mm);Gr.warn(`Firestore (${Ji}): ${n}`,...e)}}function mm(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function Y(n="Unexpected state"){let t=`FIRESTORE (${Ji}) INTERNAL ASSERTION FAILED: `+n;throw Nn(t),new Error(t)}function yt(n,t){n||Y()}function tt(n,t){return n}var N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},G=class extends $m{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var He=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var yu=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},xd=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(Ut.UNAUTHENTICATED))}shutdown(){}},Dd=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Nd=class{constructor(t){this.t=t,this.currentUser=Ut.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){yt(this.o===void 0);let r=this.i,s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve(),o=new He;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new He,t.enqueueRetryable(()=>s(this.currentUser))};let u=()=>{let h=o;t.enqueueRetryable(async()=>{await h.promise,await s(this.currentUser)})},l=h=>{U("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(U("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new He)}},0),u()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(U("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(yt(typeof r.accessToken=="string"),new yu(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return yt(t===null||typeof t=="string"),new Ut(t)}},kd=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r,this.type="FirstParty",this.user=Ut.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Od=class{constructor(t,e,r){this.l=t,this.h=e,this.P=r}getToken(){return Promise.resolve(new kd(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(Ut.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Fd=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Md=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){yt(this.o===void 0);let r=o=>{o.error!=null&&U("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let u=o.token!==this.R;return this.R=o.token,U("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable(()=>r(o))};let s=o=>{U("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){let o=this.A.getImmediate({optional:!0});o?s(o):U("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(yt(typeof e.token=="string"),this.R=e.token,new Fd(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function aT(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}var _u=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let s=aT(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%t.length))}return r}};function mt(n,t){return n<t?-1:n>t?1:0}function Mi(n,t,e){return n.length===t.length&&n.every((r,s)=>e(r,t[s]))}var Kt=class n{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new G(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new G(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new G(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new G(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*e));return new n(e,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?mt(this.nanoseconds,t.nanoseconds):mt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var et=class n{constructor(t){this.timestamp=t}static fromTimestamp(t){return new n(t)}static min(){return new n(new Kt(0,0))}static max(){return new n(new Kt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var wu=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&Y(),r===void 0?r=t.length-e:r>t.length-e&&Y(),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let s=0;s<r;s++){let o=t.get(s),u=e.get(s);if(o<u)return-1;if(o>u)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},kt=class n extends wu{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new G(N.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(s=>s.length>0))}return new n(e)}static emptyPath(){return new n([])}},uT=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ge=class n extends wu{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return uT.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(t){let e=[],r="",s=0,o=()=>{if(r.length===0)throw new G(N.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},u=!1;for(;s<t.length;){let l=t[s];if(l==="\\"){if(s+1===t.length)throw new G(N.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new G(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else l==="`"?(u=!u,s++):l!=="."||u?(r+=l,s++):(o(),s++)}if(o(),u)throw new G(N.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var W=class n{constructor(t){this.path=t}static fromPath(t){return new n(kt.fromString(t))}static fromName(t){return new n(kt.fromString(t).popFirst(5))}static empty(){return new n(kt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&kt.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return kt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new kt(t.slice()))}};var Ld=class{constructor(t,e,r,s){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=s}};Ld.UNKNOWN_ID=-1;function cT(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=et.fromTimestamp(r===1e9?new Kt(e+1,0):new Kt(e,r));return new Kr(s,W.empty(),t)}function lT(n){return new Kr(n.readTime,n.key,-1)}var Kr=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(et.min(),W.empty(),-1)}static max(){return new n(et.max(),W.empty(),-1)}};function hT(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=W.comparator(n.documentKey,t.documentKey),e!==0?e:mt(n.largestBatchId,t.largestBatchId))}var dT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",qd=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};async function na(n){if(n.code!==N.FAILED_PRECONDITION||n.message!==dT)throw n;U("LocalStore","Unexpectedly lost primary lease")}var k=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Y(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let s=0,o=0,u=!1;t.forEach(l=>{++s,l.next(()=>{++o,u&&o===s&&e()},h=>r(h))}),u=!0,o===s&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(s=>s?n.resolve(s):r());return e}static forEach(t,e){let r=[];return t.forEach((s,o)=>{r.push(e.call(this,s,o))}),this.waitFor(r)}static mapArray(t,e){return new n((r,s)=>{let o=t.length,u=new Array(o),l=0;for(let h=0;h<o;h++){let f=h;e(t[f]).next(g=>{u[f]=g,++l,l===o&&r(u)},g=>s(g))}})}static doWhile(t,e){return new n((r,s)=>{let o=()=>{t()===!0?e().next(()=>{o()},s):r()};o()})}};function fT(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function ra(n){return n.name==="IndexedDbTransactionError"}var U_=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ie(s),this.se=s=>r.writeSequenceNumber(s))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return n.oe=-1,n})();function Qu(n){return n==null}function $o(n){return n===0&&1/n==-1/0}function mT(n){return typeof n=="number"&&Number.isInteger(n)&&!$o(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var gT=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Rb=[...gT,"documentOverlays"],pT=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],yT=pT,_T=[...yT,"indexConfiguration","indexState","indexEntries"];var Pb=[..._T,"globals"];function d_(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Zr(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function j_(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var bt=class n{constructor(t,e){this.comparator=t,this.root=e||Je.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Je.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Je.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ki(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ki(this.root,t,this.comparator,!1)}getReverseIterator(){return new ki(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ki(this.root,t,this.comparator,!0)}},ki=class{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Je=class n{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new n(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this,o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Y();let t=this.left.check();if(t!==this.right.check())throw Y();return t+(this.isRed()?0:1)}};Je.EMPTY=null,Je.RED=!0,Je.BLACK=!1;Je.EMPTY=new class{constructor(){this.size=0}get key(){throw Y()}get value(){throw Y()}get color(){throw Y()}get left(){throw Y()}get right(){throw Y()}copy(t,e,r,s,o){return this}insert(t,e,r){return new Je(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Jt=class n{constructor(t){this.comparator=t,this.data=new bt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new vu(this.data.getIterator())}getIteratorFrom(t){return new vu(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},vu=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Ie=class n{constructor(t){this.fields=t,t.sort(ge.comparator)}static empty(){return new n([])}unionWith(t){let e=new Jt(ge.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Mi(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var Iu=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Xt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Iu("Invalid base64 string: "+o):o}})(t);return new n(e)}static fromUint8Array(t){let e=(function(s){let o="";for(let u=0;u<s.length;++u)o+=String.fromCharCode(s[u]);return o})(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){let r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return mt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};Xt.EMPTY_BYTE_STRING=new Xt("");var wT=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function kn(n){if(yt(!!n),typeof n=="string"){let t=0,e=wT.exec(n);if(yt(!!e),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Et(n.seconds),nanos:Et(n.nanos)}}function Et(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function tr(n){return typeof n=="string"?Xt.fromBase64String(n):Xt.fromUint8Array(n)}function gm(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function pm(n){let t=n.mapValue.fields.__previous_value__;return gm(t)?pm(t):t}function Go(n){let t=kn(n.mapValue.fields.__local_write_time__.timestampValue);return new Kt(t.seconds,t.nanos)}var Bd=class{constructor(t,e,r,s,o,u,l,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=u,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f}},Eu=class n{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var fu={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Qr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?gm(n)?4:$_(n)?9007199254740991:z_(n)?10:11:Y()}function Ze(n,t){if(n===t)return!0;let e=Qr(n);if(e!==Qr(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Go(n).isEqual(Go(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;let u=kn(s.timestampValue),l=kn(o.timestampValue);return u.seconds===l.seconds&&u.nanos===l.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,o){return tr(s.bytesValue).isEqual(tr(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,o){return Et(s.geoPointValue.latitude)===Et(o.geoPointValue.latitude)&&Et(s.geoPointValue.longitude)===Et(o.geoPointValue.longitude)})(n,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return Et(s.integerValue)===Et(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){let u=Et(s.doubleValue),l=Et(o.doubleValue);return u===l?$o(u)===$o(l):isNaN(u)&&isNaN(l)}return!1})(n,t);case 9:return Mi(n.arrayValue.values||[],t.arrayValue.values||[],Ze);case 10:case 11:return(function(s,o){let u=s.mapValue.fields||{},l=o.mapValue.fields||{};if(d_(u)!==d_(l))return!1;for(let h in u)if(u.hasOwnProperty(h)&&(l[h]===void 0||!Ze(u[h],l[h])))return!1;return!0})(n,t);default:return Y()}}function Ko(n,t){return(n.values||[]).find(e=>Ze(e,t))!==void 0}function Li(n,t){if(n===t)return 0;let e=Qr(n),r=Qr(t);if(e!==r)return mt(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return mt(n.booleanValue,t.booleanValue);case 2:return(function(o,u){let l=Et(o.integerValue||o.doubleValue),h=Et(u.integerValue||u.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,t);case 3:return f_(n.timestampValue,t.timestampValue);case 4:return f_(Go(n),Go(t));case 5:return mt(n.stringValue,t.stringValue);case 6:return(function(o,u){let l=tr(o),h=tr(u);return l.compareTo(h)})(n.bytesValue,t.bytesValue);case 7:return(function(o,u){let l=o.split("/"),h=u.split("/");for(let f=0;f<l.length&&f<h.length;f++){let g=mt(l[f],h[f]);if(g!==0)return g}return mt(l.length,h.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,u){let l=mt(Et(o.latitude),Et(u.latitude));return l!==0?l:mt(Et(o.longitude),Et(u.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return m_(n.arrayValue,t.arrayValue);case 10:return(function(o,u){var l,h,f,g;let E=o.fields||{},T=u.fields||{},S=(l=E.value)===null||l===void 0?void 0:l.arrayValue,C=(h=T.value)===null||h===void 0?void 0:h.arrayValue,V=mt(((f=S?.values)===null||f===void 0?void 0:f.length)||0,((g=C?.values)===null||g===void 0?void 0:g.length)||0);return V!==0?V:m_(S,C)})(n.mapValue,t.mapValue);case 11:return(function(o,u){if(o===fu.mapValue&&u===fu.mapValue)return 0;if(o===fu.mapValue)return 1;if(u===fu.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),f=u.fields||{},g=Object.keys(f);h.sort(),g.sort();for(let E=0;E<h.length&&E<g.length;++E){let T=mt(h[E],g[E]);if(T!==0)return T;let S=Li(l[h[E]],f[g[E]]);if(S!==0)return S}return mt(h.length,g.length)})(n.mapValue,t.mapValue);default:throw Y()}}function f_(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return mt(n,t);let e=kn(n),r=kn(t),s=mt(e.seconds,r.seconds);return s!==0?s:mt(e.nanos,r.nanos)}function m_(n,t){let e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){let o=Li(e[s],r[s]);if(o)return o}return mt(e.length,r.length)}function qi(n){return Ud(n)}function Ud(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){let r=kn(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return tr(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return W.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",s=!0;for(let o of e.values||[])s?s=!1:r+=",",r+=Ud(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){let r=Object.keys(e.fields||{}).sort(),s="{",o=!0;for(let u of r)o?o=!1:s+=",",s+=`${u}:${Ud(e.fields[u])}`;return s+"}"})(n.mapValue):Y()}function jd(n){return!!n&&"integerValue"in n}function ym(n){return!!n&&"arrayValue"in n}function g_(n){return!!n&&"nullValue"in n}function p_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function gu(n){return!!n&&"mapValue"in n}function z_(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function Bo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return Zr(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=Bo(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Bo(n.arrayValue.values[e]);return t}return Object.assign({},n)}function $_(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var me=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!gu(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Bo(e)}setAll(t){let e=ge.emptyPath(),r={},s=[];t.forEach((u,l)=>{if(!e.isImmediateParentOf(l)){let h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=l.popLast()}u?r[l.lastSegment()]=Bo(u):s.push(l.lastSegment())});let o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){let e=this.field(t.popLast());gu(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ze(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];gu(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){Zr(e,(s,o)=>t[s]=o);for(let s of r)delete t[s]}clone(){return new n(Bo(this.value))}};function G_(n){let t=[];return Zr(n.fields,(e,r)=>{let s=new ge([e]);if(gu(r)){let o=G_(r.mapValue).fields;if(o.length===0)t.push(s);else for(let u of o)t.push(s.child(u))}else t.push(s)}),new Ie(t)}var ze=class n{constructor(t,e,r,s,o,u,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=u,this.documentState=l}static newInvalidDocument(t){return new n(t,0,et.min(),et.min(),et.min(),me.empty(),0)}static newFoundDocument(t,e,r,s){return new n(t,1,e,et.min(),r,s,0)}static newNoDocument(t,e){return new n(t,2,e,et.min(),et.min(),me.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,et.min(),et.min(),me.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(et.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=me.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=me.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=et.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Bi=class{constructor(t,e){this.position=t,this.inclusive=e}};function y_(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){let o=t[s],u=n.position[s];if(o.field.isKeyField()?r=W.comparator(W.fromName(u.referenceValue),e.key):r=Li(u,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function __(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ze(n.position[e],t.position[e]))return!1;return!0}var Ui=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function vT(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var Tu=class{},Lt=class n extends Tu{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new $d(t,e,r):e==="array-contains"?new Qd(t,r):e==="in"?new Wd(t,r):e==="not-in"?new Hd(t,r):e==="array-contains-any"?new Jd(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Gd(t,r):new Kd(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Li(e,this.value)):e!==null&&Qr(this.value)===Qr(e)&&this.matchesComparison(Li(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Y()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},tn=class n extends Tu{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new n(t,e)}matches(t){return K_(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function K_(n){return n.op==="and"}function Q_(n){return IT(n)&&K_(n)}function IT(n){for(let t of n.filters)if(t instanceof tn)return!1;return!0}function zd(n){if(n instanceof Lt)return n.field.canonicalString()+n.op.toString()+qi(n.value);if(Q_(n))return n.filters.map(t=>zd(t)).join(",");{let t=n.filters.map(e=>zd(e)).join(",");return`${n.op}(${t})`}}function W_(n,t){return n instanceof Lt?(function(r,s){return s instanceof Lt&&r.op===s.op&&r.field.isEqual(s.field)&&Ze(r.value,s.value)})(n,t):n instanceof tn?(function(r,s){return s instanceof tn&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,u,l)=>o&&W_(u,s.filters[l]),!0):!1})(n,t):void Y()}function H_(n){return n instanceof Lt?(function(e){return`${e.field.canonicalString()} ${e.op} ${qi(e.value)}`})(n):n instanceof tn?(function(e){return e.op.toString()+" {"+e.getFilters().map(H_).join(" ,")+"}"})(n):"Filter"}var $d=class extends Lt{constructor(t,e,r){super(t,e,r),this.key=W.fromName(r.referenceValue)}matches(t){let e=W.comparator(t.key,this.key);return this.matchesComparison(e)}},Gd=class extends Lt{constructor(t,e){super(t,"in",e),this.keys=J_("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Kd=class extends Lt{constructor(t,e){super(t,"not-in",e),this.keys=J_("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function J_(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>W.fromName(r.referenceValue))}var Qd=class extends Lt{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return ym(e)&&Ko(e.arrayValue,this.value)}},Wd=class extends Lt{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Ko(this.value.arrayValue,e)}},Hd=class extends Lt{constructor(t,e){super(t,"not-in",e)}matches(t){if(Ko(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Ko(this.value.arrayValue,e)}},Jd=class extends Lt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!ym(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>Ko(this.value.arrayValue,r))}};var Xd=class{constructor(t,e=null,r=[],s=[],o=null,u=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=u,this.endAt=l,this.ue=null}};function w_(n,t=null,e=[],r=[],s=null,o=null,u=null){return new Xd(n,t,e,r,s,o,u)}function _m(n){let t=tt(n);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>zd(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>(function(o){return o.field.canonicalString()+o.dir})(r)).join(","),Qu(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>qi(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>qi(r)).join(",")),t.ue=e}return t.ue}function wm(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!vT(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!W_(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!__(n.startAt,t.startAt)&&__(n.endAt,t.endAt)}function Yd(n){return W.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var ji=class{constructor(t,e=null,r=[],s=[],o=null,u="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=u,this.startAt=l,this.endAt=h,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function ET(n,t,e,r,s,o,u,l){return new ji(n,t,e,r,s,o,u,l)}function vm(n){return new ji(n)}function v_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function TT(n){return n.collectionGroup!==null}function Uo(n){let t=tt(n);if(t.ce===null){t.ce=[];let e=new Set;for(let o of t.explicitOrderBy)t.ce.push(o),e.add(o.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(u){let l=new Jt(ge.comparator);return u.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(t).forEach(o=>{e.has(o.canonicalString())||o.isKeyField()||t.ce.push(new Ui(o,r))}),e.has(ge.keyField().canonicalString())||t.ce.push(new Ui(ge.keyField(),r))}return t.ce}function Xe(n){let t=tt(n);return t.le||(t.le=AT(t,Uo(n))),t.le}function AT(n,t){if(n.limitType==="F")return w_(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(s=>{let o=s.dir==="desc"?"asc":"desc";return new Ui(s.field,o)});let e=n.endAt?new Bi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Bi(n.startAt.position,n.startAt.inclusive):null;return w_(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Zd(n,t,e){return new ji(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Wu(n,t){return wm(Xe(n),Xe(t))&&n.limitType===t.limitType}function X_(n){return`${_m(Xe(n))}|lt:${n.limitType}`}function xi(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(s=>H_(s)).join(", ")}]`),Qu(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(s=>(function(u){return`${u.field.canonicalString()} (${u.dir})`})(s)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>qi(s)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>qi(s)).join(",")),`Target(${r})`})(Xe(n))}; limitType=${n.limitType})`}function Hu(n,t){return t.isFoundDocument()&&(function(r,s){let o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):W.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,s){for(let o of Uo(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,s){for(let o of r.filters)if(!o.matches(s))return!1;return!0})(n,t)&&(function(r,s){return!(r.startAt&&!(function(u,l,h){let f=y_(u,l,h);return u.inclusive?f<=0:f<0})(r.startAt,Uo(r),s)||r.endAt&&!(function(u,l,h){let f=y_(u,l,h);return u.inclusive?f>=0:f>0})(r.endAt,Uo(r),s))})(n,t)}function bT(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Y_(n){return(t,e)=>{let r=!1;for(let s of Uo(n)){let o=ST(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function ST(n,t,e){let r=n.field.isKeyField()?W.comparator(t.key,e.key):(function(o,u,l){let h=u.data.field(o),f=l.data.field(o);return h!==null&&f!==null?Li(h,f):Y()})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Y()}}var er=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Zr(this.inner,(e,r)=>{for(let[s,o]of r)t(s,o)})}isEmpty(){return j_(this.inner)}size(){return this.innerSize}};var RT=new bt(W.comparator);function On(){return RT}var Z_=new bt(W.comparator);function qo(...n){let t=Z_;for(let e of n)t=t.insert(e.key,e);return t}function tw(n){let t=Z_;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function zr(){return jo()}function ew(){return jo()}function jo(){return new er(n=>n.toString(),(n,t)=>n.isEqual(t))}var PT=new bt(W.comparator),CT=new Jt(W.comparator);function it(...n){let t=CT;for(let e of n)t=t.add(e);return t}var VT=new Jt(mt);function xT(){return VT}function Im(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$o(t)?"-0":t}}function nw(n){return{integerValue:""+n}}function DT(n,t){return mT(t)?nw(t):Im(n,t)}var zi=class{constructor(){this._=void 0}};function NT(n,t,e){return n instanceof Wr?(function(s,o){let u={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&gm(o)&&(o=pm(o)),o&&(u.fields.__previous_value__=o),{mapValue:u}})(e,t):n instanceof Hr?iw(n,t):n instanceof Jr?sw(n,t):(function(s,o){let u=rw(s,o),l=I_(u)+I_(s.Pe);return jd(u)&&jd(s.Pe)?nw(l):Im(s.serializer,l)})(n,t)}function kT(n,t,e){return n instanceof Hr?iw(n,t):n instanceof Jr?sw(n,t):e}function rw(n,t){return n instanceof $i?(function(r){return jd(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}var Wr=class extends zi{},Hr=class extends zi{constructor(t){super(),this.elements=t}};function iw(n,t){let e=ow(t);for(let r of n.elements)e.some(s=>Ze(s,r))||e.push(r);return{arrayValue:{values:e}}}var Jr=class extends zi{constructor(t){super(),this.elements=t}};function sw(n,t){let e=ow(t);for(let r of n.elements)e=e.filter(s=>!Ze(s,r));return{arrayValue:{values:e}}}var $i=class extends zi{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function I_(n){return Et(n.integerValue||n.doubleValue)}function ow(n){return ym(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var tf=class{constructor(t,e){this.field=t,this.transform=e}};function OT(n,t){return n.field.isEqual(t.field)&&(function(r,s){return r instanceof Hr&&s instanceof Hr||r instanceof Jr&&s instanceof Jr?Mi(r.elements,s.elements,Ze):r instanceof $i&&s instanceof $i?Ze(r.Pe,s.Pe):r instanceof Wr&&s instanceof Wr})(n.transform,t.transform)}var ef=class{constructor(t,e){this.version=t,this.transformResults=e}},Zn=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function pu(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var Gi=class{};function aw(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Au(n.key,Zn.none()):new Xr(n.key,n.data,Zn.none());{let e=n.data,r=me.empty(),s=new Jt(ge.comparator);for(let o of t.fields)if(!s.has(o)){let u=e.field(o);u===null&&o.length>1&&(o=o.popLast(),u=e.field(o)),u===null?r.delete(o):r.set(o,u),s=s.add(o)}return new en(n.key,r,new Ie(s.toArray()),Zn.none())}}function FT(n,t,e){n instanceof Xr?(function(s,o,u){let l=s.value.clone(),h=T_(s.fieldTransforms,o,u.transformResults);l.setAll(h),o.convertToFoundDocument(u.version,l).setHasCommittedMutations()})(n,t,e):n instanceof en?(function(s,o,u){if(!pu(s.precondition,o))return void o.convertToUnknownDocument(u.version);let l=T_(s.fieldTransforms,o,u.transformResults),h=o.data;h.setAll(uw(s)),h.setAll(l),o.convertToFoundDocument(u.version,h).setHasCommittedMutations()})(n,t,e):(function(s,o,u){o.convertToNoDocument(u.version).setHasCommittedMutations()})(0,t,e)}function zo(n,t,e,r){return n instanceof Xr?(function(o,u,l,h){if(!pu(o.precondition,u))return l;let f=o.value.clone(),g=A_(o.fieldTransforms,h,u);return f.setAll(g),u.convertToFoundDocument(u.version,f).setHasLocalMutations(),null})(n,t,e,r):n instanceof en?(function(o,u,l,h){if(!pu(o.precondition,u))return l;let f=A_(o.fieldTransforms,h,u),g=u.data;return g.setAll(uw(o)),g.setAll(f),u.convertToFoundDocument(u.version,g).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(E=>E.field))})(n,t,e,r):(function(o,u,l){return pu(o.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):l})(n,t,e)}function MT(n,t){let e=null;for(let r of n.fieldTransforms){let s=t.data.field(r.field),o=rw(r.transform,s||null);o!=null&&(e===null&&(e=me.empty()),e.set(r.field,o))}return e||null}function E_(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Mi(r,s,(o,u)=>OT(o,u))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var Xr=class extends Gi{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},en=class extends Gi{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function uw(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function T_(n,t,e){let r=new Map;yt(n.length===e.length);for(let s=0;s<e.length;s++){let o=n[s],u=o.transform,l=t.data.field(o.field);r.set(o.field,kT(u,l,e[s]))}return r}function A_(n,t,e){let r=new Map;for(let s of n){let o=s.transform,u=e.data.field(s.field);r.set(s.field,NT(o,u,t))}return r}var Au=class extends Gi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},nf=class extends Gi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var rf=class{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){let o=this.mutations[s];o.key.isEqual(t.key)&&FT(o,t,r[s])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=zo(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=zo(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=ew();return this.mutations.forEach(s=>{let o=t.get(s.key),u=o.overlayedDocument,l=this.applyToLocalView(u,o.mutatedFields);l=e.has(s.key)?null:l;let h=aw(u,l);h!==null&&r.set(s.key,h),u.isValidDocument()||u.convertToNoDocument(et.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),it())}isEqual(t){return this.batchId===t.batchId&&Mi(this.mutations,t.mutations,(e,r)=>E_(e,r))&&Mi(this.baseMutations,t.baseMutations,(e,r)=>E_(e,r))}},sf=class n{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){yt(t.mutations.length===r.length);let s=(function(){return PT})(),o=t.mutations;for(let u=0;u<o.length;u++)s=s.insert(o[u].key,r[u].version);return new n(t,e,r,s)}};var of=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var af=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var Dt,ct;function LT(n){switch(n){default:return Y();case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0}}function cw(n){if(n===void 0)return Nn("GRPC error has no .code"),N.UNKNOWN;switch(n){case Dt.OK:return N.OK;case Dt.CANCELLED:return N.CANCELLED;case Dt.UNKNOWN:return N.UNKNOWN;case Dt.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case Dt.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case Dt.INTERNAL:return N.INTERNAL;case Dt.UNAVAILABLE:return N.UNAVAILABLE;case Dt.UNAUTHENTICATED:return N.UNAUTHENTICATED;case Dt.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case Dt.NOT_FOUND:return N.NOT_FOUND;case Dt.ALREADY_EXISTS:return N.ALREADY_EXISTS;case Dt.PERMISSION_DENIED:return N.PERMISSION_DENIED;case Dt.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case Dt.ABORTED:return N.ABORTED;case Dt.OUT_OF_RANGE:return N.OUT_OF_RANGE;case Dt.UNIMPLEMENTED:return N.UNIMPLEMENTED;case Dt.DATA_LOSS:return N.DATA_LOSS;default:return Y()}}(ct=Dt||(Dt={}))[ct.OK=0]="OK",ct[ct.CANCELLED=1]="CANCELLED",ct[ct.UNKNOWN=2]="UNKNOWN",ct[ct.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ct[ct.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ct[ct.NOT_FOUND=5]="NOT_FOUND",ct[ct.ALREADY_EXISTS=6]="ALREADY_EXISTS",ct[ct.PERMISSION_DENIED=7]="PERMISSION_DENIED",ct[ct.UNAUTHENTICATED=16]="UNAUTHENTICATED",ct[ct.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ct[ct.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ct[ct.ABORTED=10]="ABORTED",ct[ct.OUT_OF_RANGE=11]="OUT_OF_RANGE",ct[ct.UNIMPLEMENTED=12]="UNIMPLEMENTED",ct[ct.INTERNAL=13]="INTERNAL",ct[ct.UNAVAILABLE=14]="UNAVAILABLE",ct[ct.DATA_LOSS=15]="DATA_LOSS";var b_=null;function qT(){return new TextEncoder}var BT=new Yn([4294967295,4294967295],0);function S_(n){let t=qT().encode(n),e=new Id;return e.update(t),new Uint8Array(e.digest())}function R_(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new Yn([e,r],0),new Yn([s,o],0)]}var uf=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new $r(`Invalid padding: ${e}`);if(r<0)throw new $r(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new $r(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new $r(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=Yn.fromNumber(this.Ie)}Ee(t,e,r){let s=t.add(e.multiply(Yn.fromNumber(r)));return s.compare(BT)===1&&(s=new Yn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=S_(t),[r,s]=R_(e);for(let o=0;o<this.hashCount;o++){let u=this.Ee(r,s,o);if(!this.de(u))return!1}return!0}static create(t,e,r){let s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),u=new n(o,s,e);return r.forEach(l=>u.insert(l)),u}insert(t){if(this.Ie===0)return;let e=S_(t),[r,s]=R_(e);for(let o=0;o<this.hashCount;o++){let u=this.Ee(r,s,o);this.Ae(u)}}Ae(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},$r=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var bu=class n{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let s=new Map;return s.set(t,Qo.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(et.min(),s,new bt(mt),On(),it())}},Qo=class n{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,it(),it(),it())}};var Oi=class{constructor(t,e,r,s){this.Re=t,this.removedTargetIds=e,this.key=r,this.Ve=s}},Su=class{constructor(t,e){this.targetId=t,this.me=e}},Ru=class{constructor(t,e,r=Xt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}},Pu=class{constructor(){this.fe=0,this.ge=C_(),this.pe=Xt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=it(),e=it(),r=it();return this.ge.forEach((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:Y()}}),new Qo(this.pe,this.ye,t,e,r)}Ce(){this.we=!1,this.ge=C_()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,yt(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},cf=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=On(),this.qe=P_(),this.Qe=new bt(mt)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let r=this.Ge(e);switch(t.state){case 0:this.ze(e)&&r.De(t.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(t.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(r.Ne(),r.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),r.De(t.resumeToken));break;default:Y()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((r,s)=>{this.ze(s)&&e(s)})}He(t){let e=t.targetId,r=t.me.count,s=this.Je(e);if(s){let o=s.target;if(Yd(o))if(r===0){let u=new W(o.path);this.Ue(e,u,ze.newNoDocument(u,et.min()))}else yt(r===1);else{let u=this.Ye(e);if(u!==r){let l=this.Ze(t),h=l?this.Xe(l,t,u):1;if(h!==0){this.je(e);let f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,f)}b_?.et((function(g,E,T,S,C){var V,P,M,F,q,H;let vt={localCacheCount:g,existenceFilterCount:E.count,databaseId:T.database,projectId:T.projectId},K=E.unchangedNames;return K&&(vt.bloomFilter={applied:C===0,hashCount:(V=K?.hashCount)!==null&&V!==void 0?V:0,bitmapLength:(F=(M=(P=K?.bits)===null||P===void 0?void 0:P.bitmap)===null||M===void 0?void 0:M.length)!==null&&F!==void 0?F:0,padding:(H=(q=K?.bits)===null||q===void 0?void 0:q.padding)!==null&&H!==void 0?H:0,mightContain:v=>{var m;return(m=S?.mightContain(v))!==null&&m!==void 0&&m}}),vt})(u,t.me,this.Le.tt(),l,h))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e,u,l;try{u=tr(r).toUint8Array()}catch(h){if(h instanceof Iu)return Fi("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new uf(u,s,o)}catch(h){return Fi(h instanceof $r?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.Ie===0?null:l}Xe(t,e,r){return e.me.count===r-this.nt(t,e.targetId)?0:2}nt(t,e){let r=this.Le.getRemoteKeysForTarget(e),s=0;return r.forEach(o=>{let u=this.Le.tt(),l=`projects/${u.projectId}/databases/${u.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.Ue(e,o,null),s++)}),s}rt(t){let e=new Map;this.Be.forEach((o,u)=>{let l=this.Je(u);if(l){if(o.current&&Yd(l.target)){let h=new W(l.target.path);this.ke.get(h)!==null||this.it(u,h)||this.Ue(u,h,ze.newNoDocument(h,t))}o.be&&(e.set(u,o.ve()),o.Ce())}});let r=it();this.qe.forEach((o,u)=>{let l=!0;u.forEachWhile(h=>{let f=this.Je(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.ke.forEach((o,u)=>u.setReadTime(t));let s=new bu(t,e,this.Qe,this.ke,r);return this.ke=On(),this.qe=P_(),this.Qe=new bt(mt),s}$e(t,e){if(!this.ze(t))return;let r=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,r),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,r){if(!this.ze(t))return;let s=this.Ge(t);this.it(t,e)?s.Fe(e,1):s.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),r&&(this.ke=this.ke.insert(e,r))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new Pu,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new Jt(mt),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||U("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new Pu),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function P_(){return new bt(W.comparator)}function C_(){return new bt(W.comparator)}var UT={asc:"ASCENDING",desc:"DESCENDING"},jT={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},zT={and:"AND",or:"OR"},lf=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function hf(n,t){return n.useProto3Json||Qu(t)?t:{value:t}}function Cu(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function lw(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function $T(n,t){return Cu(n,t.toTimestamp())}function Ye(n){return yt(!!n),et.fromTimestamp((function(e){let r=kn(e);return new Kt(r.seconds,r.nanos)})(n))}function Em(n,t){return df(n,t).canonicalString()}function df(n,t){let e=(function(s){return new kt(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function hw(n){let t=kt.fromString(n);return yt(pw(t)),t}function ff(n,t){return Em(n.databaseId,t.path)}function Rd(n,t){let e=hw(t);if(e.get(1)!==n.databaseId.projectId)throw new G(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new G(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new W(fw(e))}function dw(n,t){return Em(n.databaseId,t)}function GT(n){let t=hw(n);return t.length===4?kt.emptyPath():fw(t)}function mf(n){return new kt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fw(n){return yt(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function V_(n,t,e){return{name:ff(n,t),fields:e.value.mapValue.fields}}function KT(n,t){let e;if("targetChange"in t){t.targetChange;let r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Y()})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(f,g){return f.useProto3Json?(yt(g===void 0||typeof g=="string"),Xt.fromBase64String(g||"")):(yt(g===void 0||g instanceof Buffer||g instanceof Uint8Array),Xt.fromUint8Array(g||new Uint8Array))})(n,t.targetChange.resumeToken),u=t.targetChange.cause,l=u&&(function(f){let g=f.code===void 0?N.UNKNOWN:cw(f.code);return new G(g,f.message||"")})(u);e=new Ru(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=Rd(n,r.document.name),o=Ye(r.document.updateTime),u=r.document.createTime?Ye(r.document.createTime):et.min(),l=new me({mapValue:{fields:r.document.fields}}),h=ze.newFoundDocument(s,o,u,l),f=r.targetIds||[],g=r.removedTargetIds||[];e=new Oi(f,g,h.key,h)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=Rd(n,r.document),o=r.readTime?Ye(r.readTime):et.min(),u=ze.newNoDocument(s,o),l=r.removedTargetIds||[];e=new Oi([],l,u.key,u)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=Rd(n,r.document),o=r.removedTargetIds||[];e=new Oi([],o,s,null)}else{if(!("filter"in t))return Y();{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:o}=r,u=new af(s,o),l=r.targetId;e=new Su(l,u)}}return e}function QT(n,t){let e;if(t instanceof Xr)e={update:V_(n,t.key,t.value)};else if(t instanceof Au)e={delete:ff(n,t.key)};else if(t instanceof en)e={update:V_(n,t.key,t.data),updateMask:n0(t.fieldMask)};else{if(!(t instanceof nf))return Y();e={verify:ff(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>(function(o,u){let l=u.transform;if(l instanceof Wr)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Hr)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Jr)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof $i)return{fieldPath:u.field.canonicalString(),increment:l.Pe};throw Y()})(0,r))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:$T(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Y()})(n,t.precondition)),e}function WT(n,t){return n&&n.length>0?(yt(t!==void 0),n.map(e=>(function(s,o){let u=s.updateTime?Ye(s.updateTime):Ye(o);return u.isEqual(et.min())&&(u=Ye(o)),new ef(u,s.transformResults||[])})(e,t))):[]}function HT(n,t){return{documents:[dw(n,t.path)]}}function JT(n,t){let e={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=dw(n,s);let o=(function(f){if(f.length!==0)return gw(tn.create(f,"and"))})(t.filters);o&&(e.structuredQuery.where=o);let u=(function(f){if(f.length!==0)return f.map(g=>(function(T){return{field:Di(T.field),direction:ZT(T.dir)}})(g))})(t.orderBy);u&&(e.structuredQuery.orderBy=u);let l=hf(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(t.endAt)),{_t:e,parent:s}}function XT(n){let t=GT(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,s=null;if(r>0){yt(r===1);let g=e.from[0];g.allDescendants?s=g.collectionId:t=t.child(g.collectionId)}let o=[];e.where&&(o=(function(E){let T=mw(E);return T instanceof tn&&Q_(T)?T.getFilters():[T]})(e.where));let u=[];e.orderBy&&(u=(function(E){return E.map(T=>(function(C){return new Ui(Ni(C.field),(function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(C.direction))})(T))})(e.orderBy));let l=null;e.limit&&(l=(function(E){let T;return T=typeof E=="object"?E.value:E,Qu(T)?null:T})(e.limit));let h=null;e.startAt&&(h=(function(E){let T=!!E.before,S=E.values||[];return new Bi(S,T)})(e.startAt));let f=null;return e.endAt&&(f=(function(E){let T=!E.before,S=E.values||[];return new Bi(S,T)})(e.endAt)),ET(t,s,u,o,l,"F",h,f)}function YT(n,t){let e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Y()}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function mw(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=Ni(e.unaryFilter.field);return Lt.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=Ni(e.unaryFilter.field);return Lt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Ni(e.unaryFilter.field);return Lt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let u=Ni(e.unaryFilter.field);return Lt.create(u,"!=",{nullValue:"NULL_VALUE"});default:return Y()}})(n):n.fieldFilter!==void 0?(function(e){return Lt.create(Ni(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Y()}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return tn.create(e.compositeFilter.filters.map(r=>mw(r)),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Y()}})(e.compositeFilter.op))})(n):Y()}function ZT(n){return UT[n]}function t0(n){return jT[n]}function e0(n){return zT[n]}function Di(n){return{fieldPath:n.canonicalString()}}function Ni(n){return ge.fromServerFormat(n.fieldPath)}function gw(n){return n instanceof Lt?(function(e){if(e.op==="=="){if(p_(e.value))return{unaryFilter:{field:Di(e.field),op:"IS_NAN"}};if(g_(e.value))return{unaryFilter:{field:Di(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(p_(e.value))return{unaryFilter:{field:Di(e.field),op:"IS_NOT_NAN"}};if(g_(e.value))return{unaryFilter:{field:Di(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Di(e.field),op:t0(e.op),value:e.value}}})(n):n instanceof tn?(function(e){let r=e.getFilters().map(s=>gw(s));return r.length===1?r[0]:{compositeFilter:{op:e0(e.op),filters:r}}})(n):Y()}function n0(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function pw(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Wo=class n{constructor(t,e,r,s,o=et.min(),u=et.min(),l=Xt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var gf=class{constructor(t){this.ct=t}};function r0(n){let t=XT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Zd(t,t.limit,"L"):t}var Vu=class{constructor(){}It(t,e){this.Tt(t,e),e.Et()}Tt(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At(Et(t.integerValue));else if("doubleValue"in t){let r=Et(t.doubleValue);isNaN(r)?this.dt(e,13):(this.dt(e,15),$o(r)?e.At(0):e.At(r))}else if("timestampValue"in t){let r=t.timestampValue;this.dt(e,20),typeof r=="string"&&(r=kn(r)),e.Rt(`${r.seconds||""}`),e.At(r.nanos||0)}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(tr(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.dt(e,45),e.At(r.latitude||0),e.At(r.longitude||0)}else"mapValue"in t?$_(t)?this.dt(e,Number.MAX_SAFE_INTEGER):z_(t)?this.wt(t.mapValue,e):(this.St(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.bt(t.arrayValue,e),this.ft(e)):Y()}Vt(t,e){this.dt(e,25),this.Dt(t,e)}Dt(t,e){e.Rt(t)}St(t,e){let r=t.fields||{};this.dt(e,55);for(let s of Object.keys(r))this.Vt(s,e),this.Tt(r[s],e)}wt(t,e){var r,s;let o=t.fields||{};this.dt(e,53);let u="value",l=((s=(r=o[u].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(e,15),e.At(Et(l)),this.Vt(u,e),this.Tt(o[u],e)}bt(t,e){let r=t.values||[];this.dt(e,50);for(let s of r)this.Tt(s,e)}yt(t,e){this.dt(e,37),W.fromName(t).path.forEach(r=>{this.dt(e,60),this.Dt(r,e)})}dt(t,e){t.At(e)}ft(t){t.At(2)}};Vu.vt=new Vu;var pf=class{constructor(){this.un=new yf}addToCollectionParentIndex(t,e){return this.un.add(e),k.resolve()}getCollectionParents(t,e){return k.resolve(this.un.getEntries(e))}addFieldIndex(t,e){return k.resolve()}deleteFieldIndex(t,e){return k.resolve()}deleteAllFieldIndexes(t){return k.resolve()}createTargetIndexes(t,e){return k.resolve()}getDocumentsMatchingTarget(t,e){return k.resolve(null)}getIndexType(t,e){return k.resolve(0)}getFieldIndexes(t,e){return k.resolve([])}getNextCollectionGroupToUpdate(t){return k.resolve(null)}getMinOffset(t,e){return k.resolve(Kr.min())}getMinOffsetFromCollectionGroup(t,e){return k.resolve(Kr.min())}updateCollectionGroup(t,e,r){return k.resolve()}updateIndexEntries(t,e){return k.resolve()}},yf=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new Jt(kt.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){let e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new Jt(kt.comparator)).toArray()}};var Vb=new Uint8Array(0);var We=class n{constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};We.DEFAULT_COLLECTION_PERCENTILE=10,We.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,We.DEFAULT=new We(41943040,We.DEFAULT_COLLECTION_PERCENTILE,We.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),We.DISABLED=new We(-1,0,0);var Ho=class n{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var _f=class{constructor(){this.changes=new er(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ze.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?k.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var wf=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var vf=class{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,e))).next(s=>(r!==null&&zo(r.mutation,s,Ie.empty(),Kt.now()),s))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,it()).next(()=>r))}getLocalViewOfDocuments(t,e,r=it()){let s=zr();return this.populateOverlays(t,s,e).next(()=>this.computeViews(t,e,s,r).next(o=>{let u=qo();return o.forEach((l,h)=>{u=u.insert(l,h.overlayedDocument)}),u}))}getOverlayedDocuments(t,e){let r=zr();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,it()))}populateOverlays(t,e,r){let s=[];return r.forEach(o=>{e.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(t,s).next(o=>{o.forEach((u,l)=>{e.set(u,l)})})}computeViews(t,e,r,s){let o=On(),u=jo(),l=(function(){return jo()})();return e.forEach((h,f)=>{let g=r.get(f.key);s.has(f.key)&&(g===void 0||g.mutation instanceof en)?o=o.insert(f.key,f):g!==void 0?(u.set(f.key,g.mutation.getFieldMask()),zo(g.mutation,f,g.mutation.getFieldMask(),Kt.now())):u.set(f.key,Ie.empty())}),this.recalculateAndSaveOverlays(t,o).next(h=>(h.forEach((f,g)=>u.set(f,g)),e.forEach((f,g)=>{var E;return l.set(f,new wf(g,(E=u.get(f))!==null&&E!==void 0?E:null))}),l))}recalculateAndSaveOverlays(t,e){let r=jo(),s=new bt((u,l)=>u-l),o=it();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(u=>{for(let l of u)l.keys().forEach(h=>{let f=e.get(h);if(f===null)return;let g=r.get(h)||Ie.empty();g=l.applyToLocalView(f,g),r.set(h,g);let E=(s.get(l.batchId)||it()).add(h);s=s.insert(l.batchId,E)})}).next(()=>{let u=[],l=s.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),f=h.key,g=h.value,E=ew();g.forEach(T=>{if(!o.has(T)){let S=aw(e.get(T),r.get(T));S!==null&&E.set(T,S),o=o.add(T)}}),u.push(this.documentOverlayCache.saveOverlays(t,f,E))}return k.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,s){return(function(u){return W.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):TT(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next(o=>{let u=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):k.resolve(zr()),l=-1,h=o;return u.next(f=>k.forEach(f,(g,E)=>(l<E.largestBatchId&&(l=E.largestBatchId),o.get(g)?k.resolve():this.remoteDocumentCache.getEntry(t,g).next(T=>{h=h.insert(g,T)}))).next(()=>this.populateOverlays(t,f,o)).next(()=>this.computeViews(t,h,f,it())).next(g=>({batchId:l,changes:tw(g)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new W(e)).next(r=>{let s=qo();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){let o=e.collectionGroup,u=qo();return this.indexManager.getCollectionParents(t,o).next(l=>k.forEach(l,h=>{let f=(function(E,T){return new ji(T,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,f,r,s).next(g=>{g.forEach((E,T)=>{u=u.insert(E,T)})})}).next(()=>u))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(u=>(o=u,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s))).next(u=>{o.forEach((h,f)=>{let g=f.getKey();u.get(g)===null&&(u=u.insert(g,ze.newInvalidDocument(g)))});let l=qo();return u.forEach((h,f)=>{let g=o.get(h);g!==void 0&&zo(g.mutation,f,Ie.empty(),Kt.now()),Hu(e,f)&&(l=l.insert(h,f))}),l})}};var If=class{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,e){return k.resolve(this.hr.get(e))}saveBundleMetadata(t,e){return this.hr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Ye(s.createTime)}})(e)),k.resolve()}getNamedQuery(t,e){return k.resolve(this.Pr.get(e))}saveNamedQuery(t,e){return this.Pr.set(e.name,(function(s){return{name:s.name,query:r0(s.bundledQuery),readTime:Ye(s.readTime)}})(e)),k.resolve()}};var Ef=class{constructor(){this.overlays=new bt(W.comparator),this.Ir=new Map}getOverlay(t,e){return k.resolve(this.overlays.get(e))}getOverlays(t,e){let r=zr();return k.forEach(e,s=>this.getOverlay(t,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((s,o)=>{this.ht(t,e,o)}),k.resolve()}removeOverlaysForBatchId(t,e,r){let s=this.Ir.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.Ir.delete(r)),k.resolve()}getOverlaysForCollection(t,e,r){let s=zr(),o=e.length+1,u=new W(e.child("")),l=this.overlays.getIteratorFrom(u);for(;l.hasNext();){let h=l.getNext().value,f=h.getKey();if(!e.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return k.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new bt((f,g)=>f-g),u=this.overlays.getIterator();for(;u.hasNext();){let f=u.getNext().value;if(f.getKey().getCollectionGroup()===e&&f.largestBatchId>r){let g=o.get(f.largestBatchId);g===null&&(g=zr(),o=o.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}let l=zr(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,g)=>l.set(f,g)),!(l.size()>=s)););return k.resolve(l)}ht(t,e,r){let s=this.overlays.get(r.key);if(s!==null){let u=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new of(e,r));let o=this.Ir.get(e);o===void 0&&(o=it(),this.Ir.set(e,o)),this.Ir.set(e,o.add(r.key))}};var Tf=class{constructor(){this.sessionToken=Xt.EMPTY_BYTE_STRING}getSessionToken(t){return k.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,k.resolve()}};var Jo=class{constructor(){this.Tr=new Jt(Nt.Er),this.dr=new Jt(Nt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,e){let r=new Nt(t,e);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Vr(new Nt(t,e))}mr(t,e){t.forEach(r=>this.removeReference(r,e))}gr(t){let e=new W(new kt([])),r=new Nt(e,t),s=new Nt(e,t+1),o=[];return this.dr.forEachInRange([r,s],u=>{this.Vr(u),o.push(u.key)}),o}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){let e=new W(new kt([])),r=new Nt(e,t),s=new Nt(e,t+1),o=it();return this.dr.forEachInRange([r,s],u=>{o=o.add(u.key)}),o}containsKey(t){let e=new Nt(t,0),r=this.Tr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},Nt=class{constructor(t,e){this.key=t,this.wr=e}static Er(t,e){return W.comparator(t.key,e.key)||mt(t.wr,e.wr)}static Ar(t,e){return mt(t.wr,e.wr)||W.comparator(t.key,e.key)}};var Af=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Sr=1,this.br=new Jt(Nt.Er)}checkEmpty(t){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){let o=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let u=new rf(o,e,r,s);this.mutationQueue.push(u);for(let l of s)this.br=this.br.add(new Nt(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return k.resolve(u)}lookupMutationBatch(t,e){return k.resolve(this.Dr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,s=this.vr(r),o=s<0?0:s;return k.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new Nt(e,0),s=new Nt(e,Number.POSITIVE_INFINITY),o=[];return this.br.forEachInRange([r,s],u=>{let l=this.Dr(u.wr);o.push(l)}),k.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new Jt(mt);return e.forEach(s=>{let o=new Nt(s,0),u=new Nt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([o,u],l=>{r=r.add(l.wr)})}),k.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,s=r.length+1,o=r;W.isDocumentKey(o)||(o=o.child(""));let u=new Nt(new W(o),0),l=new Jt(mt);return this.br.forEachWhile(h=>{let f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(l=l.add(h.wr)),!0)},u),k.resolve(this.Cr(l))}Cr(t){let e=[];return t.forEach(r=>{let s=this.Dr(r);s!==null&&e.push(s)}),e}removeMutationBatch(t,e){yt(this.Fr(e.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return k.forEach(e.mutations,s=>{let o=new Nt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.br=r})}On(t){}containsKey(t,e){let r=new Nt(e,0),s=this.br.firstAfterOrEqual(r);return k.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,k.resolve()}Fr(t,e){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){let e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var bf=class{constructor(t){this.Mr=t,this.docs=(function(){return new bt(W.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,s=this.docs.get(r),o=s?s.size:0,u=this.Mr(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:u}),this.size+=u-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return k.resolve(r?r.document.mutableCopy():ze.newInvalidDocument(e))}getEntries(t,e){let r=On();return e.forEach(s=>{let o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():ze.newInvalidDocument(s))}),k.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=On(),u=e.path,l=new W(u.child("")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:f,value:{document:g}}=h.getNext();if(!u.isPrefixOf(f.path))break;f.path.length>u.length+1||hT(lT(g),r)<=0||(s.has(g.key)||Hu(e,g))&&(o=o.insert(g.key,g.mutableCopy()))}return k.resolve(o)}getAllFromCollectionGroup(t,e,r,s){Y()}Or(t,e){return k.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Sf(this)}getSize(t){return k.resolve(this.size)}},Sf=class extends _f{constructor(t){super(),this.cr=t}applyChanges(t){let e=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?e.push(this.cr.addEntry(t,s)):this.cr.removeEntry(r)}),k.waitFor(e)}getFromCache(t,e){return this.cr.getEntry(t,e)}getAllFromCache(t,e){return this.cr.getEntries(t,e)}};var Rf=class{constructor(t){this.persistence=t,this.Nr=new er(e=>_m(e),wm),this.lastRemoteSnapshotVersion=et.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Jo,this.targetCount=0,this.kr=Ho.Bn()}forEachTarget(t,e){return this.Nr.forEach((r,s)=>e(s)),k.resolve()}getLastRemoteSnapshotVersion(t){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return k.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.Lr&&(this.Lr=e),k.resolve()}Kn(t){this.Nr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.kr=new Ho(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,e){return this.Kn(e),this.targetCount+=1,k.resolve()}updateTargetData(t,e){return this.Kn(e),k.resolve()}removeTargetData(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,k.resolve()}removeTargets(t,e,r){let s=0,o=[];return this.Nr.forEach((u,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.Nr.delete(u),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)}),k.waitFor(o).next(()=>s)}getTargetCount(t){return k.resolve(this.targetCount)}getTargetData(t,e){let r=this.Nr.get(e)||null;return k.resolve(r)}addMatchingKeys(t,e,r){return this.Br.Rr(e,r),k.resolve()}removeMatchingKeys(t,e,r){this.Br.mr(e,r);let s=this.persistence.referenceDelegate,o=[];return s&&e.forEach(u=>{o.push(s.markPotentiallyOrphaned(t,u))}),k.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this.Br.gr(e),k.resolve()}getMatchingKeysForTargetId(t,e){let r=this.Br.yr(e);return k.resolve(r)}containsKey(t,e){return k.resolve(this.Br.containsKey(e))}};var Pf=class{constructor(t,e){this.qr={},this.overlays={},this.Qr=new U_(0),this.Kr=!1,this.Kr=!0,this.$r=new Tf,this.referenceDelegate=t(this),this.Ur=new Rf(this),this.indexManager=new pf,this.remoteDocumentCache=(function(s){return new bf(s)})(r=>this.referenceDelegate.Wr(r)),this.serializer=new gf(e),this.Gr=new If(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Ef,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.qr[t.toKey()];return r||(r=new Af(e,this.referenceDelegate),this.qr[t.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,e,r){U("MemoryPersistence","Starting transaction:",t);let s=new Cf(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(o=>this.referenceDelegate.jr(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Hr(t,e){return k.or(Object.values(this.qr).map(r=>()=>r.containsKey(t,e)))}},Cf=class extends qd{constructor(t){super(),this.currentSequenceNumber=t}},Vf=class n{constructor(t){this.persistence=t,this.Jr=new Jo,this.Yr=null}static Zr(t){return new n(t)}get Xr(){if(this.Yr)return this.Yr;throw Y()}addReference(t,e,r){return this.Jr.addReference(r,e),this.Xr.delete(r.toString()),k.resolve()}removeReference(t,e,r){return this.Jr.removeReference(r,e),this.Xr.add(r.toString()),k.resolve()}markPotentiallyOrphaned(t,e){return this.Xr.add(e.toString()),k.resolve()}removeTarget(t,e){this.Jr.gr(e.targetId).forEach(s=>this.Xr.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(s=>{s.forEach(o=>this.Xr.add(o.toString()))}).next(()=>r.removeTargetData(t,e))}zr(){this.Yr=new Set}jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.Xr,r=>{let s=W.fromPath(r);return this.ei(t,s).next(o=>{o||e.removeEntry(s,et.min())})}).next(()=>(this.Yr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ei(t,e).next(r=>{r?this.Xr.delete(e.toString()):this.Xr.add(e.toString())})}Wr(t){return 0}ei(t,e){return k.or([()=>k.resolve(this.Jr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Hr(t,e)])}};var xf=class n{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.$i=r,this.Ui=s}static Wi(t,e){let r=it(),s=it();for(let o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new n(t,e.fromCache,r,s)}};var Df=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Nf=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(function(){return zm()?8:fT(jm())>0?6:4})()}initialize(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}getDocumentsMatchingQuery(t,e,r,s){let o={result:null};return this.Yi(t,e).next(u=>{o.result=u}).next(()=>{if(!o.result)return this.Zi(t,e,s,r).next(u=>{o.result=u})}).next(()=>{if(o.result)return;let u=new Df;return this.Xi(t,e,u).next(l=>{if(o.result=l,this.zi)return this.es(t,e,u,l.size)})}).next(()=>o.result)}es(t,e,r,s){return r.documentReadCount<this.ji?(Lo()<=vn.DEBUG&&U("QueryEngine","SDK will not create cache indexes for query:",xi(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),k.resolve()):(Lo()<=vn.DEBUG&&U("QueryEngine","Query:",xi(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Lo()<=vn.DEBUG&&U("QueryEngine","The SDK decides to create cache indexes for query:",xi(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Xe(e))):k.resolve())}Yi(t,e){if(v_(e))return k.resolve(null);let r=Xe(e);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(e.limit!==null&&s===1&&(e=Zd(e,null,"F"),r=Xe(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(o=>{let u=it(...o);return this.Ji.getDocuments(t,u).next(l=>this.indexManager.getMinOffset(t,r).next(h=>{let f=this.ts(e,l);return this.ns(e,f,u,h.readTime)?this.Yi(t,Zd(e,null,"F")):this.rs(t,f,e,h)}))})))}Zi(t,e,r,s){return v_(e)||s.isEqual(et.min())?k.resolve(null):this.Ji.getDocuments(t,r).next(o=>{let u=this.ts(e,o);return this.ns(e,u,r,s)?k.resolve(null):(Lo()<=vn.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),xi(e)),this.rs(t,u,e,cT(s,-1)).next(l=>l))})}ts(t,e){let r=new Jt(Y_(t));return e.forEach((s,o)=>{Hu(t,o)&&(r=r.add(o))}),r}ns(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Xi(t,e,r){return Lo()<=vn.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",xi(e)),this.Ji.getDocumentsMatchingQuery(t,e,Kr.min(),r)}rs(t,e,r,s){return this.Ji.getDocumentsMatchingQuery(t,r,s).next(o=>(e.forEach(u=>{o=o.insert(u.key,u)}),o))}};var kf=class{constructor(t,e,r,s){this.persistence=t,this.ss=e,this.serializer=s,this.os=new bt(mt),this._s=new er(o=>_m(o),wm),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(r)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new vf(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.os))}};function i0(n,t,e,r){return new kf(n,t,e,r)}async function yw(n,t){let e=tt(n);return await e.persistence.runTransaction("Handle user change","readonly",r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,e.ls(t),e.mutationQueue.getAllMutationBatches(r))).next(o=>{let u=[],l=[],h=it();for(let f of s){u.push(f.batchId);for(let g of f.mutations)h=h.add(g.key)}for(let f of o){l.push(f.batchId);for(let g of f.mutations)h=h.add(g.key)}return e.localDocuments.getDocuments(r,h).next(f=>({hs:f,removedBatchIds:u,addedBatchIds:l}))})})}function s0(n,t){let e=tt(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),o=e.cs.newChangeBuffer({trackRemovals:!0});return(function(l,h,f,g){let E=f.batch,T=E.keys(),S=k.resolve();return T.forEach(C=>{S=S.next(()=>g.getEntry(h,C)).next(V=>{let P=f.docVersions.get(C);yt(P!==null),V.version.compareTo(P)<0&&(E.applyToRemoteDocument(V,f),V.isValidDocument()&&(V.setReadTime(f.commitVersion),g.addEntry(V)))})}),S.next(()=>l.mutationQueue.removeMutationBatch(h,E))})(e,r,t,o).next(()=>o.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=it();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h})(t))).next(()=>e.localDocuments.getDocuments(r,s))})}function _w(n){let t=tt(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function o0(n,t){let e=tt(n),r=t.snapshotVersion,s=e.os;return e.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let u=e.cs.newChangeBuffer({trackRemovals:!0});s=e.os;let l=[];t.targetChanges.forEach((g,E)=>{let T=s.get(E);if(!T)return;l.push(e.Ur.removeMatchingKeys(o,g.removedDocuments,E).next(()=>e.Ur.addMatchingKeys(o,g.addedDocuments,E)));let S=T.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(E)!==null?S=S.withResumeToken(Xt.EMPTY_BYTE_STRING,et.min()).withLastLimboFreeSnapshotVersion(et.min()):g.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(g.resumeToken,r)),s=s.insert(E,S),(function(V,P,M){return V.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=3e8?!0:M.addedDocuments.size+M.modifiedDocuments.size+M.removedDocuments.size>0})(T,S,g)&&l.push(e.Ur.updateTargetData(o,S))});let h=On(),f=it();if(t.documentUpdates.forEach(g=>{t.resolvedLimboDocuments.has(g)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,g))}),l.push(a0(o,u,t.documentUpdates).next(g=>{h=g.Ps,f=g.Is})),!r.isEqual(et.min())){let g=e.Ur.getLastRemoteSnapshotVersion(o).next(E=>e.Ur.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(g)}return k.waitFor(l).next(()=>u.apply(o)).next(()=>e.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(e.os=s,o))}function a0(n,t,e){let r=it(),s=it();return e.forEach(o=>r=r.add(o)),t.getEntries(n,r).next(o=>{let u=On();return e.forEach((l,h)=>{let f=o.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(et.min())?(t.removeEntry(l,h.readTime),u=u.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(t.addEntry(h),u=u.insert(l,h)):U("LocalStore","Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{Ps:u,Is:s}})}function u0(n,t){let e=tt(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function c0(n,t){let e=tt(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return e.Ur.getTargetData(r,t).next(o=>o?(s=o,k.resolve(s)):e.Ur.allocateTargetId(r).next(u=>(s=new Wo(t,u,"TargetPurposeListen",r.currentSequenceNumber),e.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=e.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.os=e.os.insert(r.targetId,r),e._s.set(t,r.targetId)),r})}async function Of(n,t,e){let r=tt(n),s=r.os.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,u=>r.persistence.referenceDelegate.removeTarget(u,s))}catch(u){if(!ra(u))throw u;U("LocalStore",`Failed to update sequence numbers for target ${t}: ${u}`)}r.os=r.os.remove(t),r._s.delete(s.target)}function x_(n,t,e){let r=tt(n),s=et.min(),o=it();return r.persistence.runTransaction("Execute query","readwrite",u=>(function(h,f,g){let E=tt(h),T=E._s.get(g);return T!==void 0?k.resolve(E.os.get(T)):E.Ur.getTargetData(f,g)})(r,u,Xe(t)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(u,l.targetId).next(h=>{o=h})}).next(()=>r.ss.getDocumentsMatchingQuery(u,t,e?s:et.min(),e?o:it())).next(l=>(l0(r,bT(t),l),{documents:l,Ts:o})))}function l0(n,t,e){let r=n.us.get(t)||et.min();e.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.us.set(t,r)}var xu=class{constructor(){this.activeTargetIds=xT()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Ff=class{constructor(){this.so=new xu,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,e,r){this.oo[t]=e}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new xu,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Mf=class{_o(t){}shutdown(){}};var Du=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){U("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ho)t(0)}lo(){U("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var mu=null;function Pd(){return mu===null?mu=(function(){return 268435456+Math.round(2147483648*Math.random())})():mu++,"0x"+mu.toString(16)}var h0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Lf=class{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}};var Ht="WebChannelConnection",qf=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let r=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+e.host,this.vo=`projects/${s}/databases/${o}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${o}`}get Fo(){return!1}Mo(e,r,s,o,u){let l=Pd(),h=this.xo(e,r.toUriEncodedString());U("RestConnection",`Sending RPC '${e}' ${l}:`,h,s);let f={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(f,o,u),this.No(e,h,f,s).then(g=>(U("RestConnection",`Received RPC '${e}' ${l}: `,g),g),g=>{throw Fi("RestConnection",`RPC '${e}' ${l} failed with error: `,g,"url: ",h,"request:",s),g})}Lo(e,r,s,o,u,l){return this.Mo(e,r,s,o,u)}Oo(e,r,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ji})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((o,u)=>e[u]=o),s&&s.headers.forEach((o,u)=>e[u]=o)}xo(e,r){let s=h0[e];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,e,r,s){let o=Pd();return new Promise((u,l)=>{let h=new Ed;h.setWithCredentials(!0),h.listenOnce(Td.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Mo.NO_ERROR:let g=h.getResponseJson();U(Ht,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(g)),u(g);break;case Mo.TIMEOUT:U(Ht,`RPC '${t}' ${o} timed out`),l(new G(N.DEADLINE_EXCEEDED,"Request time out"));break;case Mo.HTTP_ERROR:let E=h.getStatus();if(U(Ht,`RPC '${t}' ${o} failed with status:`,E,"response text:",h.getResponseText()),E>0){let T=h.getResponseJson();Array.isArray(T)&&(T=T[0]);let S=T?.error;if(S&&S.status&&S.message){let C=(function(P){let M=P.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(M)>=0?M:N.UNKNOWN})(S.status);l(new G(C,S.message))}else l(new G(N.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new G(N.UNAVAILABLE,"Connection failed."));break;default:Y()}}finally{U(Ht,`RPC '${t}' ${o} completed.`)}});let f=JSON.stringify(s);U(Ht,`RPC '${t}' ${o} sending request:`,s),h.send(e,"POST",f,r,15)})}Bo(t,e,r){let s=Pd(),o=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],u=Sd(),l=bd(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Oo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;let g=o.join("");U(Ht,`Creating RPC '${t}' stream ${s}: ${g}`,h);let E=u.createWebChannel(g,h),T=!1,S=!1,C=new Lf({Io:P=>{S?U(Ht,`Not sending because RPC '${t}' stream ${s} is closed:`,P):(T||(U(Ht,`Opening RPC '${t}' stream ${s} transport.`),E.open(),T=!0),U(Ht,`RPC '${t}' stream ${s} sending:`,P),E.send(P))},To:()=>E.close()}),V=(P,M,F)=>{P.listen(M,q=>{try{F(q)}catch(H){setTimeout(()=>{throw H},0)}})};return V(E,Vi.EventType.OPEN,()=>{S||(U(Ht,`RPC '${t}' stream ${s} transport opened.`),C.yo())}),V(E,Vi.EventType.CLOSE,()=>{S||(S=!0,U(Ht,`RPC '${t}' stream ${s} transport closed`),C.So())}),V(E,Vi.EventType.ERROR,P=>{S||(S=!0,Fi(Ht,`RPC '${t}' stream ${s} transport errored:`,P),C.So(new G(N.UNAVAILABLE,"The operation could not be completed")))}),V(E,Vi.EventType.MESSAGE,P=>{var M;if(!S){let F=P.data[0];yt(!!F);let q=F,H=q.error||((M=q[0])===null||M===void 0?void 0:M.error);if(H){U(Ht,`RPC '${t}' stream ${s} received error:`,H);let vt=H.status,K=(function(y){let _=Dt[y];if(_!==void 0)return cw(_)})(vt),v=H.message;K===void 0&&(K=N.INTERNAL,v="Unknown error status: "+vt+" with message "+H.message),S=!0,C.So(new G(K,v)),E.close()}else U(Ht,`RPC '${t}' stream ${s} received:`,F),C.bo(F)}}),V(l,Ad.STAT_EVENT,P=>{P.stat===du.PROXY?U(Ht,`RPC '${t}' stream ${s} detected buffering proxy`):P.stat===du.NOPROXY&&U(Ht,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}};function Cd(){return typeof document<"u"?document:null}function Ju(n){return new lf(n,!0)}var Nu=class{constructor(t,e,r=1e3,s=1.5,o=6e4){this.ui=t,this.timerId=e,this.ko=r,this.qo=s,this.Qo=o,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();let e=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,e-r);s>0&&U("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var ku=class{constructor(t,e,r,s,o,u,l,h){this.ui=t,this.Ho=r,this.Jo=s,this.connection=o,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Nu(t,e)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(t,e){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():e&&e.code===N.RESOURCE_EXHAUSTED?(Nn(e.toString()),Nn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):e&&e.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.mo(e)}l_(){}auth(){this.state=1;let t=this.h_(this.Yo),e=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===e&&this.P_(r,s)},r=>{t(()=>{let s=new G(N.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(t,e){let r=this.h_(this.Yo);this.stream=this.T_(t,e),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(t){return U("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return e=>{this.ui.enqueueAndForget(()=>this.Yo===t?e():(U("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Bf=class extends ku{constructor(t,e,r,s,o,u){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,u),this.serializer=o}T_(t,e){return this.connection.Bo("Listen",t,e)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();let e=KT(this.serializer,t),r=(function(o){if(!("targetChange"in o))return et.min();let u=o.targetChange;return u.targetIds&&u.targetIds.length?et.min():u.readTime?Ye(u.readTime):et.min()})(t);return this.listener.d_(e,r)}A_(t){let e={};e.database=mf(this.serializer),e.addTarget=(function(o,u){let l,h=u.target;if(l=Yd(h)?{documents:HT(o,h)}:{query:JT(o,h)._t},l.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){l.resumeToken=lw(o,u.resumeToken);let f=hf(o,u.expectedCount);f!==null&&(l.expectedCount=f)}else if(u.snapshotVersion.compareTo(et.min())>0){l.readTime=Cu(o,u.snapshotVersion.toTimestamp());let f=hf(o,u.expectedCount);f!==null&&(l.expectedCount=f)}return l})(this.serializer,t);let r=YT(this.serializer,t);r&&(e.labels=r),this.a_(e)}R_(t){let e={};e.database=mf(this.serializer),e.removeTarget=t,this.a_(e)}},Uf=class extends ku{constructor(t,e,r,s,o,u){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,u),this.serializer=o}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,e){return this.connection.Bo("Write",t,e)}E_(t){return yt(!!t.streamToken),this.lastStreamToken=t.streamToken,yt(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){yt(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();let e=WT(t.writeResults,t.commitTime),r=Ye(t.commitTime);return this.listener.g_(r,e)}p_(){let t={};t.database=mf(this.serializer),this.a_(t)}m_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>QT(this.serializer,r))};this.a_(e)}};var jf=class extends class{}{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new G(N.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,e,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Mo(t,df(e,r),s,o,u)).catch(o=>{throw o.name==="FirebaseError"?(o.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new G(N.UNKNOWN,o.toString())})}Lo(t,e,r,s,o){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,l])=>this.connection.Lo(t,df(e,r),s,u,l,o)).catch(u=>{throw u.name==="FirebaseError"?(u.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new G(N.UNKNOWN,u.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},zf=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Nn(e),this.D_=!1):U("OnlineStateTracker",e)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var $f=class{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=o,this.k_._o(u=>{r.enqueueAndForget(async()=>{ti(this)&&(U("RemoteStore","Restarting streams for network reachability change."),await(async function(h){let f=tt(h);f.L_.add(4),await ia(f),f.q_.set("Unknown"),f.L_.delete(4),await Xu(f)})(this))})}),this.q_=new zf(r,s)}};async function Xu(n){if(ti(n))for(let t of n.B_)await t(!0)}async function ia(n){for(let t of n.B_)await t(!1)}function ww(n,t){let e=tt(n);e.N_.has(t.targetId)||(e.N_.set(t.targetId,t),Sm(e)?bm(e):Xi(e).r_()&&Am(e,t))}function Tm(n,t){let e=tt(n),r=Xi(e);e.N_.delete(t),r.r_()&&vw(e,t),e.N_.size===0&&(r.r_()?r.o_():ti(e)&&e.q_.set("Unknown"))}function Am(n,t){if(n.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(et.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Xi(n).A_(t)}function vw(n,t){n.Q_.xe(t),Xi(n).R_(t)}function bm(n){n.Q_=new cf({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>n.N_.get(t)||null,tt:()=>n.datastore.serializer.databaseId}),Xi(n).start(),n.q_.v_()}function Sm(n){return ti(n)&&!Xi(n).n_()&&n.N_.size>0}function ti(n){return tt(n).L_.size===0}function Iw(n){n.Q_=void 0}async function d0(n){n.q_.set("Online")}async function f0(n){n.N_.forEach((t,e)=>{Am(n,t)})}async function m0(n,t){Iw(n),Sm(n)?(n.q_.M_(t),bm(n)):n.q_.set("Unknown")}async function g0(n,t,e){if(n.q_.set("Online"),t instanceof Ru&&t.state===2&&t.cause)try{await(async function(s,o){let u=o.cause;for(let l of o.targetIds)s.N_.has(l)&&(await s.remoteSyncer.rejectListen(l,u),s.N_.delete(l),s.Q_.removeTarget(l))})(n,t)}catch(r){U("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),await Ou(n,r)}else if(t instanceof Oi?n.Q_.Ke(t):t instanceof Su?n.Q_.He(t):n.Q_.We(t),!e.isEqual(et.min()))try{let r=await _w(n.localStore);e.compareTo(r)>=0&&await(function(o,u){let l=o.Q_.rt(u);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){let g=o.N_.get(f);g&&o.N_.set(f,g.withResumeToken(h.resumeToken,u))}}),l.targetMismatches.forEach((h,f)=>{let g=o.N_.get(h);if(!g)return;o.N_.set(h,g.withResumeToken(Xt.EMPTY_BYTE_STRING,g.snapshotVersion)),vw(o,h);let E=new Wo(g.target,h,f,g.sequenceNumber);Am(o,E)}),o.remoteSyncer.applyRemoteEvent(l)})(n,e)}catch(r){U("RemoteStore","Failed to raise snapshot:",r),await Ou(n,r)}}async function Ou(n,t,e){if(!ra(t))throw t;n.L_.add(1),await ia(n),n.q_.set("Offline"),e||(e=()=>_w(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{U("RemoteStore","Retrying IndexedDB access"),await e(),n.L_.delete(1),await Xu(n)})}function Ew(n,t){return t().catch(e=>Ou(n,e,t))}async function Yu(n){let t=tt(n),e=nr(t),r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;p0(t);)try{let s=await u0(t.localStore,r);if(s===null){t.O_.length===0&&e.o_();break}r=s.batchId,y0(t,s)}catch(s){await Ou(t,s)}Tw(t)&&Aw(t)}function p0(n){return ti(n)&&n.O_.length<10}function y0(n,t){n.O_.push(t);let e=nr(n);e.r_()&&e.V_&&e.m_(t.mutations)}function Tw(n){return ti(n)&&!nr(n).n_()&&n.O_.length>0}function Aw(n){nr(n).start()}async function _0(n){nr(n).p_()}async function w0(n){let t=nr(n);for(let e of n.O_)t.m_(e.mutations)}async function v0(n,t,e){let r=n.O_.shift(),s=sf.from(r,t,e);await Ew(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Yu(n)}async function I0(n,t){t&&nr(n).V_&&await(async function(r,s){if((function(u){return LT(u)&&u!==N.ABORTED})(s.code)){let o=r.O_.shift();nr(r).s_(),await Ew(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),await Yu(r)}})(n,t),Tw(n)&&Aw(n)}async function D_(n,t){let e=tt(n);e.asyncQueue.verifyOperationInProgress(),U("RemoteStore","RemoteStore received new credentials");let r=ti(e);e.L_.add(3),await ia(e),r&&e.q_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.L_.delete(3),await Xu(e)}async function E0(n,t){let e=tt(n);t?(e.L_.delete(2),await Xu(e)):t||(e.L_.add(2),await ia(e),e.q_.set("Unknown"))}function Xi(n){return n.K_||(n.K_=(function(e,r,s){let o=tt(e);return o.w_(),new Bf(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Eo:d0.bind(null,n),Ro:f0.bind(null,n),mo:m0.bind(null,n),d_:g0.bind(null,n)}),n.B_.push(async t=>{t?(n.K_.s_(),Sm(n)?bm(n):n.q_.set("Unknown")):(await n.K_.stop(),Iw(n))})),n.K_}function nr(n){return n.U_||(n.U_=(function(e,r,s){let o=tt(e);return o.w_(),new Uf(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:_0.bind(null,n),mo:I0.bind(null,n),f_:w0.bind(null,n),g_:v0.bind(null,n)}),n.B_.push(async t=>{t?(n.U_.s_(),await Yu(n)):(await n.U_.stop(),n.O_.length>0&&(U("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}var Gf=class n{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new He,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){let u=Date.now()+r,l=new n(t,e,u,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new G(N.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Rm(n,t){if(Nn("AsyncQueue",`${t}: ${n}`),ra(n))return new G(N.UNAVAILABLE,`${t}: ${n}`);throw n}var Fu=class n{constructor(t){this.comparator=t?(e,r)=>t(e,r)||W.comparator(e.key,r.key):(e,r)=>W.comparator(e.key,r.key),this.keyedMap=qo(),this.sortedSet=new bt(this.comparator)}static emptySet(t){return new n(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var Mu=class{constructor(){this.W_=new bt(W.comparator)}track(t){let e=t.doc.key,r=this.W_.get(e);r?t.type!==0&&r.type===3?this.W_=this.W_.insert(e,t):t.type===3&&r.type!==1?this.W_=this.W_.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.W_=this.W_.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.W_=this.W_.remove(e):t.type===1&&r.type===2?this.W_=this.W_.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):Y():this.W_=this.W_.insert(e,t)}G_(){let t=[];return this.W_.inorderTraversal((e,r)=>{t.push(r)}),t}},Ki=class n{constructor(t,e,r,s,o,u,l,h,f){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=u,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(t,e,r,s,o){let u=[];return e.forEach(l=>{u.push({type:0,doc:l})}),new n(t,e,Fu.emptySet(e),u,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Wu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}};var Kf=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}},Qf=class{constructor(){this.queries=N_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(e,r){let s=tt(e),o=s.queries;s.queries=N_(),o.forEach((u,l)=>{for(let h of l.j_)h.onError(r)})})(this,new G(N.ABORTED,"Firestore shutting down"))}};function N_(){return new er(n=>X_(n),Wu)}async function T0(n,t){let e=tt(n),r=3,s=t.query,o=e.queries.get(s);o?!o.H_()&&t.J_()&&(r=2):(o=new Kf,r=t.J_()?0:1);try{switch(r){case 0:o.z_=await e.onListen(s,!0);break;case 1:o.z_=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(u){let l=Rm(u,`Initialization of query '${xi(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.j_.push(t),t.Z_(e.onlineState),o.z_&&t.X_(o.z_)&&Pm(e)}async function A0(n,t){let e=tt(n),r=t.query,s=3,o=e.queries.get(r);if(o){let u=o.j_.indexOf(t);u>=0&&(o.j_.splice(u,1),o.j_.length===0?s=t.J_()?0:1:!o.H_()&&t.J_()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function b0(n,t){let e=tt(n),r=!1;for(let s of t){let o=s.query,u=e.queries.get(o);if(u){for(let l of u.j_)l.X_(s)&&(r=!0);u.z_=s}}r&&Pm(e)}function S0(n,t,e){let r=tt(n),s=r.queries.get(t);if(s)for(let o of s.j_)o.onError(e);r.queries.delete(t)}function Pm(n){n.Y_.forEach(t=>{t.next()})}var Wf,k_;(k_=Wf||(Wf={})).ea="default",k_.Cache="cache";var Hf=class{constructor(t,e,r){this.query=t,this.ta=e,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new Ki(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.na?this.ia(t)&&(this.ta.next(t),e=!0):this.sa(t,this.onlineState)&&(this.oa(t),e=!0),this.ra=t,e}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let e=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),e=!0),e}sa(t,e){if(!t.fromCache||!this.J_())return!0;let r=e!=="Offline";return(!this.options._a||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ia(t){if(t.docChanges.length>0)return!0;let e=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}oa(t){t=Ki.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==Wf.Cache}};var Lu=class{constructor(t){this.key=t}},qu=class{constructor(t){this.key=t}},Jf=class{constructor(t,e){this.query=t,this.Ta=e,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=it(),this.mutatedKeys=it(),this.Aa=Y_(t),this.Ra=new Fu(this.Aa)}get Va(){return this.Ta}ma(t,e){let r=e?e.fa:new Mu,s=e?e.Ra:this.Ra,o=e?e.mutatedKeys:this.mutatedKeys,u=s,l=!1,h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((g,E)=>{let T=s.get(g),S=Hu(this.query,E)?E:null,C=!!T&&this.mutatedKeys.has(T.key),V=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),P=!1;T&&S?T.data.isEqual(S.data)?C!==V&&(r.track({type:3,doc:S}),P=!0):this.ga(T,S)||(r.track({type:2,doc:S}),P=!0,(h&&this.Aa(S,h)>0||f&&this.Aa(S,f)<0)&&(l=!0)):!T&&S?(r.track({type:0,doc:S}),P=!0):T&&!S&&(r.track({type:1,doc:T}),P=!0,(h||f)&&(l=!0)),P&&(S?(u=u.add(S),o=V?o.add(g):o.delete(g)):(u=u.delete(g),o=o.delete(g)))}),this.query.limit!==null)for(;u.size>this.query.limit;){let g=this.query.limitType==="F"?u.last():u.first();u=u.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{Ra:u,fa:r,ns:l,mutatedKeys:o}}ga(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){let o=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;let u=t.fa.G_();u.sort((g,E)=>(function(S,C){let V=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Y()}};return V(S)-V(C)})(g.type,E.type)||this.Aa(g.doc,E.doc)),this.pa(r),s=s!=null&&s;let l=e&&!s?this.ya():[],h=this.da.size===0&&this.current&&!s?1:0,f=h!==this.Ea;return this.Ea=h,u.length!==0||f?{snapshot:new Ki(this.query,t.Ra,o,u,t.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:l}:{wa:l}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Mu,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=t.current)}ya(){if(!this.current)return[];let t=this.da;this.da=it(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let e=[];return t.forEach(r=>{this.da.has(r)||e.push(new qu(r))}),this.da.forEach(r=>{t.has(r)||e.push(new Lu(r))}),e}ba(t){this.Ta=t.Ts,this.da=it();let e=this.ma(t.documents);return this.applyChanges(e,!0)}Da(){return Ki.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Xf=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},Yf=class{constructor(t){this.key=t,this.va=!1}},Zf=class{constructor(t,e,r,s,o,u){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=u,this.Ca={},this.Fa=new er(l=>X_(l),Wu),this.Ma=new Map,this.xa=new Set,this.Oa=new bt(W.comparator),this.Na=new Map,this.La=new Jo,this.Ba={},this.ka=new Map,this.qa=Ho.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};async function R0(n,t,e=!0){let r=Vw(n),s,o=r.Fa.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.Da()):s=await bw(r,t,e,!0),s}async function P0(n,t){let e=Vw(n);await bw(e,t,!0,!1)}async function bw(n,t,e,r){let s=await c0(n.localStore,Xe(t)),o=s.targetId,u=n.sharedClientState.addLocalQueryTarget(o,e),l;return r&&(l=await C0(n,t,o,u==="current",s.resumeToken)),n.isPrimaryClient&&e&&ww(n.remoteStore,s),l}async function C0(n,t,e,r,s){n.Ka=(E,T,S)=>(async function(V,P,M,F){let q=P.view.ma(M);q.ns&&(q=await x_(V.localStore,P.query,!1).then(({documents:v})=>P.view.ma(v,q)));let H=F&&F.targetChanges.get(P.targetId),vt=F&&F.targetMismatches.get(P.targetId)!=null,K=P.view.applyChanges(q,V.isPrimaryClient,H,vt);return F_(V,P.targetId,K.wa),K.snapshot})(n,E,T,S);let o=await x_(n.localStore,t,!0),u=new Jf(t,o.Ts),l=u.ma(o.documents),h=Qo.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),f=u.applyChanges(l,n.isPrimaryClient,h);F_(n,e,f.wa);let g=new Xf(t,e,u);return n.Fa.set(t,g),n.Ma.has(e)?n.Ma.get(e).push(t):n.Ma.set(e,[t]),f.snapshot}async function V0(n,t,e){let r=tt(n),s=r.Fa.get(t),o=r.Ma.get(s.targetId);if(o.length>1)return r.Ma.set(s.targetId,o.filter(u=>!Wu(u,t))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Of(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),e&&Tm(r.remoteStore,s.targetId),tm(r,s.targetId)}).catch(na)):(tm(r,s.targetId),await Of(r.localStore,s.targetId,!0))}async function x0(n,t){let e=tt(n),r=e.Fa.get(t),s=e.Ma.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Tm(e.remoteStore,r.targetId))}async function D0(n,t,e){let r=q0(n);try{let s=await(function(u,l){let h=tt(u),f=Kt.now(),g=l.reduce((S,C)=>S.add(C.key),it()),E,T;return h.persistence.runTransaction("Locally write mutations","readwrite",S=>{let C=On(),V=it();return h.cs.getEntries(S,g).next(P=>{C=P,C.forEach((M,F)=>{F.isValidDocument()||(V=V.add(M))})}).next(()=>h.localDocuments.getOverlayedDocuments(S,C)).next(P=>{E=P;let M=[];for(let F of l){let q=MT(F,E.get(F.key).overlayedDocument);q!=null&&M.push(new en(F.key,q,G_(q.value.mapValue),Zn.exists(!0)))}return h.mutationQueue.addMutationBatch(S,f,M,l)}).next(P=>{T=P;let M=P.applyToLocalDocumentSet(E,V);return h.documentOverlayCache.saveOverlays(S,P.batchId,M)})}).then(()=>({batchId:T.batchId,changes:tw(E)}))})(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),(function(u,l,h){let f=u.Ba[u.currentUser.toKey()];f||(f=new bt(mt)),f=f.insert(l,h),u.Ba[u.currentUser.toKey()]=f})(r,s.batchId,e),await sa(r,s.changes),await Yu(r.remoteStore)}catch(s){let o=Rm(s,"Failed to persist write");e.reject(o)}}async function Sw(n,t){let e=tt(n);try{let r=await o0(e.localStore,t);t.targetChanges.forEach((s,o)=>{let u=e.Na.get(o);u&&(yt(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?u.va=!0:s.modifiedDocuments.size>0?yt(u.va):s.removedDocuments.size>0&&(yt(u.va),u.va=!1))}),await sa(e,r,t)}catch(r){await na(r)}}function O_(n,t,e){let r=tt(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let s=[];r.Fa.forEach((o,u)=>{let l=u.view.Z_(t);l.snapshot&&s.push(l.snapshot)}),(function(u,l){let h=tt(u);h.onlineState=l;let f=!1;h.queries.forEach((g,E)=>{for(let T of E.j_)T.Z_(l)&&(f=!0)}),f&&Pm(h)})(r.eventManager,t),s.length&&r.Ca.d_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function N0(n,t,e){let r=tt(n);r.sharedClientState.updateQueryState(t,"rejected",e);let s=r.Na.get(t),o=s&&s.key;if(o){let u=new bt(W.comparator);u=u.insert(o,ze.newNoDocument(o,et.min()));let l=it().add(o),h=new bu(et.min(),new Map,new bt(mt),u,l);await Sw(r,h),r.Oa=r.Oa.remove(o),r.Na.delete(t),Cm(r)}else await Of(r.localStore,t,!1).then(()=>tm(r,t,e)).catch(na)}async function k0(n,t){let e=tt(n),r=t.batch.batchId;try{let s=await s0(e.localStore,t);Pw(e,r,null),Rw(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await sa(e,s)}catch(s){await na(s)}}async function O0(n,t,e){let r=tt(n);try{let s=await(function(u,l){let h=tt(u);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let g;return h.mutationQueue.lookupMutationBatch(f,l).next(E=>(yt(E!==null),g=E.keys(),h.mutationQueue.removeMutationBatch(f,E))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,g,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g)).next(()=>h.localDocuments.getDocuments(f,g))})})(r.localStore,t);Pw(r,t,e),Rw(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await sa(r,s)}catch(s){await na(s)}}function Rw(n,t){(n.ka.get(t)||[]).forEach(e=>{e.resolve()}),n.ka.delete(t)}function Pw(n,t,e){let r=tt(n),s=r.Ba[r.currentUser.toKey()];if(s){let o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Ba[r.currentUser.toKey()]=s}}function tm(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Ma.get(t))n.Fa.delete(r),e&&n.Ca.$a(r,e);n.Ma.delete(t),n.isPrimaryClient&&n.La.gr(t).forEach(r=>{n.La.containsKey(r)||Cw(n,r)})}function Cw(n,t){n.xa.delete(t.path.canonicalString());let e=n.Oa.get(t);e!==null&&(Tm(n.remoteStore,e),n.Oa=n.Oa.remove(t),n.Na.delete(e),Cm(n))}function F_(n,t,e){for(let r of e)r instanceof Lu?(n.La.addReference(r.key,t),F0(n,r)):r instanceof qu?(U("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,t),n.La.containsKey(r.key)||Cw(n,r.key)):Y()}function F0(n,t){let e=t.key,r=e.path.canonicalString();n.Oa.get(e)||n.xa.has(r)||(U("SyncEngine","New document in limbo: "+e),n.xa.add(r),Cm(n))}function Cm(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let t=n.xa.values().next().value;n.xa.delete(t);let e=new W(kt.fromString(t)),r=n.qa.next();n.Na.set(r,new Yf(e)),n.Oa=n.Oa.insert(e,r),ww(n.remoteStore,new Wo(Xe(vm(e.path)),r,"TargetPurposeLimboResolution",U_.oe))}}async function sa(n,t,e){let r=tt(n),s=[],o=[],u=[];r.Fa.isEmpty()||(r.Fa.forEach((l,h)=>{u.push(r.Ka(h,t,e).then(f=>{var g;if((f||e)&&r.isPrimaryClient){let E=f?!f.fromCache:(g=e?.targetChanges.get(h.targetId))===null||g===void 0?void 0:g.current;r.sharedClientState.updateQueryState(h.targetId,E?"current":"not-current")}if(f){s.push(f);let E=xf.Wi(h.targetId,f);o.push(E)}}))}),await Promise.all(u),r.Ca.d_(s),await(async function(h,f){let g=tt(h);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",E=>k.forEach(f,T=>k.forEach(T.$i,S=>g.persistence.referenceDelegate.addReference(E,T.targetId,S)).next(()=>k.forEach(T.Ui,S=>g.persistence.referenceDelegate.removeReference(E,T.targetId,S)))))}catch(E){if(!ra(E))throw E;U("LocalStore","Failed to update sequence numbers: "+E)}for(let E of f){let T=E.targetId;if(!E.fromCache){let S=g.os.get(T),C=S.snapshotVersion,V=S.withLastLimboFreeSnapshotVersion(C);g.os=g.os.insert(T,V)}}})(r.localStore,o))}async function M0(n,t){let e=tt(n);if(!e.currentUser.isEqual(t)){U("SyncEngine","User change. New user:",t.toKey());let r=await yw(e.localStore,t);e.currentUser=t,(function(o,u){o.ka.forEach(l=>{l.forEach(h=>{h.reject(new G(N.CANCELLED,u))})}),o.ka.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await sa(e,r.hs)}}function L0(n,t){let e=tt(n),r=e.Na.get(t);if(r&&r.va)return it().add(r.key);{let s=it(),o=e.Ma.get(t);if(!o)return s;for(let u of o){let l=e.Fa.get(u);s=s.unionWith(l.view.Va)}return s}}function Vw(n){let t=tt(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Sw.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=L0.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=N0.bind(null,t),t.Ca.d_=b0.bind(null,t.eventManager),t.Ca.$a=S0.bind(null,t.eventManager),t}function q0(n){let t=tt(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=k0.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=O0.bind(null,t),t}var M_=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ju(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,r){return null}Ha(e,r){return null}za(e){return i0(this.persistence,new Nf,e.initialUser,this.serializer)}Ga(e){return new Pf(Vf.Zr,this.serializer)}Wa(e){return new Ff}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return n.provider={build:()=>new n},n})();var B0=(()=>{class n{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>O_(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=M0.bind(null,this.syncEngine),await E0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new Qf})()}createDatastore(e){let r=Ju(e.databaseInfo.databaseId),s=(function(u){return new qf(u)})(e.databaseInfo);return(function(u,l,h,f){return new jf(u,l,h,f)})(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return(function(s,o,u,l,h){return new $f(s,o,u,l,h)})(this.localStore,this.datastore,e.asyncQueue,r=>O_(this.syncEngine,r,0),(function(){return Du.D()?new Du:new Mf})())}createSyncEngine(e,r){return(function(o,u,l,h,f,g,E){let T=new Zf(o,u,l,h,f,g);return E&&(T.Qa=!0),T})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await(async function(o){let u=tt(o);U("RemoteStore","RemoteStore shutting down."),u.L_.add(5),await ia(u),u.k_.shutdown(),u.q_.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}return n.provider={build:()=>new n},n})();var em=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ya(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ya(this.observer.error,t):Nn("Uncaught Error in snapshot listener:",t.toString()))}Za(){this.muted=!0}Ya(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var nm=class{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=Ut.UNAUTHENTICATED,this.clientId=_u.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async u=>{U("FirestoreClient","Received user=",u.uid),await this.authCredentialListener(u),this.user=u}),this.appCheckCredentials.start(r,u=>(U("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new He;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=Rm(e,"Failed to shutdown persistence");t.reject(r)}}),t.promise}};async function Vd(n,t){n.asyncQueue.verifyOperationInProgress(),U("FirestoreClient","Initializing OfflineComponentProvider");let e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await yw(t.localStore,s),r=s)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function L_(n,t){n.asyncQueue.verifyOperationInProgress();let e=await U0(n);U("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>D_(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>D_(t.remoteStore,s)),n._onlineComponents=t}async function U0(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){U("FirestoreClient","Using user provided OfflineComponentProvider");try{await Vd(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===N.FAILED_PRECONDITION||s.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;Fi("Error using user provided cache. Falling back to memory cache: "+e),await Vd(n,new M_)}}else U("FirestoreClient","Using default OfflineComponentProvider"),await Vd(n,new M_);return n._offlineComponents}async function xw(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(U("FirestoreClient","Using user provided OnlineComponentProvider"),await L_(n,n._uninitializedComponentsProvider._online)):(U("FirestoreClient","Using default OnlineComponentProvider"),await L_(n,new B0))),n._onlineComponents}function j0(n){return xw(n).then(t=>t.syncEngine)}async function z0(n){let t=await xw(n),e=t.eventManager;return e.onListen=R0.bind(null,t.syncEngine),e.onUnlisten=V0.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=P0.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=x0.bind(null,t.syncEngine),e}function $0(n,t,e={}){let r=new He;return n.asyncQueue.enqueueAndForget(async()=>(function(o,u,l,h,f){let g=new em({next:T=>{g.Za(),u.enqueueAndForget(()=>A0(o,E));let S=T.docs.has(l);!S&&T.fromCache?f.reject(new G(N.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&T.fromCache&&h&&h.source==="server"?f.reject(new G(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(T)},error:T=>f.reject(T)}),E=new Hf(vm(l.path),g,{includeMetadataChanges:!0,_a:!0});return T0(o,E)})(await z0(n),n.asyncQueue,t,e,r)),r.promise}function Dw(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var q_=new Map;function G0(n,t,e){if(!e)throw new G(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function K0(n,t,e,r){if(t===!0&&r===!0)throw new G(N.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function B_(n){if(!W.isDocumentKey(n))throw new G(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Vm(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":Y()}function Yr(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new G(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Vm(n);throw new G(N.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}var Bu=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new G(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new G(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}K0("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Dw((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new G(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new G(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new G(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Xo=class{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bu({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new G(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new G(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bu(t),t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new xd;switch(r.type){case"firstParty":return new Od(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new G(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){let r=q_.get(e);r&&(U("ComponentProvider","Removing Datastore"),q_.delete(e),r.terminate())})(this),Promise.resolve()}};function Nw(n,t,e,r={}){var s;let o=(n=Yr(n,Xo))._getSettings(),u=`${t}:${e}`;if(o.host!=="firestore.googleapis.com"&&o.host!==u&&Fi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},o),{host:u,ssl:!1})),r.mockUserToken){let l,h;if(typeof r.mockUserToken=="string")l=r.mockUserToken,h=Ut.MOCK_USER;else{l=Um(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);let f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new G(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Ut(f)}n._authCredentials=new Dd(new yu(l,h))}}var rm=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},pe=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Yo(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}},Yo=class n extends rm{constructor(t,e,r){super(t,e,vm(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new pe(this.firestore,null,new W(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function kw(n,t,...e){if(n=Mn(n),arguments.length===1&&(t=_u.newId()),G0("doc","path",t),n instanceof Xo){let r=kt.fromString(t,...e);return B_(r),new pe(n,null,new W(r))}{if(!(n instanceof pe||n instanceof Yo))throw new G(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(kt.fromString(t,...e));return B_(r),new pe(n.firestore,n instanceof Yo?n.converter:null,new W(r))}}var Uu=class{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Nu(this,"async_queue_retry"),this.Vu=()=>{let r=Cd();r&&U("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=t;let e=Cd();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;let e=Cd();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise(()=>{});let e=new He;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Pu.push(t),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!ra(t))throw t;U("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(t){let e=this.mu.then(()=>(this.du=!0,t().catch(r=>{this.Eu=r,this.du=!1;let s=(function(u){let l=u.message||"";return u.stack&&(l=u.stack.includes(u.message)?u.stack:u.message+`
`+u.stack),l})(r);throw Nn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=e,e}enqueueAfterDelay(t,e,r){this.fu(),this.Ru.indexOf(t)>-1&&(e=0);let s=Gf.createAndSchedule(this,t,e,r,o=>this.yu(o));return this.Tu.push(s),s}fu(){this.Eu&&Y()}verifyOperationInProgress(){}async wu(){let t;do t=this.mu,await t;while(t!==this.mu)}Su(t){for(let e of this.Tu)if(e.timerId===t)return!0;return!1}bu(t){return this.wu().then(()=>{this.Tu.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.Tu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.wu()})}Du(t){this.Ru.push(t)}yu(t){let e=this.Tu.indexOf(t);this.Tu.splice(e,1)}};var Qi=class extends Xo{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Uu,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Uu(t),this._firestoreClient=void 0,await t}}};function Ow(n,t){let e=typeof n=="object"?n:Xm(),r=typeof n=="string"?n:t||"(default)",s=Hm(e,"firestore").getImmediate({identifier:r});if(!s._initialized){let o=Bm("firestore");o&&Nw(s,...o)}return s}function Fw(n){if(n._terminated)throw new G(N.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Q0(n),n._firestoreClient}function Q0(n){var t,e,r;let s=n._freezeSettings(),o=(function(l,h,f,g){return new Bd(l,h,f,g.host,g.ssl,g.experimentalForceLongPolling,g.experimentalAutoDetectLongPolling,Dw(g.experimentalLongPollingOptions),g.useFetchStreams)})(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((e=s.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new nm(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&(function(l){let h=l?._online.build();return{_offline:l?._offline.build(h),_online:h}})(n._componentsProvider))}var Zo=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(Xt.fromBase64String(t))}catch(e){throw new G(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(Xt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Wi=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new G(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ge(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Hi=class{constructor(t){this._methodName=t}};var ta=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new G(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new G(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return mt(this._lat,t._lat)||mt(this._long,t._long)}};var ea=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,t._values)}};var W0=/^__.*__$/,im=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new en(t,this.data,this.fieldMask,e,this.fieldTransforms):new Xr(t,this.data,e,this.fieldTransforms)}},ju=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new en(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Mw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Y()}}var sm=class n{constructor(t,e,r,s,o,u){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.vu(),this.fieldTransforms=o||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Fu({path:r,xu:!1});return s.Ou(t),s}Nu(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(t){return this.Fu({path:void 0,xu:!0})}Bu(t){return $u(t,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ou(this.path.get(t))}Ou(t){if(t.length===0)throw this.Bu("Document fields must not be empty");if(Mw(this.Cu)&&W0.test(t))throw this.Bu('Document fields cannot begin and end with "__"')}},om=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Ju(t)}Qu(t,e,r,s=!1){return new sm({Cu:t,methodName:e,qu:r,path:ge.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Lw(n){let t=n._freezeSettings(),e=Ju(n._databaseId);return new om(n._databaseId,!!t.ignoreUndefinedProperties,e)}function H0(n,t,e,r,s,o={}){let u=n.Qu(o.merge||o.mergeFields?2:0,t,e,s);xm("Data must be an object, but it was:",u,r);let l=qw(r,u),h,f;if(o.merge)h=new Ie(u.fieldMask),f=u.fieldTransforms;else if(o.mergeFields){let g=[];for(let E of o.mergeFields){let T=um(t,E,e);if(!u.contains(T))throw new G(N.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);Uw(g,T)||g.push(T)}h=new Ie(g),f=u.fieldTransforms.filter(E=>h.covers(E.field))}else h=null,f=u.fieldTransforms;return new im(new me(l),h,f)}var zu=class n extends Hi{_toFieldTransform(t){if(t.Cu!==2)throw t.Cu===1?t.Bu(`${this._methodName}() can only appear at the top level of your update data`):t.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};var am=class n extends Hi{_toFieldTransform(t){return new tf(t.path,new Wr)}isEqual(t){return t instanceof n}};function J0(n,t,e,r){let s=n.Qu(1,t,e);xm("Data must be an object, but it was:",s,r);let o=[],u=me.empty();Zr(r,(h,f)=>{let g=Dm(t,h,e);f=Mn(f);let E=s.Nu(g);if(f instanceof zu)o.push(g);else{let T=Zu(f,E);T!=null&&(o.push(g),u.set(g,T))}});let l=new Ie(o);return new ju(u,l,s.fieldTransforms)}function X0(n,t,e,r,s,o){let u=n.Qu(1,t,e),l=[um(t,r,e)],h=[s];if(o.length%2!=0)throw new G(N.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<o.length;T+=2)l.push(um(t,o[T])),h.push(o[T+1]);let f=[],g=me.empty();for(let T=l.length-1;T>=0;--T)if(!Uw(f,l[T])){let S=l[T],C=h[T];C=Mn(C);let V=u.Nu(S);if(C instanceof zu)f.push(S);else{let P=Zu(C,V);P!=null&&(f.push(S),g.set(S,P))}}let E=new Ie(f);return new ju(g,E,u.fieldTransforms)}function Zu(n,t){if(Bw(n=Mn(n)))return xm("Unsupported field value:",t,n),qw(n,t);if(n instanceof Hi)return(function(r,s){if(!Mw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.xu&&t.Cu!==4)throw t.Bu("Nested arrays are not supported");return(function(r,s){let o=[],u=0;for(let l of r){let h=Zu(l,s.Lu(u));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),u++}return{arrayValue:{values:o}}})(n,t)}return(function(r,s){if((r=Mn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return DT(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=Kt.fromDate(r);return{timestampValue:Cu(s.serializer,o)}}if(r instanceof Kt){let o=new Kt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Cu(s.serializer,o)}}if(r instanceof ta)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Zo)return{bytesValue:lw(s.serializer,r._byteString)};if(r instanceof pe){let o=s.databaseId,u=r.firestore._databaseId;if(!u.isEqual(o))throw s.Bu(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Em(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ea)return(function(u,l){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:u.toArray().map(h=>{if(typeof h!="number")throw l.Bu("VectorValues must only contain numeric values.");return Im(l.serializer,h)})}}}}}})(r,s);throw s.Bu(`Unsupported field value: ${Vm(r)}`)})(n,t)}function qw(n,t){let e={};return j_(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Zr(n,(r,s)=>{let o=Zu(s,t.Mu(r));o!=null&&(e[r]=o)}),{mapValue:{fields:e}}}function Bw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Kt||n instanceof ta||n instanceof Zo||n instanceof pe||n instanceof Hi||n instanceof ea)}function xm(n,t,e){if(!Bw(e)||!(function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)})(e)){let r=Vm(e);throw r==="an object"?t.Bu(n+" a custom object"):t.Bu(n+" "+r)}}function um(n,t,e){if((t=Mn(t))instanceof Wi)return t._internalPath;if(typeof t=="string")return Dm(n,t);throw $u("Field path arguments must be of type string or ",n,!1,void 0,e)}var Y0=new RegExp("[~\\*/\\[\\]]");function Dm(n,t,e){if(t.search(Y0)>=0)throw $u(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Wi(...t.split("."))._internalPath}catch{throw $u(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function $u(n,t,e,r,s){let o=r&&!r.isEmpty(),u=s!==void 0,l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||u)&&(h+=" (found",o&&(h+=` in field ${r}`),u&&(h+=` in document ${s}`),h+=")"),new G(N.INVALID_ARGUMENT,l+n+h)}function Uw(n,t){return n.some(e=>e.isEqual(t))}var Gu=class{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new cm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(jw("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},cm=class extends Gu{data(){return super.data()}};function jw(n,t){return typeof t=="string"?Dm(n,t):t instanceof Wi?t._internalPath:t._delegate._internalPath}var lm=class{convertValue(t,e="none"){switch(Qr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Et(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(tr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw Y()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return Zr(t,(s,o)=>{r[s]=this.convertValue(o,e)}),r}convertVectorValue(t){var e,r,s;let o=(s=(r=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(u=>Et(u.doubleValue));return new ea(o)}convertGeoPoint(t){return new ta(Et(t.latitude),Et(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=pm(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Go(t));default:return null}}convertTimestamp(t){let e=kn(t);return new Kt(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=kt.fromString(t);yt(pw(r));let s=new Eu(r.get(1),r.get(3)),o=new W(r.popFirst(5));return s.isEqual(e)||Nn(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}};function Z0(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var hm=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Ku=class extends Gu{constructor(t,e,r,s,o,u){super(t,e,r,s,u),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new dm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(jw("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}},dm=class extends Ku{data(t={}){return super.data(t)}};function zw(n){n=Yr(n,pe);let t=Yr(n.firestore,Qi);return $0(Fw(t),n._key).then(e=>tA(t,n,e))}var fm=class extends lm{constructor(t){super(),this.firestore=t}convertBytes(t){return new Zo(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new pe(this.firestore,null,e)}};function $w(n,t,e){n=Yr(n,pe);let r=Yr(n.firestore,Qi),s=Z0(n.converter,t,e);return Kw(r,[H0(Lw(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Zn.none())])}function Gw(n,t,e,...r){n=Yr(n,pe);let s=Yr(n.firestore,Qi),o=Lw(s),u;return u=typeof(t=Mn(t))=="string"||t instanceof Wi?X0(o,"updateDoc",n._key,t,e,r):J0(o,"updateDoc",n._key,t),Kw(s,[u.toMutation(n._key,Zn.exists(!0))])}function Kw(n,t){return(function(r,s){let o=new He;return r.asyncQueue.enqueueAndForget(async()=>D0(await j0(r),s,o)),o.promise})(Fw(n),t)}function tA(n,t,e){let r=e.docs.get(t._key),s=new fm(n);return new Ku(n,s,t._key,r,new hm(e.hasPendingWrites,e.fromCache),t.converter)}function Qw(){return new am("serverTimestamp")}(function(t,e=!0){(function(s){Ji=s})(Jm),Wm(new Gm("firestore",(r,{instanceIdentifier:s,options:o})=>{let u=r.getProvider("app").getImmediate(),l=new Qi(new Nd(r.getProvider("auth-internal")),new Md(r.getProvider("app-check-internal")),(function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new G(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Eu(f.options.projectId,g)})(u,s),u);return o=Object.assign({useFetchStreams:e},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),no(h_,"4.7.3",t),no(h_,"4.7.3","esm2017")})();var Fn=class{constructor(t){return t}},Ww="firestore",Nm=class{constructor(){return tg(Ww)}};var km=new Fm("angularfire2.firestore-instances");function eA(n,t){let e=Zm(Ww,n,t);return e&&new Fn(e)}function nA(n){return(t,e)=>{let r=t.runOutsideAngular(()=>n(e));return new Fn(r)}}var rA={provide:Nm,deps:[[new eo,km]]},iA={provide:Fn,useFactory:eA,deps:[[new eo,km],rg]};function i1(n,...t){return no("angularfire",Ym.full,"fst"),Mm([iA,rA,{provide:km,useFactory:nA(n),multi:!0,deps:[qm,Lm,ng,ig,[new eo,og],[new eo,eg],...t]}])}var s1=Ln(u_,!0);var se=Ln(kw,!0);var Ee=Ln(zw,!0);var o1=Ln(Ow,!0);var rr=Ln(Qw,!0),Yi=Ln($w,!0);var tc=Ln(Gw,!0);var Jw=class n{constructor(t,e){this.auth=t;this.fs=e;this.auth.onAuthStateChanged(async r=>{r?(this.userUidSubject.next(r.uid),await this.syncUserContext(r.uid)):(this.userUidSubject.next(null),this.industrySubject.next(null))})}userUidSubject=new Oc(null);userUid$=this.userUidSubject.asObservable();industrySubject=new Oc(null);industry$=this.industrySubject.asObservable();async syncUserContext(t){try{let e=se(this.fs,`users/${t}`),r=await Ee(e);if(!r.exists()){this.industrySubject.next(null);return}let s=r.data();if(s.companyId){let o=se(this.fs,`companies/${s.companyId}`),u=await Ee(o);if(u.exists()){let l=u.data();this.industrySubject.next(l.industry??null);return}}this.industrySubject.next(null)}catch(e){console.error("syncUserContext failed",e),this.industrySubject.next(null)}}async signup(t,e,r,s=!0,o){try{let l=(await ag(this.auth,t,r)).user.uid;if(console.log("Created user UID:",l),await Yi(se(this.fs,`users/${l}`),{uid:l,mobile:e,isOwner:s,companyId:o??null,role:s?"OWNER":"STAFF",createdAt:rr()}),o){let h=se(this.fs,`companies/${o}`),f=await Ee(h);if(f.exists()){await Yi(se(this.fs,`companies/${o}/users/${l}`),{uid:l,role:s?"OWNER":"STAFF",status:"ACTIVE",createdAt:rr()});let g=f.data();g?.industry&&this.industrySubject.next(g.industry)}}return{uid:l}}catch(u){throw console.error("SIGNUP FAILED:",u.code,u.message,u),u}}forgotPassword(t){return ug(this.auth,t)}async login(t,e){let s=(await cg(this.auth,t,e)).user.uid,o=await Ee(se(this.fs,`users/${s}`));if(!o.exists())throw new Error("User profile missing");let u=o.data(),l=u.companyId??null;if(l){let h=await Ee(se(this.fs,`companies/${l}`));if(h.exists()){let f=h.data();return this.industrySubject.next(f.industry??null),{uid:s,companyId:l,industry:f.industry??null,role:u.role}}}return this.industrySubject.next(null),{uid:s,companyId:null,industry:null,role:u.role}}async setIndustryForCompany(t,e){let r=se(this.fs,`companies/${t}`);if(!(await Ee(r)).exists())throw new Error("Company not found");await tc(r,{industry:e,updatedAt:rr()}),this.industrySubject.next(e)}async logout(){await this.auth.signOut(),this.userUidSubject.next(null),this.industrySubject.next(null)}getCurrentUid(){return this.auth.currentUser?.uid??null}static \u0275fac=function(e){return new(e||n)(to(sg),to(Fn))};static \u0275prov=ua({token:n,factory:n.\u0275fac,providedIn:"root"})};var Xw=class n{constructor(t){this.fs=t}async getUserdetails(t){let e=await Ee(se(this.fs,`users/${t}`));return e.exists()?e.data():null}async getCompany(t){let e=await Ee(se(this.fs,`companies/${t}`));return e.exists()?e.data():null}async createCompany(t,e){let r=se(this.fs,`companies/${t}`);if((await Ee(r)).exists())throw new Error("Company already exists");await Yi(r,aa(oa({},e),{createdAt:rr()}))}async updateCompany(t,e){let r=se(this.fs,`companies/${t}`);(await Ee(r)).exists()?await tc(r,aa(oa({},e),{updatedAt:rr()})):await Yi(r,aa(oa({},e),{updatedAt:rr()}))}static \u0275fac=function(e){return new(e||n)(to(Fn))};static \u0275prov=ua({token:n,factory:n.\u0275fac,providedIn:"root"})};export{yg as a,la as b,_g as c,wg as d,vg as e,In as f,le as g,En as h,oo as i,Cg as j,Vg as k,xg as l,Wv as m,Dg as n,ri as o,BA as p,YE as q,UA as r,jA as s,zA as t,$A as u,GA as v,KA as w,QA as x,WA as y,HA as z,r_ as A,JA as B,XA as C,Fn as D,i1 as E,s1 as F,se as G,Ee as H,o1 as I,Jw as J,Xw as K};
