import{a as de}from"./chunk-AEGG3O7Y.js";import{A as ce,B as le,C as S,F as he,a as z,b as j,c as G,d as K,e as W,f as V,g as X,h as Y,i as Z,j as J,k as Q,l as ee,m as te,n as ne,o as E,p as I,q as w,r as se,s as re,t as oe,u as x,v as ie,x as ae,y as ue,z as v}from"./chunk-P7ZXRJB5.js";import{J as $,N as H}from"./chunk-2JCYUYSE.js";import{a as O,b as q}from"./chunk-KAT7YFEL.js";var Ue="firebase",Ae="11.10.0";E(Ue,Ae,"app");var be="firebasestorage.googleapis.com",Oe="storageBucket",Se=120*1e3,Ce=600*1e3;var f=class t extends V{constructor(e,n,s=0){super(N(e),`Firebase Storage: ${n} (${N(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,t.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return N(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},g=(function(t){return t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment",t})(g||{});function N(t){return"storage/"+t}function Pe(){let t="An unknown error occurred, please check the error payload for server response.";return new f(g.UNKNOWN,t)}function xe(){return new f(g.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ve(){return new f(g.CANCELED,"User canceled the upload/download.")}function Ne(t){return new f(g.INVALID_URL,"Invalid URL '"+t+"'.")}function De(t){return new f(g.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function fe(t){return new f(g.INVALID_ARGUMENT,t)}function Re(){return new f(g.APP_DELETED,"The Firebase app was deleted.")}function Le(t){return new f(g.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}var m=class t{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let s;try{s=t.makeFromUrl(e,n)}catch{return new t(e,"")}if(s.path==="")return s;throw De(e)}static makeFromUrl(e,n){let s=null,r="([A-Za-z0-9.\\-_]+)";function o(d){d.path.charAt(d.path.length-1)==="/"&&(d.path_=d.path_.slice(0,-1))}let i="(/(.*))?$",u=new RegExp("^gs://"+r+i,"i"),a={bucket:1,path:3};function c(d){d.path_=decodeURIComponent(d.path)}let l="v[A-Za-z0-9_]+",p=n.replace(/[.]/g,"\\."),_="(/([^?#]*).*)?$",b=new RegExp(`^https?://${p}/${l}/b/${r}/o${_}`,"i"),R={bucket:1,path:3},y=n===be?"(?:storage.googleapis.com|storage.cloud.google.com)":n,h="([^?#]*)",U=new RegExp(`^https?://${y}/${r}/${h}`,"i"),T=[{regex:u,indices:a,postModify:o},{regex:b,indices:R,postModify:c},{regex:U,indices:{bucket:1,path:2},postModify:c}];for(let d=0;d<T.length;d++){let A=T[d],C=A.regex.exec(e);if(C){let Ie=C[A.indices.bucket],P=C[A.indices.path];P||(P=""),s=new t(Ie,P),A.postModify(s);break}}if(s==null)throw Ne(e);return s}},D=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function Be(t,e,n){let s=1,r=null,o=null,i=!1,u=0;function a(){return u===2}let c=!1;function l(...h){c||(c=!0,e.apply(null,h))}function p(h){r=setTimeout(()=>{r=null,t(b,a())},h)}function _(){o&&clearTimeout(o)}function b(h,...U){if(c){_();return}if(h){_(),l.call(null,h,...U);return}if(a()||i){_(),l.call(null,h,...U);return}s<64&&(s*=2);let T;u===1?(u=2,T=0):T=(s+Math.random())*1e3,p(T)}let R=!1;function y(h){R||(R=!0,_(),!c&&(r!==null?(h||(u=2),clearTimeout(r),p(0)):h||(u=1)))}return p(0),o=setTimeout(()=>{i=!0,y(!0)},n),y}function Me(t){t(!1)}function Fe(t){return t!==void 0}function pe(t,e,n,s){if(s<e)throw fe(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>n)throw fe(`Invalid value for '${t}'. Expected ${n} or less.`)}function qe(t){let e=encodeURIComponent,n="?";for(let s in t)if(t.hasOwnProperty(s)){let r=e(s)+"="+e(t[s]);n=n+r+"&"}return n=n.slice(0,-1),n}var L=(function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t})(L||{});function $e(t,e){let n=t>=500&&t<600,r=[408,429].indexOf(t)!==-1,o=e.indexOf(t)!==-1;return n||r||o}var B=class{constructor(e,n,s,r,o,i,u,a,c,l,p,_=!0,b=!1){this.url_=e,this.method_=n,this.headers_=s,this.body_=r,this.successCodes_=o,this.additionalRetryCodes_=i,this.callback_=u,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=p,this.retry=_,this.isUsingEmulator=b,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((R,y)=>{this.resolve_=R,this.reject_=y,this.start_()})}start_(){let e=(s,r)=>{if(r){s(!1,new k(!1,null,!0));return}let o=this.connectionFactory_();this.pendingConnection_=o;let i=u=>{let a=u.loaded,c=u.lengthComputable?u.total:-1;this.progressCallback_!==null&&this.progressCallback_(a,c)};this.progressCallback_!==null&&o.addUploadProgressListener(i),o.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(i),this.pendingConnection_=null;let u=o.getErrorCode()===L.NO_ERROR,a=o.getStatus();if(!u||$e(a,this.additionalRetryCodes_)&&this.retry){let l=o.getErrorCode()===L.ABORT;s(!1,new k(!1,null,l));return}let c=this.successCodes_.indexOf(a)!==-1;s(!0,new k(c,o))})},n=(s,r)=>{let o=this.resolve_,i=this.reject_,u=r.connection;if(r.wasSuccessCode)try{let a=this.callback_(u,u.getResponse());Fe(a)?o(a):o()}catch(a){i(a)}else if(u!==null){let a=Pe();a.serverResponse=u.getErrorText(),this.errorCallback_?i(this.errorCallback_(u,a)):i(a)}else if(r.canceled){let a=this.appDelete_?Re():ve();i(a)}else{let a=xe();i(a)}};this.canceled_?n(!1,new k(!1,null,!0)):this.backoffId_=Be(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Me(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},k=class{constructor(e,n,s){this.wasSuccessCode=e,this.connection=n,this.canceled=!!s}};function He(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function ze(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function je(t,e){e&&(t["X-Firebase-GMPID"]=e)}function Ge(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function Ke(t,e,n,s,r,o,i=!0,u=!1){let a=qe(t.urlParams),c=t.url+a,l=Object.assign({},t.headers);return je(l,e),He(l,n),ze(l,o),Ge(l,s),new B(c,t.method,l,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,r,i,u)}function We(t){if(t.length===0)return null;let e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function Ve(t){let e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}var it=256*1024;var M=class t{constructor(e,n){this._service=e,n instanceof m?this._location=n:this._location=m.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new t(e,n)}get root(){let e=new m(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Ve(this._location.path)}get storage(){return this._service}get parent(){let e=We(this._location.path);if(e===null)return null;let n=new m(this._location.bucket,e);return new t(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw Le(e)}};function _e(t,e){let n=e?.[Oe];return n==null?null:m.makeFromBucketSpec(n,t)}function Xe(t,e,n,s={}){t.host=`${e}:${n}`;let r=j(e);r&&(G(`https://${t.host}/b`),W("Storage",!0)),t._isUsingEmulator=!0,t._protocol=r?"https":"http";let{mockUserToken:o}=s;o&&(t._overrideAuthToken=typeof o=="string"?o:K(o,t.app.options.projectId))}var F=class{constructor(e,n,s,r,o,i=!1){this.app=e,this._authProvider=n,this._appCheckProvider=s,this._url=r,this._firebaseVersion=o,this._isUsingEmulator=i,this._bucket=null,this._host=be,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Se,this._maxUploadRetryTime=Ce,this._requests=new Set,r!=null?this._bucket=m.makeFromBucketSpec(r,this._host):this._bucket=_e(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=m.makeFromBucketSpec(this._url,e):this._bucket=_e(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){pe("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){pe("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(Q(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new M(this,e)}_makeRequest(e,n,s,r,o=!0){if(this._deleted)return new D(Re());{let i=Ke(e,this._appId,s,r,n,this._firebaseVersion,o,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}async makeRequestWithTokens(e,n){let[s,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,s,r).getPromise()}},me="@firebase/storage",ge="0.13.14";var ye="storage";function Te(t=ne(),e){t=X(t);let s=J(t,ye).getImmediate({identifier:e}),r=z("storage");return r&&Ye(s,...r),s}function Ye(t,e,n,s={}){Xe(t,e,n,s)}function Ze(t,{instanceIdentifier:e}){let n=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),r=t.getProvider("app-check-internal");return new F(n,s,r,e,ee)}function Je(){Z(new Y(ye,Ze,"PUBLIC").setMultipleInstances(!0)),E(me,ge,""),E(me,ge,"esm2017")}Je();var Qe={apiKey:"AIzaSyBVEG3n4-C4FVtbJ9Q1giz24zN9qOkIK2Q",authDomain:"chanmurarestaurantui.firebaseapp.com",projectId:"chanmurarestaurantui",storageBucket:"chanmurarestaurantui.appspot.com",messagingSenderId:"31518285804",appId:"1:31518285804:web:5a2c2d2e146987d533eac9"},ke=te(Qe);var yt=Te(ke),we=class t{constructor(e){this.restaurantContext=e;this.db=se(ke),this.restaurantContext.userDetail$.subscribe(async n=>{n&&(this.companyId=n.companyId)})}db;companyId="";async addMenuItem(e,n){await v(I(this.db,`companies/${e}/menuItems`),n)}async addExpense(e,n){let s=Date.now().toString();await v(I(this.db,`companies/${e}/expenses/${n.createdAt}/entries/${s}`),n)}async getMenuItems(e){return(await ie(I(this.db,`companies/${e}/menuItems`))).docs.map(s=>O({id:s.id},s.data()))}async updateMenuItem(e,n,s){await ae(w(this.db,`companies/${e}/menuItems`,n),s)}async deleteMenuItem(e,n){await ue(w(this.db,`companies/${e}/menuItems`,n))}async getLastMonthStats(){let e=new Date,n=e.getMonth()===0?12:e.getMonth(),r=`${e.getMonth()===0?e.getFullYear()-1:e.getFullYear()}-${String(n).padStart(2,"0")}`,o=w(this.db,"analytics",r),i=await x(o);return i.exists()?i.data():{daily:{},totalRevenue:0}}getDateKey(e=new Date){return e.toISOString().split("T")[0]}getCounterDocRef(e){return w(this.db,`companies/${this.companyId}/sales-counters`,e)}async placeOrderAtomic(e){let n=this.getDateKey(),s=this.getCounterDocRef(n),r=this.getOrdersCollectionRef(n),o=0;return await le(this.db,async u=>{let a=await u.get(s),c=1;a.exists()?(c=(a.data().count||0)+1,u.update(s,{count:c,updatedAt:S()})):(u.set(s,{count:1,updatedAt:S()}),c=1);let l=w(r),p=q(O({orderId:c},e),{totalAmount:Number(e.totalAmount||0),createdAt:S()});return o=c,u.set(l,p),{orderId:c,docId:l.id}})}subscribeTodayOrders(e){let n=this.getDateKey(),s=this.getOrdersCollectionRef(n),r=re(s,oe("createdAt","desc"));return ce(r,i=>{let u=i.docs.map(a=>O({id:a.id},a.data()));e(u)},i=>{console.error("subscribeTodayOrders error",i),e([])})}async getTodayCounter(){let e=this.getDateKey(),n=await x(this.getCounterDocRef(e));if(!n.exists())return 0;let s=n.data();return Number(s.count||0)}getOrderbyDate(e){let n=e||this.getDateKey(),s=this.getOrdersCollectionRef(n);return he(s,{idField:"id"})}getOrdersCollectionRef(e){return I(this.db,`companies/${this.companyId}/sales/${e}/orders`)}static \u0275fac=function(n){return new(n||t)(H(de))};static \u0275prov=$({token:t,factory:t.\u0275fac,providedIn:"root"})};export{we as a};
